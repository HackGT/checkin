var app=angular.module("checkin",["ui.router"]);app.config(["$httpProvider",function(e,t){e.interceptors.push("ApiAuthenticator")}]),app.factory("ApiAuthenticator",["Session","SERVER_URL",function(e,t){return{request:function(n){0!==n.url.indexOf("api/")&&0!==n.url.indexOf("auth/")||(n.url=t.BASE_URL+n.url,n.headers["Access-Control-Allow-Origin"]=t.BASE_URL);var o=e.getToken();return o&&(n.headers["x-access-token"]=o),n}}}]),app.directive("title",["$rootScope","$timeout",function(e,t){return{link:function(){var n=function(n,o){t(function(){e.title=o.data&&o.data.pageTitle?o.data.pageTitle:"Default title"})};e.$on("$stateChangeSuccess",n)}}}]),angular.module("checkin").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("login",{url:"/login",templateUrl:"views/login/login.html",controller:"LoginController",data:{requireLogin:!1,pageTitle:"Login"}}).state("app",{abstract:!0,views:{"@":{templateUrl:"views/base.html"},"toolbar@app":{templateUrl:"views/toolbar/toolbar.html",controller:"ToolbarController"}},data:{requireLogin:!0,pageTitle:"Checkin"}}).state("app.checkin",{url:"/checkin",templateUrl:"views/checkin/checkin.html",controller:"CheckinController"}).state("app.groups",{url:"/groups",templateUrl:"views/groups/groups.html",controller:"GroupsController"}),t.otherwise("/checkin")}]).run(["$rootScope","$state","Session",function(e,t,n){e.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0}),e.$on("$stateChangeStart",function(e,o,r){var u=o.data.requireLogin;u&&!n.getToken()&&(e.preventDefault(),t.go("login"))}),n.getToken()||t.go("login")}]),angular.module("checkin").factory("AuthService",["$q","$http","$rootScope","$state","Session",function(e,t,n,o,r){function u(t){var n=t.data;return console.log("auth success",n),r.create(n.token,n.user),e(function(e){e(n.user)})}function s(t,n){return console.log("auth fail",t),o.go("login"),e(function(e,n){n(t)})}var i={},l="auth/";return i.loginWithPassword=function(e,n){return t.post(l+"login",{email:e,password:n}).then(u,s)},i.loginWithToken=function(e){return console.warn("Not actually sure if this works yet!"),t.post(l+"login",{token:e}).then(u,function(){400===status&&r.destroy().then(s)})},i}]),angular.module("checkin").factory("GroupService",["$q","$http","Session",function(e,t,n){var o="api/groups/",r={};return r.getGroups=function(){return t.get(o)},r.createGroup=function(e){return t.post(o,{groupName:e})},r.getVolunteers=function(e){return t.get(o+e+"/volunteers")},r.addVolunteerToGroup=function(e,n){return t.put(o+n+"/volunteers/"+e)},r.removeVolunteerFromGroup=function(e,n){return t.delete(o+n+"/volunteers/"+e)},r.addUsersToGroup=function(e,n){return t.put(group+e,n)},r.removeUsersFromGroup=function(e,n){return t.delete(o+e,n)},r}]),angular.module("checkin").service("Session",["$rootScope","$window","$q",function(e,t,n){this.create=function(n,o){t.localStorage.jwt=n,t.localStorage.userId=o._id,t.localStorage.currentUser=JSON.stringify(o),e.currentUser=o},this.destroy=function(){return delete t.localStorage.jwt,delete t.localStorage.userId,delete t.localStorage.currentUser,e.currentUser=null,n(function(e,t){e()})},this.getToken=function(){return t.localStorage.jwt},this.getUserId=function(){return t.localStorage.userId},this.getUser=function(){return JSON.parse(t.localStorage.currentUser)}}]),angular.module("checkin").factory("UserService",["$q","$http","Session",function(e,t,n){var o="api/users",r=o+"/",u={};return u.getUsers=function(e){void 0===e.page&&void 0===e.size||(e.page=e.page||0,e.size=e.size||50);var n=e?o+"?"+$.param({text:e.text,page:e.page,size:e.size,group:e.group}):r;return t.get(n)},u.checkin=function(e){return t.post(r+e+"/checkin")},u.checkout=function(e){return t.post(r+e+"/checkout")},u}]),angular.module("checkin").controller("CheckinController",["$scope","UserService",function(e,t){function n(){return e.query?e.query.length>0&&e.query.length<3?s:e.query:null}function o(){e.users={users:[],busy:!1,nextPage:0,totalPages:0,totalUsers:0,getNextPage:function(){this.busy||(this.busy=!0,this.nextPage=this.nextPage+1,t.getUsers({text:n(),page:this.nextPage}).then(r.bind(this)))}}}function r(e){console.log(e.data),this.users=this.users.concat(e.data.users),this.totalUsers=e.data.totalUsers,this.totalPages=e.data.totalPages,this.nextPage=this.nextPage+1,this.busy=!1,u.sticky("refresh")}var u=$(".userSearch > .sticky");u.sticky({context:".userList > table"});var s=null;e.searchUsers=function(){var u=n();if(console.log("query:",u),u!==s){var i=s=t.getUsers({page:0,text:u});i.then(function(t){i===s&&(o(),r.bind(e.users)(t))})}},e.users={},o(),e.selectedUser=null,e.setSelectedUser=function(t){var n=$(".userDetails");n.modal(),e.selectedUser=t,t?n.modal("show"):n.modal("hide")},e.users.getNextPage(),e.checkin=function(e){console.log("checkin",e)},e.checkout=function(e){console.log("checkout",e)}}]),angular.module("checkin").controller("GroupsController",["$scope","UserService","GroupService",function(e,t,n){e.groups=[],e.getGroups=function(){n.getGroups().then(function(t){e.groups=t.data})},e.getGroups(),e.createGroup=function(t){t&&n.createGroup(t).then(function(t){e.groups.push(t.data)})},e.selectedGroup=null,e.selectGroup=function(t){e.selectedNewVolunteer=null,e.selectedGroup=t,n.getVolunteers(t._id).then(function(t){e.selectedGroup.volunteers=t.data.volunteers})},e.selectedNewVolunteer=null,e.setSelectedNewVolunteer=function(t){e.selectedNewVolunteer=t,t&&e.$apply()},e.addNewVolunteer=function(t,o){n.addVolunteerToGroup(t._id,o._id).then(function(t){e.selectedGroup.volunteers.push(t.data),e.setSelectedNewVolunteer(null)})},e.removeVolunteerFromGroup=function(t,o){n.removeVolunteerFromGroup(t._id,o._id).then(function(t){e.selectedGroup.volunteers.splice(e.selectedGroup.volunteers.findIndex(function(e){return e._id===t.data._id}),1)})},$(".add-volunteer").search({apiSettings:{responseAsync:function(e,n){e.urlData.query;t.getUsers({text:e.urlData.query}).then(function(e){results=e.data.users.map(function(e){return{title:e.profile.name||e.email,description:e.profile.name?e.email:void 0,user:e}}),n({results:results})})}},minCharacters:3,onSelect:function(t){e.setSelectedNewVolunteer(t.user)}})}]),angular.module("checkin").controller("LoginController",["$scope","$state","AuthService",function(e,t,n){function o(e){console.log("success",e),t.go("app.checkin")}function r(e){console.log("failure",e)}e.login=function(){n.loginWithPassword(e.email,e.password).then(o,r)}}]),angular.module("checkin").controller("ToolbarController",["$scope","$state","$rootScope","Session",function(e,t,n,o){var r=o.getUser();e.states=[{name:"app.checkin",title:"Checkin"},{name:"app.groups",title:"Groups",adminOnly:!0}].filter(function(e){return!(e.adminOnly&&!r.admin)}),$(".logout").click(function(){o.destroy().then(function(){t.go("login")})})}]),angular.module("checkin").constant("SERVER_URL",{BASE_URL:"https://ce4e7571.ngrok.io/"});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJvdXRlcy5qcyIsImF1dGgvQXV0aFNlcnZpY2UuanMiLCJncm91cHMvR3JvdXBTZXJ2aWNlLmpzIiwic2Vzc2lvbi9TZXNzaW9uLmpzIiwidXNlcnMvVXNlclNlcnZpY2UuanMiLCJjaGVja2luL2NoZWNraW5Db250cm9sbGVyLmpzIiwiZ3JvdXBzL2dyb3Vwc0NvbnRyb2xsZXIuanMiLCJsb2dpbi9sb2dpbkNvbnRyb2xsZXIuanMiLCJ0b29sYmFyL3Rvb2xiYXJDb250cm9sbGVyLmpzIiwiY29uZmlnLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkaHR0cFByb3ZpZGVyIiwiU0VSVkVSX1VSTCIsImludGVyY2VwdG9ycyIsInB1c2giLCJmYWN0b3J5IiwiU2Vzc2lvbiIsInJlcXVlc3QiLCJ1cmwiLCJpbmRleE9mIiwiQkFTRV9VUkwiLCJoZWFkZXJzIiwidG9rZW4iLCJnZXRUb2tlbiIsImRpcmVjdGl2ZSIsIiRyb290U2NvcGUiLCIkdGltZW91dCIsImxpbmsiLCJsaXN0ZW5lciIsImV2ZW50IiwidG9TdGF0ZSIsInRpdGxlIiwiZGF0YSIsInBhZ2VUaXRsZSIsIiRvbiIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwic3RhdGUiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJyZXF1aXJlTG9naW4iLCJhYnN0cmFjdCIsInZpZXdzIiwiQCIsInRvb2xiYXJAYXBwIiwib3RoZXJ3aXNlIiwicnVuIiwiJHN0YXRlIiwiZG9jdW1lbnQiLCJib2R5Iiwic2Nyb2xsVG9wIiwiZG9jdW1lbnRFbGVtZW50IiwidG9QYXJhbXMiLCJwcmV2ZW50RGVmYXVsdCIsImdvIiwiJHEiLCIkaHR0cCIsImxvZ2luU3VjY2VzcyIsInJlc3BvbnNlIiwiY29uc29sZSIsImxvZyIsImNyZWF0ZSIsInVzZXIiLCJyZXNvbHZlIiwibG9naW5GYWlsdXJlIiwiY2FsbGJhY2siLCJyZWplY3QiLCJhdXRoU2VydmljZSIsImJhc2VVcmwiLCJsb2dpbldpdGhQYXNzd29yZCIsImVtYWlsIiwicGFzc3dvcmQiLCJwb3N0IiwidGhlbiIsImxvZ2luV2l0aFRva2VuIiwid2FybiIsInN0YXR1cyIsImRlc3Ryb3kiLCJncm91cHMiLCJHcm91cFNlcnZpY2UiLCJnZXRHcm91cHMiLCJnZXQiLCJjcmVhdGVHcm91cCIsImdyb3VwTmFtZSIsImdldFZvbHVudGVlcnMiLCJncm91cElkIiwiYWRkVm9sdW50ZWVyVG9Hcm91cCIsInZvbHVudGVlcklkIiwicHV0IiwicmVtb3ZlVm9sdW50ZWVyRnJvbUdyb3VwIiwiZGVsZXRlIiwiYWRkVXNlcnNUb0dyb3VwIiwidXNlcnMiLCJncm91cCIsInJlbW92ZVVzZXJzRnJvbUdyb3VwIiwic2VydmljZSIsIiR3aW5kb3ciLCJ0aGlzIiwibG9jYWxTdG9yYWdlIiwiand0IiwidXNlcklkIiwiX2lkIiwiY3VycmVudFVzZXIiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0VXNlcklkIiwiZ2V0VXNlciIsInBhcnNlIiwiYmFzZSIsIlVzZXJTZXJ2aWNlIiwiZ2V0VXNlcnMiLCJvcHRpb25zIiwidW5kZWZpbmVkIiwicGFnZSIsInNpemUiLCIkIiwicGFyYW0iLCJ0ZXh0IiwiY2hlY2tpbiIsImNoZWNrb3V0IiwiJHNjb3BlIiwiZ2V0UXVlcnkiLCJxdWVyeSIsImxlbmd0aCIsImN1cnJlbnRRdWVyeSIsInJlc2V0VXNlckxpc3QiLCJidXN5IiwibmV4dFBhZ2UiLCJ0b3RhbFBhZ2VzIiwidG90YWxVc2VycyIsImdldE5leHRQYWdlIiwibG9hZEZyb21SZXNwb25zZSIsImJpbmQiLCJjb25jYXQiLCIkc2VhcmNoIiwic3RpY2t5IiwiY29udGV4dCIsInNlYXJjaFVzZXJzIiwidGhpc1F1ZXJ5Iiwic2VsZWN0ZWRVc2VyIiwic2V0U2VsZWN0ZWRVc2VyIiwiJHVzZXJEZXRhaWxzIiwibW9kYWwiLCJzZWxlY3RlZEdyb3VwIiwic2VsZWN0R3JvdXAiLCJzZWxlY3RlZE5ld1ZvbHVudGVlciIsInZvbHVudGVlcnMiLCJzZXRTZWxlY3RlZE5ld1ZvbHVudGVlciIsIiRhcHBseSIsImFkZE5ld1ZvbHVudGVlciIsInNwbGljZSIsImZpbmRJbmRleCIsImVsZW0iLCJzZWFyY2giLCJhcGlTZXR0aW5ncyIsInJlc3BvbnNlQXN5bmMiLCJzZXR0aW5ncyIsInVybERhdGEiLCJzZXJ2ZXJSZXNwb25zZSIsInJlc3VsdHMiLCJtYXAiLCJwcm9maWxlIiwibmFtZSIsImRlc2NyaXB0aW9uIiwibWluQ2hhcmFjdGVycyIsIm9uU2VsZWN0Iiwic2VsZWN0aW9uIiwiQXV0aFNlcnZpY2UiLCJvblN1Y2Nlc3MiLCJvbkZhaWx1cmUiLCJsb2dpbiIsInN0YXRlcyIsImFkbWluT25seSIsImZpbHRlciIsImFkbWluIiwiY2xpY2siLCJjb25zdGFudCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsS0FBQUMsUUFBQUMsT0FBQSxXQUNBLGFBR0FGLEtBQUFHLFFBQ0EsZ0JBQ0EsU0FBQUMsRUFBQUMsR0FHQUQsRUFBQUUsYUFBQUMsS0FBQSx1QkFJQVAsSUFBQVEsUUFBQSxvQkFDQSxVQUNBLGFBQ0EsU0FBQUMsRUFBQUosR0FDQSxPQUNBSyxRQUFBLFNBQUFQLEdBQ0EsSUFBQUEsRUFBQVEsSUFBQUMsUUFBQSxTQUFBLElBQUFULEVBQUFRLElBQUFDLFFBQUEsV0FDQVQsRUFBQVEsSUFBQU4sRUFBQVEsU0FBQVYsRUFBQVEsSUFDQVIsRUFBQVcsUUFBQSwrQkFBQVQsRUFBQVEsU0FFQSxJQUFBRSxHQUFBTixFQUFBTyxVQUlBLE9BSEFELEtBQ0FaLEVBQUFXLFFBQUEsa0JBQUFDLEdBRUFaLE9BTUFILElBQUFpQixVQUFBLFNBQUEsYUFBQSxXQUNBLFNBQUFDLEVBQUFDLEdBQ0EsT0FDQUMsS0FBQSxXQUVBLEdBQUFDLEdBQUEsU0FBQUMsRUFBQUMsR0FFQUosRUFBQSxXQUNBRCxFQUFBTSxNQUFBRCxFQUFBRSxNQUFBRixFQUFBRSxLQUFBQyxVQUNBSCxFQUFBRSxLQUFBQyxVQUFBLGtCQUlBUixH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QUMsSUFBQSxVQUFBNUIsR0FHQXdGLEVBQUFrRCxNQUFBLFdBQ0FILEVBQUFsRyxrQkFDQW1ELEVBQUFsRCxNQUFBa0QsRUFBQWpELFVBQ0FFLEtBQUErRixFQUFBQyxPQ25CQWpLLFFBQUFDLE9BQUEsV0FDQThCLFdBQUEscUJBQ0EsU0FDQSxTQUNBLGFBQ0EsVUFDQSxTQUFBaUYsRUFBQXpFLEVBQUF0QixFQUFBVCxHQUNBLEdBQUE4QyxHQUFBOUMsRUFBQTBGLFNBRUFjLEdBQUFtRCxTQUVBVCxLQUFBLGNBQ0FuSSxNQUFBLFlBR0FtSSxLQUFBLGFBQ0FuSSxNQUFBLFNBQ0E2SSxXQUFBLElBRUFDLE9BQUEsU0FBQXhJLEdBQ0EsUUFBQUEsRUFBQXVJLFlBQUE5RyxFQUFBZ0gsU0FHQTNELEVBQUEsV0FBQTRELE1BQUEsV0FDQS9KLEVBQUE2RCxVQUFBSixLQUFBLFdBQ0ExQixFQUFBTyxHQUFBLGdCQ3RCQTlDLFFBQUFDLE9BQUEsV0FBQXVLLFNBQUEsY0FDQTVKLFNBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicsIFtcbiAgJ3VpLnJvdXRlcicsXG5dKTtcblxuYXBwLmNvbmZpZyhbXG4gICckaHR0cFByb3ZpZGVyJyxcbiAgZnVuY3Rpb24oJGh0dHBQcm92aWRlciwgU0VSVkVSX1VSTCkge1xuXG4gICAgLy8gYWRkIHJvb3QgdXJsIHRvIGFsbCBhcGkgYW5kIGF1dGggcmVxdWVzdHNcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBcGlBdXRoZW50aWNhdG9yJyk7XG4gIH1cbl0pO1xuXG5hcHAuZmFjdG9yeSgnQXBpQXV0aGVudGljYXRvcicsIFtcbiAgJ1Nlc3Npb24nLFxuICAnU0VSVkVSX1VSTCcsXG4gIGZ1bmN0aW9uKFNlc3Npb24sIFNFUlZFUl9VUkwpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVxdWVzdDogZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgICAgIGlmIChjb25maWcudXJsLmluZGV4T2YoJ2FwaS8nKSA9PT0gMCB8fCBjb25maWcudXJsLmluZGV4T2YoJ2F1dGgvJykgPT09IDApIHtcbiAgICAgICAgICBjb25maWcudXJsID0gU0VSVkVSX1VSTC5CQVNFX1VSTCArIGNvbmZpZy51cmw7XG4gICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbiddID0gU0VSVkVSX1VSTC5CQVNFX1VSTDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdG9rZW4gPSBTZXNzaW9uLmdldFRva2VuKCk7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWyd4LWFjY2Vzcy10b2tlbiddID0gdG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgIH1cbiAgICB9O1xuICB9XG5dKTtcblxuYXBwLmRpcmVjdGl2ZSgndGl0bGUnLCBbJyRyb290U2NvcGUnLCAnJHRpbWVvdXQnLFxuICBmdW5jdGlvbigkcm9vdFNjb3BlLCAkdGltZW91dCkge1xuICAgIHJldHVybiB7XG4gICAgICBsaW5rOiBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgbGlzdGVuZXIgPSBmdW5jdGlvbihldmVudCwgdG9TdGF0ZSkge1xuXG4gICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnRpdGxlID0gKHRvU3RhdGUuZGF0YSAmJiB0b1N0YXRlLmRhdGEucGFnZVRpdGxlKSA/XG4gICAgICAgICAgICAgIHRvU3RhdGUuZGF0YS5wYWdlVGl0bGUgOiAnRGVmYXVsdCB0aXRsZSc7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBsaXN0ZW5lcik7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb25maWcoW1xuICAgICckc3RhdGVQcm92aWRlcicsXG4gICAgJyR1cmxSb3V0ZXJQcm92aWRlcicsXG4gICAgZnVuY3Rpb24oXG4gICAgICAkc3RhdGVQcm92aWRlcixcbiAgICAgICR1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XG4gICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvbG9naW4vbG9naW4uaHRtbFwiLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHJlcXVpcmVMb2dpbjogZmFsc2UsXG4gICAgICAgICAgICAgIHBhZ2VUaXRsZTogJ0xvZ2luJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc3RhdGUoJ2FwcCcsIHtcbiAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgJ0AnOiB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvYmFzZS5odG1sXCIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICd0b29sYmFyQGFwcCc6IHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy90b29sYmFyL3Rvb2xiYXIuaHRtbFwiLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUb29sYmFyQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICByZXF1aXJlTG9naW46IHRydWUsXG4gICAgICAgICAgICAgIHBhZ2VUaXRsZTogJ0NoZWNraW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zdGF0ZSgnYXBwLmNoZWNraW4nLCB7XG4gICAgICAgICAgICB1cmw6ICcvY2hlY2tpbicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NoZWNraW4vY2hlY2tpbi5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDaGVja2luQ29udHJvbGxlcicsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc3RhdGUoJ2FwcC5ncm91cHMnLCB7XG4gICAgICAgICAgICB1cmw6ICcvZ3JvdXBzJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvZ3JvdXBzL2dyb3Vwcy5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdHcm91cHNDb250cm9sbGVyJyxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvY2hlY2tpbicpO1xuICAgIH1cbiAgXSlcbiAgLnJ1bihbXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbihcbiAgICAgICRyb290U2NvcGUsXG4gICAgICAkc3RhdGUsXG4gICAgICBTZXNzaW9uKXtcblxuICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcbiAgICAgIH0pO1xuXG4gICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zKSB7XG4gICAgICAgIHZhciByZXF1aXJlTG9naW4gPSB0b1N0YXRlLmRhdGEucmVxdWlyZUxvZ2luO1xuXG4gICAgICAgIGlmIChyZXF1aXJlTG9naW4gJiYgIVNlc3Npb24uZ2V0VG9rZW4oKSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKCFTZXNzaW9uLmdldFRva2VuKCkpIHtcbiAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgfVxuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5mYWN0b3J5KCdBdXRoU2VydmljZScsIFtcbiAgICAnJHEnLFxuICAgICckaHR0cCcsXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkcSwgJGh0dHAsICRyb290U2NvcGUsICRzdGF0ZSwgU2Vzc2lvbikge1xuICAgICAgdmFyIGF1dGhTZXJ2aWNlID0ge307XG4gICAgICB2YXIgYmFzZVVybCA9ICdhdXRoLyc7XG5cbiAgICAgIGZ1bmN0aW9uIGxvZ2luU3VjY2VzcyhyZXNwb25zZSkge1xuICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIGNvbnNvbGUubG9nKCdhdXRoIHN1Y2Nlc3MnLCBkYXRhKTtcbiAgICAgICAgU2Vzc2lvbi5jcmVhdGUoZGF0YS50b2tlbiwgZGF0YS51c2VyKTtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgICByZXNvbHZlKGRhdGEudXNlcik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBsb2dpbkZhaWx1cmUoZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2F1dGggZmFpbCcsIGRhdGEpO1xuICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICByZWplY3QoZGF0YSk7XG4gICAgICAgIH0pO1xuXG4gICAgICB9XG5cbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luV2l0aFBhc3N3b3JkID0gZnVuY3Rpb24oZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgIC5wb3N0KGJhc2VVcmwgKyAnbG9naW4nLCB7XG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbihsb2dpblN1Y2Nlc3MsIGxvZ2luRmFpbHVyZSk7XG4gICAgICB9O1xuXG4gICAgICAvLyBUT0RPIHVuc3VyZSBpZiB0aGlzIHdvcmtzIVxuICAgICAgYXV0aFNlcnZpY2UubG9naW5XaXRoVG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJOb3QgYWN0dWFsbHkgc3VyZSBpZiB0aGlzIHdvcmtzIHlldCFcIik7XG4gICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgIC5wb3N0KGJhc2VVcmwgKyAnbG9naW4nLCB7XG4gICAgICAgICAgICB0b2tlbjogdG9rZW5cbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKGxvZ2luU3VjY2VzcywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgU2Vzc2lvbi5kZXN0cm95KCkudGhlbihsb2dpbkZhaWx1cmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlO1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5mYWN0b3J5KCdHcm91cFNlcnZpY2UnLCBbXG4gICAgJyRxJyxcbiAgICAnJGh0dHAnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkcSwgJGh0dHAsIFNlc3Npb24pIHtcbiAgICAgIHZhciBncm91cHMgPSAnYXBpL2dyb3Vwcy8nO1xuXG4gICAgICB2YXIgR3JvdXBTZXJ2aWNlID0ge307XG5cbiAgICAgIEdyb3VwU2VydmljZS5nZXRHcm91cHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmdldChncm91cHMpO1xuICAgICAgfTtcblxuICAgICAgR3JvdXBTZXJ2aWNlLmNyZWF0ZUdyb3VwID0gZnVuY3Rpb24oZ3JvdXBOYW1lKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KGdyb3VwcywgeyBncm91cE5hbWU6IGdyb3VwTmFtZSB9KTtcbiAgICAgIH07XG5cbiAgICAgIEdyb3VwU2VydmljZS5nZXRWb2x1bnRlZXJzID0gZnVuY3Rpb24oZ3JvdXBJZCkge1xuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KGdyb3VwcyArIGdyb3VwSWQgKyAnL3ZvbHVudGVlcnMnKTtcbiAgICAgIH07XG5cbiAgICAgIEdyb3VwU2VydmljZS5hZGRWb2x1bnRlZXJUb0dyb3VwID0gZnVuY3Rpb24odm9sdW50ZWVySWQsIGdyb3VwSWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLnB1dChncm91cHMgKyBncm91cElkICsgJy92b2x1bnRlZXJzLycgKyB2b2x1bnRlZXJJZCk7XG4gICAgICB9O1xuXG4gICAgICBHcm91cFNlcnZpY2UucmVtb3ZlVm9sdW50ZWVyRnJvbUdyb3VwID0gZnVuY3Rpb24odm9sdW50ZWVySWQsIGdyb3VwSWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZShncm91cHMgKyBncm91cElkICsgJy92b2x1bnRlZXJzLycgKyB2b2x1bnRlZXJJZCk7XG4gICAgICB9O1xuXG4gICAgICBHcm91cFNlcnZpY2UuYWRkVXNlcnNUb0dyb3VwID0gZnVuY3Rpb24oZ3JvdXBJZCwgdXNlcnMpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLnB1dChncm91cCArIGdyb3VwSWQsIHVzZXJzKTtcbiAgICAgIH07XG5cbiAgICAgIEdyb3VwU2VydmljZS5yZW1vdmVVc2Vyc0Zyb21Hcm91cCA9IGZ1bmN0aW9uKGdyb3VwSWQsIHVzZXJzKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoZ3JvdXBzICsgZ3JvdXBJZCwgdXNlcnMpO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIEdyb3VwU2VydmljZTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuc2VydmljZSgnU2Vzc2lvbicsIFtcbiAgICAnJHJvb3RTY29wZScsXG4gICAgJyR3aW5kb3cnLFxuICAgICckcScsXG4gICAgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHdpbmRvdywgJHEpe1xuICAgICAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbih0b2tlbiwgdXNlcil7XG4gICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dCA9IHRva2VuO1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS51c2VySWQgPSB1c2VyLl9pZDtcbiAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIgPSBKU09OLnN0cmluZ2lmeSh1c2VyKTtcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbigpe1xuICAgICAgICBkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0O1xuICAgICAgICBkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2UudXNlcklkO1xuICAgICAgICBkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXI7XG4gICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0O1xuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRVc2VySWQgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudXNlcklkO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIpO1xuICAgICAgfTtcbiAgfV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBbXG4gICAgJyRxJyxcbiAgICAnJGh0dHAnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkcSwgJGh0dHAsIFNlc3Npb24pIHtcbiAgICAgIHZhciB1c2VycyA9ICdhcGkvdXNlcnMnO1xuICAgICAgdmFyIGJhc2UgPSB1c2VycyArICcvJztcblxuICAgICAgdmFyIFVzZXJTZXJ2aWNlID0ge307XG5cbiAgICAgIFVzZXJTZXJ2aWNlLmdldFVzZXJzID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBpZiAob3B0aW9ucy5wYWdlICE9PSB1bmRlZmluZWQgfHwgb3B0aW9ucy5zaXplICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBvcHRpb25zLnBhZ2UgPSBvcHRpb25zLnBhZ2UgfHwgMDtcbiAgICAgICAgICBvcHRpb25zLnNpemUgPSBvcHRpb25zLnNpemUgfHwgNTA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUT0RPIFthZGFpXSB5ZXMgdGhpcyBpcyBraW5kYSBkdW1iIGFuZCBzaG91bGQgYmUgYmV0dGVyXG4gICAgICAgIHZhciB1cmwgPSBvcHRpb25zID8gdXNlcnMgKyAnPycgKyAkLnBhcmFtKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRleHQ6IG9wdGlvbnMudGV4dCxcbiAgICAgICAgICAgIHBhZ2U6IG9wdGlvbnMucGFnZSxcbiAgICAgICAgICAgIHNpemU6IG9wdGlvbnMuc2l6ZSxcbiAgICAgICAgICAgIGdyb3VwOiBvcHRpb25zLmdyb3VwLFxuICAgICAgICAgIH0pIDogYmFzZTtcblxuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCk7XG4gICAgICB9O1xuXG4gICAgICBVc2VyU2VydmljZS5jaGVja2luID0gZnVuY3Rpb24odXNlcklkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KGJhc2UgKyB1c2VySWQgKyAnL2NoZWNraW4nKTtcbiAgICAgIH07XG5cbiAgICAgIFVzZXJTZXJ2aWNlLmNoZWNrb3V0ID0gZnVuY3Rpb24odXNlcklkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KGJhc2UgKyB1c2VySWQgKyAnL2NoZWNrb3V0Jyk7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gVXNlclNlcnZpY2U7XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmNvbnRyb2xsZXIoJ0NoZWNraW5Db250cm9sbGVyJywgW1xuICAgICckc2NvcGUnLFxuICAgICdVc2VyU2VydmljZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU2VydmljZSkge1xuXG4gICAgICB2YXIgJHNlYXJjaCA9ICQoJy51c2VyU2VhcmNoID4gLnN0aWNreScpO1xuICAgICAgJHNlYXJjaC5zdGlja3koe1xuICAgICAgICBjb250ZXh0OiAnLnVzZXJMaXN0ID4gdGFibGUnLFxuICAgICAgfSk7XG5cbiAgICAgIHZhciBjdXJyZW50UXVlcnkgPSBudWxsO1xuICAgICAgLy8gb25seSByZXR1cm4gbmV3IHF1ZXJ5IGlmIGxlbmd0aCA+PSAzLCBlbHNlIHJldHVyblxuICAgICAgZnVuY3Rpb24gZ2V0UXVlcnkoKSB7XG4gICAgICAgIGlmICghJHNjb3BlLnF1ZXJ5KSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLnF1ZXJ5Lmxlbmd0aCA+IDAgJiYgJHNjb3BlLnF1ZXJ5Lmxlbmd0aCA8IDMpIHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudFF1ZXJ5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAkc2NvcGUucXVlcnk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5zZWFyY2hVc2VycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcXVlcnkgPSBnZXRRdWVyeSgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInF1ZXJ5OlwiLCBxdWVyeSk7XG4gICAgICAgIGlmIChxdWVyeSA9PT0gY3VycmVudFF1ZXJ5KSB7IHJldHVybjsgfVxuXG4gICAgICAgIC8vIHRoaXMgaXMgYWxsIGEgbG93LWtleSB3b3JrYXJvdW5kIGZvciAkaHR0cCdzIGxhY2sgb2YgY2FuY2VsKClcbiAgICAgICAgLy9qc2hpbnQgLVcxMjBcbiAgICAgICAgdmFyIHRoaXNRdWVyeSA9IGN1cnJlbnRRdWVyeSA9IFVzZXJTZXJ2aWNlLmdldFVzZXJzKHtcbiAgICAgICAgICBwYWdlOiAwLCAvLyBpbmRpY2F0ZSB0aGF0IHdlIHdhbnQgdGhpcyB0byBiZSBwYWdlZCAoc2l6ZSBpcyBkZWZhdWx0IDUwKVxuICAgICAgICAgIHRleHQ6IHF1ZXJ5LFxuICAgICAgICB9KTtcbiAgICAgICAgLy9qc2hpbnQgK1cxMjBcbiAgICAgICAgdGhpc1F1ZXJ5LnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAvLyBpZiB0aGlzIGlzIG5vIGxvbmdlciB0aGUgbW9zdCByZWNlbnQgcXVlcnksIHRoZW4gaWdub3JlXG4gICAgICAgICAgaWYgKHRoaXNRdWVyeSAhPT0gY3VycmVudFF1ZXJ5KSB7IHJldHVybjsgfVxuICAgICAgICAgIHJlc2V0VXNlckxpc3QoKTtcbiAgICAgICAgICBsb2FkRnJvbVJlc3BvbnNlLmJpbmQoJHNjb3BlLnVzZXJzKShyZXNwb25zZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLnVzZXJzID0ge307XG4gICAgICBmdW5jdGlvbiByZXNldFVzZXJMaXN0KCkge1xuICAgICAgICAkc2NvcGUudXNlcnMgPSB7XG4gICAgICAgICAgdXNlcnM6IFtdLFxuICAgICAgICAgIGJ1c3k6IGZhbHNlLFxuICAgICAgICAgIG5leHRQYWdlOiAwLFxuICAgICAgICAgIHRvdGFsUGFnZXM6IDAsXG4gICAgICAgICAgdG90YWxVc2VyczogMCxcbiAgICAgICAgICBnZXROZXh0UGFnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5idXN5KSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICB0aGlzLmJ1c3kgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5uZXh0UGFnZSA9IHRoaXMubmV4dFBhZ2UgKyAxO1xuXG4gICAgICAgICAgICBVc2VyU2VydmljZS5nZXRVc2Vycyh7XG4gICAgICAgICAgICAgIHRleHQ6IGdldFF1ZXJ5KCksXG4gICAgICAgICAgICAgIHBhZ2U6IHRoaXMubmV4dFBhZ2UsXG4gICAgICAgICAgICB9KS50aGVuKGxvYWRGcm9tUmVzcG9uc2UuYmluZCh0aGlzKSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJlc2V0VXNlckxpc3QoKTtcblxuICAgICAgJHNjb3BlLnNlbGVjdGVkVXNlciA9IG51bGw7XG4gICAgICAkc2NvcGUuc2V0U2VsZWN0ZWRVc2VyID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICB2YXIgJHVzZXJEZXRhaWxzID0gJCgnLnVzZXJEZXRhaWxzJyk7XG4gICAgICAgICR1c2VyRGV0YWlscy5tb2RhbCgpO1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRVc2VyID0gdXNlcjtcbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAkdXNlckRldGFpbHMubW9kYWwoJ3Nob3cnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkdXNlckRldGFpbHMubW9kYWwoJ2hpZGUnKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgJHNjb3BlLnVzZXJzLmdldE5leHRQYWdlKCk7XG5cbiAgICAgIGZ1bmN0aW9uIGxvYWRGcm9tUmVzcG9uc2UocmVzcG9uc2UpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7XG5cbiAgICAgICAgdGhpcy51c2VycyA9IHRoaXMudXNlcnMuY29uY2F0KHJlc3BvbnNlLmRhdGEudXNlcnMpO1xuXG4gICAgICAgIHRoaXMudG90YWxVc2VycyA9IHJlc3BvbnNlLmRhdGEudG90YWxVc2VycztcbiAgICAgICAgdGhpcy50b3RhbFBhZ2VzID0gcmVzcG9uc2UuZGF0YS50b3RhbFBhZ2VzO1xuICAgICAgICB0aGlzLm5leHRQYWdlID0gdGhpcy5uZXh0UGFnZSArIDE7XG4gICAgICAgIHRoaXMuYnVzeSA9IGZhbHNlO1xuXG4gICAgICAgICRzZWFyY2guc3RpY2t5KCdyZWZyZXNoJyk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5jaGVja2luID0gZnVuY3Rpb24odXNlcklkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjaGVja2luJywgdXNlcklkKTtcbiAgICAgICAgLy8gVXNlclNlcnZpY2UuY2hlY2tpbih1c2VySWQpXG4gICAgICAgIC8vICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvLyAgICAgY29uc29sZS5sb2coJ2NoZWNrZWQgaW4nLCBkYXRhKTtcbiAgICAgICAgLy8gICB9KTtcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5jaGVja291dCA9IGZ1bmN0aW9uKHVzZXJJZCkge1xuICAgICAgICBjb25zb2xlLmxvZygnY2hlY2tvdXQnLCB1c2VySWQpO1xuICAgICAgICAvLyBVc2VyU2VydmljZS5jaGVja291dCh1c2VySWQpXG4gICAgICAgIC8vICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvLyAgICAgY29uc29sZS5sb2coJ2NoZWNrZWQgb3V0JywgZGF0YSk7XG4gICAgICAgIC8vICAgfSk7XG4gICAgICB9O1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb250cm9sbGVyKCdHcm91cHNDb250cm9sbGVyJywgW1xuICAgICckc2NvcGUnLFxuICAgICdVc2VyU2VydmljZScsXG4gICAgJ0dyb3VwU2VydmljZScsXG4gICAgZnVuY3Rpb24gKCRzY29wZSwgVXNlclNlcnZpY2UsIEdyb3VwU2VydmljZSkge1xuICAgICAgJHNjb3BlLmdyb3VwcyA9IFtdO1xuXG4gICAgICAkc2NvcGUuZ2V0R3JvdXBzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIEdyb3VwU2VydmljZS5nZXRHcm91cHMoKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgJHNjb3BlLmdyb3VwcyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgICRzY29wZS5nZXRHcm91cHMoKTtcblxuICAgICAgJHNjb3BlLmNyZWF0ZUdyb3VwID0gZnVuY3Rpb24oZ3JvdXBOYW1lKSB7XG4gICAgICAgIGlmICghZ3JvdXBOYW1lKSB7IHJldHVybjsgfVxuXG4gICAgICAgIEdyb3VwU2VydmljZS5jcmVhdGVHcm91cChncm91cE5hbWUpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAkc2NvcGUuZ3JvdXBzLnB1c2gocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLnNlbGVjdGVkR3JvdXAgPSBudWxsO1xuICAgICAgJHNjb3BlLnNlbGVjdEdyb3VwID0gZnVuY3Rpb24oZ3JvdXApIHtcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkTmV3Vm9sdW50ZWVyID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkR3JvdXAgPSBncm91cDtcbiAgICAgICAgR3JvdXBTZXJ2aWNlLmdldFZvbHVudGVlcnMoZ3JvdXAuX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgJHNjb3BlLnNlbGVjdGVkR3JvdXAudm9sdW50ZWVycyA9IHJlc3BvbnNlLmRhdGEudm9sdW50ZWVycztcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUuc2VsZWN0ZWROZXdWb2x1bnRlZXIgPSBudWxsO1xuICAgICAgJHNjb3BlLnNldFNlbGVjdGVkTmV3Vm9sdW50ZWVyID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWROZXdWb2x1bnRlZXIgPSB1c2VyO1xuICAgICAgICAvLyBmb3JjZSB1aSByZWZyZXNoIChvdGhlcndpc2Ugd2FpdCB1bnRpbCBhbm90aGVyIGV2ZW50IGZpcmVzKVxuICAgICAgICAvLyBvbmx5IHdoZW4gdGhpcyBpcyBpbml0aWF0ZWQgYnkgdGhlIHNlYXJjaFxuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgJHNjb3BlLmFkZE5ld1ZvbHVudGVlciA9IGZ1bmN0aW9uKHVzZXIsIGdyb3VwKSB7XG4gICAgICAgIEdyb3VwU2VydmljZS5hZGRWb2x1bnRlZXJUb0dyb3VwKHVzZXIuX2lkLCBncm91cC5faWQpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEdyb3VwLnZvbHVudGVlcnMucHVzaChyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgICRzY29wZS5zZXRTZWxlY3RlZE5ld1ZvbHVudGVlcihudWxsKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5yZW1vdmVWb2x1bnRlZXJGcm9tR3JvdXAgPSBmdW5jdGlvbih1c2VyLCBncm91cCkge1xuICAgICAgICBHcm91cFNlcnZpY2UucmVtb3ZlVm9sdW50ZWVyRnJvbUdyb3VwKHVzZXIuX2lkLCBncm91cC5faWQpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEdyb3VwLnZvbHVudGVlcnMuc3BsaWNlKFxuICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cC52b2x1bnRlZXJzLmZpbmRJbmRleChmdW5jdGlvbihlbGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uX2lkID09PSByZXNwb25zZS5kYXRhLl9pZDtcbiAgICAgICAgICAgICAgfSksIDEpO1xuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgLy8gVE9ETyBtb3ZlIHRoaXMgdG8gYSBkaXJlY3RpdmVcbiAgICAgICQoJy5hZGQtdm9sdW50ZWVyJykuc2VhcmNoKHtcbiAgICAgICAgYXBpU2V0dGluZ3M6IHtcbiAgICAgICAgICByZXNwb25zZUFzeW5jOiBmdW5jdGlvbihzZXR0aW5ncywgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBxdWVyeSA9IHNldHRpbmdzLnVybERhdGEucXVlcnk7XG4gICAgICAgICAgICBVc2VyU2VydmljZS5nZXRVc2Vycyh7dGV4dDogc2V0dGluZ3MudXJsRGF0YS5xdWVyeX0pXG4gICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHNlcnZlclJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0cyA9IHNlcnZlclJlc3BvbnNlLmRhdGEudXNlcnMubWFwKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB1c2VyLnByb2ZpbGUubmFtZSB8fCB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdXNlci5wcm9maWxlLm5hbWUgPyB1c2VyLmVtYWlsIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1c2VyOiB1c2VyLFxuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBtaW5DaGFyYWN0ZXJzIDogMyxcbiAgICAgICAgb25TZWxlY3Q6IGZ1bmN0aW9uKHNlbGVjdGlvbikge1xuICAgICAgICAgICRzY29wZS5zZXRTZWxlY3RlZE5ld1ZvbHVudGVlcihzZWxlY3Rpb24udXNlcik7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgW1xuICAgICckc2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICdBdXRoU2VydmljZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIEF1dGhTZXJ2aWNlKSB7XG5cbiAgICAgIGZ1bmN0aW9uIG9uU3VjY2VzcyhkYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzdWNjZXNzJywgZGF0YSk7XG4gICAgICAgICRzdGF0ZS5nbygnYXBwLmNoZWNraW4nKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gb25GYWlsdXJlKGRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2ZhaWx1cmUnLCBkYXRhKTtcbiAgICAgIH1cblxuICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIEF1dGhTZXJ2aWNlLmxvZ2luV2l0aFBhc3N3b3JkKFxuICAgICAgICAgICRzY29wZS5lbWFpbCwgJHNjb3BlLnBhc3N3b3JkXG4gICAgICAgICkudGhlbihvblN1Y2Nlc3MsIG9uRmFpbHVyZSk7XG4gICAgICB9O1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb250cm9sbGVyKCdUb29sYmFyQ29udHJvbGxlcicsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlJyxcbiAgICAnJHJvb3RTY29wZScsXG4gICAgJ1Nlc3Npb24nLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCAkcm9vdFNjb3BlLCBTZXNzaW9uKSB7XG4gICAgICB2YXIgdXNlciA9IFNlc3Npb24uZ2V0VXNlcigpO1xuXG4gICAgICAkc2NvcGUuc3RhdGVzID0gKFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdhcHAuY2hlY2tpbicsXG4gICAgICAgICAgdGl0bGU6ICdDaGVja2luJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdhcHAuZ3JvdXBzJyxcbiAgICAgICAgICB0aXRsZTogJ0dyb3VwcycsXG4gICAgICAgICAgYWRtaW5Pbmx5OiB0cnVlLFxuICAgICAgICB9XG4gICAgICBdKS5maWx0ZXIoZnVuY3Rpb24oc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuICEoc3RhdGUuYWRtaW5Pbmx5ICYmICF1c2VyLmFkbWluKTtcbiAgICAgIH0pO1xuXG4gICAgICAkKCcubG9nb3V0JykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgIFNlc3Npb24uZGVzdHJveSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgXSk7XG4iLCIvKipcbiAqIEhlcmUgbGF5IHRoZSBiYXNlIHVybHMgdXNlZCBpbiB0aGUgaHR0cCB1cmwgaW5qZWN0b3JcbiAqL1xuYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKS5jb25zdGFudCgnU0VSVkVSX1VSTCcsIHtcbiAgQkFTRV9VUkw6ICAnaHR0cHM6Ly9jZTRlNzU3MS5uZ3Jvay5pby8nLFxuICAvLyBCQVNFX1VSTDogICdodHRwczovL2FwcGx5LmhhY2tndC5jb20vJyxcblxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
