var app=angular.module("checkin",["ui.router","infinite-scroll"]);app.config(["$httpProvider",function(e,t){e.interceptors.push("ApiAuthenticator")}]),app.factory("ApiAuthenticator",["Session","SERVER_URL",function(e,t){return{request:function(n){0!==n.url.indexOf("api/")&&0!==n.url.indexOf("auth/")||(n.url=t.BASE_URL+n.url,n.headers["Access-Control-Allow-Origin"]=t.BASE_URL);var o=e.getToken();return o&&(n.headers["x-access-token"]=o),n}}}]),angular.module("checkin").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("login",{url:"/login",templateUrl:"views/login/login.html",controller:"LoginController"}).state("checkin",{url:"/checkin",templateUrl:"views/checkin/checkin.html",controller:"CheckinController"})}]),angular.module("checkin").service("Session",["$rootScope","$window","$q",function(e,t,n){this.create=function(n,o){t.localStorage.jwt=n,t.localStorage.userId=o._id,t.localStorage.currentUser=JSON.stringify(o),e.currentUser=o},this.destroy=function(){return delete t.localStorage.jwt,delete t.localStorage.userId,delete t.localStorage.currentUser,e.currentUser=null,n(function(e,t){e()})},this.getToken=function(){return t.localStorage.jwt},this.getUserId=function(){return t.localStorage.userId},this.getUser=function(){return JSON.parse(t.localStorage.currentUser)}}]),angular.module("checkin").factory("AuthService",["$q","$http","$rootScope","$state","Session",function(e,t,n,o,r){function c(t){var n=t.data;return console.log("auth success",n),r.create(n.token,n.user),e(function(e){e(n.user)})}function i(t,n){return console.log("auth fail",t),o.go("login"),e(function(e,n){n(t)})}var s={},u="auth/";return s.loginWithPassword=function(e,n){return t.post(u+"login",{email:e,password:n}).then(c,i)},s.loginWithToken=function(e){return console.warn("Not actually sure if this works yet!"),t.post(u+"login",{token:e}).then(c,function(){400===status&&r.destroy().then(i)})},s}]),angular.module("checkin").factory("UserService",["$q","$http","Session",function(e,t,n){var o="api/users",r=o+"/",c={};return c.getUsers=function(e){var n=e?o+"?"+$.param({text:e.text,page:e.page?e.page:0,size:e.size?e.size:50}):r;return t.get(n)},c.checkin=function(e){return t.post(r+e+"/checkin")},c.checkout=function(e){return t.post(r+e+"/checkout")},c}]),angular.module("checkin").controller("CheckinController",["$scope","UserService",function(e,t){e.users={users:[],busy:!1,nextPage:0,totalPages:1/0},e.selectedUser=null,e.setSelectedUser=function(t){var n=$(".ui.modal.userDetails");n.modal(),e.selectedUser=t,t?n.modal("show"):n.modal("hide")},e.users.getNextPage=function(){this.busy||this.nextPage>=this.totalPages||(this.busy=!0,t.getUsers({page:this.nextPage}).then(function(e){console.log(e.data),this.users=this.users.concat(e.data.users),this.totalPages=e.data.totalPages,this.nextPage+=1,this.busy=!1}.bind(this)))},e.checkin=function(e){t.checkin(e).then(function(e){console.log("checked in",e)})},e.checkout=function(e){t.checkout(e).then(function(e){console.log("checked out",e)})}}]),angular.module("checkin").controller("LoginController",["$scope","AuthService",function(e,t){function n(e){console.log("success",e)}function o(e){console.log("failure",e)}e.login=function(){t.loginWithPassword(e.email,e.password).then(n,o)}}]),angular.module("checkin").constant("SERVER_URL",{BASE_URL:"https://a8fe9a69.ngrok.io/"});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJvdXRlcy5qcyIsInNlc3Npb24vU2Vzc2lvbi5qcyIsImF1dGgvQXV0aFNlcnZpY2UuanMiLCJ1c2Vycy9Vc2VyU2VydmljZS5qcyIsImNoZWNraW4vY2hlY2tpbkNvbnRyb2xsZXIuanMiLCJsb2dpbi9sb2dpbkNvbnRyb2xsZXIuanMiLCJjb25maWcuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRodHRwUHJvdmlkZXIiLCJTRVJWRVJfVVJMIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsImZhY3RvcnkiLCJTZXNzaW9uIiwicmVxdWVzdCIsInVybCIsImluZGV4T2YiLCJCQVNFX1VSTCIsImhlYWRlcnMiLCJ0b2tlbiIsImdldFRva2VuIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInNlcnZpY2UiLCIkcm9vdFNjb3BlIiwiJHdpbmRvdyIsIiRxIiwidGhpcyIsImNyZWF0ZSIsInVzZXIiLCJsb2NhbFN0b3JhZ2UiLCJqd3QiLCJ1c2VySWQiLCJfaWQiLCJjdXJyZW50VXNlciIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZXN0cm95IiwicmVzb2x2ZSIsInJlamVjdCIsImdldFVzZXJJZCIsImdldFVzZXIiLCJwYXJzZSIsIiRodHRwIiwiJHN0YXRlIiwibG9naW5TdWNjZXNzIiwicmVzcG9uc2UiLCJkYXRhIiwiY29uc29sZSIsImxvZyIsImxvZ2luRmFpbHVyZSIsImNhbGxiYWNrIiwiZ28iLCJhdXRoU2VydmljZSIsImJhc2VVcmwiLCJsb2dpbldpdGhQYXNzd29yZCIsImVtYWlsIiwicGFzc3dvcmQiLCJwb3N0IiwidGhlbiIsImxvZ2luV2l0aFRva2VuIiwid2FybiIsInN0YXR1cyIsInVzZXJzIiwiYmFzZSIsIlVzZXJTZXJ2aWNlIiwiZ2V0VXNlcnMiLCJvcHRpb25zIiwiJCIsInBhcmFtIiwidGV4dCIsInBhZ2UiLCJzaXplIiwiZ2V0IiwiY2hlY2tpbiIsImNoZWNrb3V0IiwiJHNjb3BlIiwiYnVzeSIsIm5leHRQYWdlIiwidG90YWxQYWdlcyIsIkluZmluaXR5Iiwic2VsZWN0ZWRVc2VyIiwic2V0U2VsZWN0ZWRVc2VyIiwiJHVzZXJEZXRhaWxzIiwibW9kYWwiLCJnZXROZXh0UGFnZSIsImNvbmNhdCIsImJpbmQiLCJBdXRoU2VydmljZSIsIm9uU3VjY2VzcyIsIm9uRmFpbHVyZSIsImxvZ2luIiwiY29uc3RhbnQiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsV0FDQSxZQUNBLG1CQUdBRixLQUFBRyxRQUNBLGdCQUNBLFNBQUFDLEVBQUFDLEdBR0FELEVBQUFFLGFBQUFDLEtBQUEsdUJBSUFQLElBQUFRLFFBQUEsb0JBQ0EsVUFDQSxhQUNBLFNBQUFDLEVBQUFKLEdBQ0EsT0FDQUssUUFBQSxTQUFBUCxHQUNBLElBQUFBLEVBQUFRLElBQUFDLFFBQUEsU0FBQSxJQUFBVCxFQUFBUSxJQUFBQyxRQUFBLFdBQ0FULEVBQUFRLElBQUFOLEVBQUFRLFNBQUFWLEVBQUFRLElBQ0FSLEVBQUFXLFFBQUEsK0JBQUFULEVBQUFRLFNBRUEsSUFBQUUsR0FBQU4sRUFBQU8sVUFJQSxPQUhBRCxLQUNBWixFQUFBVyxRQUFBLGtCQUFBQyxHQUVBWixPQzVCQUYsUUFBQUMsT0FBQSxXQUNBQyxRQUNBLGlCQUNBLHFCQUNBLFNBQ0FjLEVBQ0FDLEdBQ0FELEVBQ0FFLE1BQUEsU0FDQVIsSUFBQSxTQUNBUyxZQUFBLHlCQUNBQyxXQUFBLG9CQUVBRixNQUFBLFdBQ0FSLElBQUEsV0FDQVMsWUFBQSw2QkFDQUMsV0FBQSx5QkNoQkFwQixRQUFBQyxPQUFBLFdBQ0FvQixRQUFBLFdBQ0EsYUFDQSxVQUNBLEtBQ0EsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQUMsS0FBQUMsT0FBQSxTQUFBWixFQUFBYSxHQUNBSixFQUFBSyxhQUFBQyxJQUFBZixFQUNBUyxFQUFBSyxhQUFBRSxPQUFBSCxFQUFB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cEMsS0FBQW9DLE1BQUF1QixPQUFBeEMsRUFBQUMsS0FBQWdCLE9BRUFwQyxLQUFBb0QsV0FBQWpDLEVBQUFDLEtBQUFnQyxXQUNBcEQsS0FBQW1ELFVBQUEsRUFDQW5ELEtBQUFrRCxNQUFBLEdBQ0FVLEtBQUE1RCxTQUlBaUQsRUFBQUYsUUFBQSxTQUFBMUMsR0FDQWlDLEVBQUFTLFFBQUExQyxHQUNBMkIsS0FBQSxTQUFBWixHQUNBQyxRQUFBQyxJQUFBLGFBQUFGLE1BSUE2QixFQUFBRCxTQUFBLFNBQUEzQyxHQUNBaUMsRUFBQVUsU0FBQTNDLEdBQ0EyQixLQUFBLFNBQUFaLEdBQ0FDLFFBQUFDLElBQUEsY0FBQUYsU0N4REE3QyxRQUFBQyxPQUFBLFdBQ0FtQixXQUFBLG1CQUNBLFNBQ0EsY0FDQSxTQUFBc0QsRUFBQVksR0FFQSxRQUFBQyxHQUFBMUMsR0FDQUMsUUFBQUMsSUFBQSxVQUFBRixHQUdBLFFBQUEyQyxHQUFBM0MsR0FDQUMsUUFBQUMsSUFBQSxVQUFBRixHQUdBNkIsRUFBQWUsTUFBQSxXQUNBSCxFQUFBakMsa0JBQ0FxQixFQUFBcEIsTUFBQW9CLEVBQUFuQixVQUNBRSxLQUFBOEIsRUFBQUMsT0NkQXhGLFFBQUFDLE9BQUEsV0FBQXlGLFNBQUEsY0FDQTlFLFNBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicsIFtcbiAgJ3VpLnJvdXRlcicsXG4gICdpbmZpbml0ZS1zY3JvbGwnLFxuXSk7XG5cbmFwcC5jb25maWcoW1xuICAnJGh0dHBQcm92aWRlcicsXG4gIGZ1bmN0aW9uKCRodHRwUHJvdmlkZXIsIFNFUlZFUl9VUkwpIHtcblxuICAgIC8vIGFkZCByb290IHVybCB0byBhbGwgYXBpIGFuZCBhdXRoIHJlcXVlc3RzXG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXBpQXV0aGVudGljYXRvcicpO1xuICB9XG5dKTtcblxuYXBwLmZhY3RvcnkoJ0FwaUF1dGhlbnRpY2F0b3InLCBbXG4gICdTZXNzaW9uJyxcbiAgJ1NFUlZFUl9VUkwnLFxuICBmdW5jdGlvbihTZXNzaW9uLCBTRVJWRVJfVVJMKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgICAgICBpZiAoY29uZmlnLnVybC5pbmRleE9mKCdhcGkvJykgPT09IDAgfHwgY29uZmlnLnVybC5pbmRleE9mKCdhdXRoLycpID09PSAwKSB7XG4gICAgICAgICAgY29uZmlnLnVybCA9IFNFUlZFUl9VUkwuQkFTRV9VUkwgKyBjb25maWcudXJsO1xuICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nXSA9IFNFUlZFUl9VUkwuQkFTRV9VUkw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRva2VuID0gU2Vzc2lvbi5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICBjb25maWcuaGVhZGVyc1sneC1hY2Nlc3MtdG9rZW4nXSA9IHRva2VuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb25maWcoW1xuICAgICckc3RhdGVQcm92aWRlcicsXG4gICAgJyR1cmxSb3V0ZXJQcm92aWRlcicsXG4gICAgZnVuY3Rpb24oXG4gICAgICAkc3RhdGVQcm92aWRlcixcbiAgICAgICR1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XG4gICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvbG9naW4vbG9naW4uaHRtbFwiLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc3RhdGUoJ2NoZWNraW4nLCB7XG4gICAgICAgICAgICB1cmw6ICcvY2hlY2tpbicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NoZWNraW4vY2hlY2tpbi5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDaGVja2luQ29udHJvbGxlcicsXG4gICAgICAgICAgfSk7XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLnNlcnZpY2UoJ1Nlc3Npb24nLCBbXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckd2luZG93JyxcbiAgICAnJHEnLFxuICAgIGZ1bmN0aW9uKCRyb290U2NvcGUsICR3aW5kb3csICRxKXtcbiAgICAgIHRoaXMuY3JlYXRlID0gZnVuY3Rpb24odG9rZW4sIHVzZXIpe1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3QgPSB0b2tlbjtcbiAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UudXNlcklkID0gdXNlci5faWQ7XG4gICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyID0gSlNPTi5zdHJpbmdpZnkodXNlcik7XG4gICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgZGVsZXRlICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dDtcbiAgICAgICAgZGVsZXRlICR3aW5kb3cubG9jYWxTdG9yYWdlLnVzZXJJZDtcbiAgICAgICAgZGVsZXRlICR3aW5kb3cubG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyO1xuICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmdldFRva2VuID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dDtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZ2V0VXNlcklkID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLnVzZXJJZDtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZ2V0VXNlciA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cubG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyKTtcbiAgICAgIH07XG4gIH1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmZhY3RvcnkoJ0F1dGhTZXJ2aWNlJywgW1xuICAgICckcScsXG4gICAgJyRodHRwJyxcbiAgICAnJHJvb3RTY29wZScsXG4gICAgJyRzdGF0ZScsXG4gICAgJ1Nlc3Npb24nLFxuICAgIGZ1bmN0aW9uKCRxLCAkaHR0cCwgJHJvb3RTY29wZSwgJHN0YXRlLCBTZXNzaW9uKSB7XG4gICAgICB2YXIgYXV0aFNlcnZpY2UgPSB7fTtcbiAgICAgIHZhciBiYXNlVXJsID0gJ2F1dGgvJztcblxuICAgICAgZnVuY3Rpb24gbG9naW5TdWNjZXNzKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgY29uc29sZS5sb2coJ2F1dGggc3VjY2VzcycsIGRhdGEpO1xuICAgICAgICBTZXNzaW9uLmNyZWF0ZShkYXRhLnRva2VuLCBkYXRhLnVzZXIpO1xuICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICAgIHJlc29sdmUoZGF0YS51c2VyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGxvZ2luRmFpbHVyZShkYXRhLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zb2xlLmxvZygnYXV0aCBmYWlsJywgZGF0YSk7XG4gICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIHJlamVjdChkYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIH1cblxuICAgICAgYXV0aFNlcnZpY2UubG9naW5XaXRoUGFzc3dvcmQgPSBmdW5jdGlvbihlbWFpbCwgcGFzc3dvcmQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwXG4gICAgICAgICAgLnBvc3QoYmFzZVVybCArICdsb2dpbicsIHtcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKGxvZ2luU3VjY2VzcywgbG9naW5GYWlsdXJlKTtcbiAgICAgIH07XG5cbiAgICAgIC8vIFRPRE8gdW5zdXJlIGlmIHRoaXMgd29ya3MhXG4gICAgICBhdXRoU2VydmljZS5sb2dpbldpdGhUb2tlbiA9IGZ1bmN0aW9uKHRva2VuKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIk5vdCBhY3R1YWxseSBzdXJlIGlmIHRoaXMgd29ya3MgeWV0IVwiKTtcbiAgICAgICAgcmV0dXJuICRodHRwXG4gICAgICAgICAgLnBvc3QoYmFzZVVybCArICdsb2dpbicsIHtcbiAgICAgICAgICAgIHRva2VuOiB0b2tlblxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4obG9naW5TdWNjZXNzLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICBTZXNzaW9uLmRlc3Ryb3koKS50aGVuKGxvZ2luRmFpbHVyZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gYXV0aFNlcnZpY2U7XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmZhY3RvcnkoJ1VzZXJTZXJ2aWNlJywgW1xuICAgICckcScsXG4gICAgJyRodHRwJyxcbiAgICAnU2Vzc2lvbicsXG4gICAgZnVuY3Rpb24oJHEsICRodHRwLCBTZXNzaW9uKSB7XG4gICAgICB2YXIgdXNlcnMgPSAnYXBpL3VzZXJzJztcbiAgICAgIHZhciBiYXNlID0gdXNlcnMgKyAnLyc7XG5cbiAgICAgIHZhciBVc2VyU2VydmljZSA9IHt9O1xuXG4gICAgICBVc2VyU2VydmljZS5nZXRVc2VycyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHVybCA9IG9wdGlvbnMgPyB1c2VycyArICc/JyArICQucGFyYW0oXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogb3B0aW9ucy50ZXh0LFxuICAgICAgICAgICAgcGFnZTogb3B0aW9ucy5wYWdlID8gb3B0aW9ucy5wYWdlIDogMCxcbiAgICAgICAgICAgIHNpemU6IG9wdGlvbnMuc2l6ZSA/IG9wdGlvbnMuc2l6ZSA6IDUwXG4gICAgICAgICAgfSkgOiBiYXNlO1xuXG4gICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKTtcbiAgICAgIH07XG5cbiAgICAgIFVzZXJTZXJ2aWNlLmNoZWNraW4gPSBmdW5jdGlvbih1c2VySWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoYmFzZSArIHVzZXJJZCArICcvY2hlY2tpbicpO1xuICAgICAgfTtcblxuICAgICAgVXNlclNlcnZpY2UuY2hlY2tvdXQgPSBmdW5jdGlvbih1c2VySWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoYmFzZSArIHVzZXJJZCArICcvY2hlY2tvdXQnKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBVc2VyU2VydmljZTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuY29udHJvbGxlcignQ2hlY2tpbkNvbnRyb2xsZXInLCBbXG4gICAgJyRzY29wZScsXG4gICAgJ1VzZXJTZXJ2aWNlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsIFVzZXJTZXJ2aWNlKSB7XG5cbiAgICAgICRzY29wZS51c2VycyA9IHtcbiAgICAgICAgdXNlcnM6IFtdLFxuICAgICAgICBidXN5OiBmYWxzZSxcbiAgICAgICAgbmV4dFBhZ2U6IDAsXG4gICAgICAgIHRvdGFsUGFnZXM6IEluZmluaXR5LFxuICAgICAgfTtcblxuICAgICAgJHNjb3BlLnNlbGVjdGVkVXNlciA9IG51bGw7XG4gICAgICAkc2NvcGUuc2V0U2VsZWN0ZWRVc2VyID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICB2YXIgJHVzZXJEZXRhaWxzID0gJCgnLnVpLm1vZGFsLnVzZXJEZXRhaWxzJyk7XG4gICAgICAgICR1c2VyRGV0YWlscy5tb2RhbCgpO1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRVc2VyID0gdXNlcjtcbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAkdXNlckRldGFpbHMubW9kYWwoJ3Nob3cnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkdXNlckRldGFpbHMubW9kYWwoJ2hpZGUnKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuXG4gICAgICAkc2NvcGUudXNlcnMuZ2V0TmV4dFBhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuYnVzeSkgeyByZXR1cm47IH1cbiAgICAgICAgaWYgKHRoaXMubmV4dFBhZ2UgPj0gdGhpcy50b3RhbFBhZ2VzKSB7IHJldHVybjsgfVxuXG4gICAgICAgIHRoaXMuYnVzeSA9IHRydWU7XG5cbiAgICAgICAgVXNlclNlcnZpY2UuZ2V0VXNlcnMoe1xuICAgICAgICAgIHBhZ2U6IHRoaXMubmV4dFBhZ2UsXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTtcblxuICAgICAgICAgIHRoaXMudXNlcnMgPSB0aGlzLnVzZXJzLmNvbmNhdChyZXNwb25zZS5kYXRhLnVzZXJzKTtcblxuICAgICAgICAgIHRoaXMudG90YWxQYWdlcyA9IHJlc3BvbnNlLmRhdGEudG90YWxQYWdlcztcbiAgICAgICAgICB0aGlzLm5leHRQYWdlICs9IDE7XG4gICAgICAgICAgdGhpcy5idXN5ID0gZmFsc2U7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICB9O1xuXG5cbiAgICAgICRzY29wZS5jaGVja2luID0gZnVuY3Rpb24odXNlcklkKSB7XG4gICAgICAgIFVzZXJTZXJ2aWNlLmNoZWNraW4odXNlcklkKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGVja2VkIGluJywgZGF0YSk7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUuY2hlY2tvdXQgPSBmdW5jdGlvbih1c2VySWQpIHtcbiAgICAgICAgVXNlclNlcnZpY2UuY2hlY2tvdXQodXNlcklkKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGVja2VkIG91dCcsIGRhdGEpO1xuICAgICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgW1xuICAgICckc2NvcGUnLFxuICAgICdBdXRoU2VydmljZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCBBdXRoU2VydmljZSkge1xuXG4gICAgICBmdW5jdGlvbiBvblN1Y2Nlc3MoZGF0YSkge1xuICAgICAgICBjb25zb2xlLmxvZygnc3VjY2VzcycsIGRhdGEpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBvbkZhaWx1cmUoZGF0YSkge1xuICAgICAgICBjb25zb2xlLmxvZygnZmFpbHVyZScsIGRhdGEpO1xuICAgICAgfVxuXG4gICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgQXV0aFNlcnZpY2UubG9naW5XaXRoUGFzc3dvcmQoXG4gICAgICAgICAgJHNjb3BlLmVtYWlsLCAkc2NvcGUucGFzc3dvcmRcbiAgICAgICAgKS50aGVuKG9uU3VjY2Vzcywgb25GYWlsdXJlKTtcbiAgICAgIH07XG4gICAgfVxuICBdKTtcbiIsIi8qKlxuICogSGVyZSBsYXkgdGhlIGJhc2UgdXJscyB1c2VkIGluIHRoZSBodHRwIHVybCBpbmplY3RvclxuICovXG5hbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpLmNvbnN0YW50KCdTRVJWRVJfVVJMJywge1xuICBCQVNFX1VSTDogICdodHRwczovL2E4ZmU5YTY5Lm5ncm9rLmlvLycsXG4gIC8vIEJBU0VfVVJMOiAgJ2h0dHBzOi8vYXBwbHkuaGFja2d0LmNvbS8nLFxuXG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
