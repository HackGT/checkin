var app=angular.module("checkin",["ui.router"]);app.config(["$httpProvider",function(e,t){e.interceptors.push("ApiAuthenticator")}]),app.factory("ApiAuthenticator",["Session","SERVER_URL",function(e,t){return{request:function(n){0!==n.url.indexOf("api/")&&0!==n.url.indexOf("auth/")||(n.url=t.BASE_URL+n.url,n.headers["Access-Control-Allow-Origin"]=t.BASE_URL);var r=e.getToken();return r&&(n.headers["x-access-token"]=r),n}}}]),app.directive("title",["$rootScope","$timeout",function(e,t){return{link:function(){var n=function(n,r){t(function(){e.title=r.data&&r.data.pageTitle?r.data.pageTitle:"Default title"})};e.$on("$stateChangeSuccess",n)}}}]),angular.module("checkin").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("login",{url:"/login",templateUrl:"views/login/login.html",controller:"LoginController",data:{requireLogin:!1,pageTitle:"Login"}}).state("app",{abstract:!0,views:{"@":{templateUrl:"views/base.html"},"toolbar@app":{templateUrl:"views/toolbar/toolbar.html",controller:"ToolbarController"}},data:{requireLogin:!0,pageTitle:"Checkin"}}).state("app.checkin",{url:"/checkin",templateUrl:"views/checkin/checkin.html",controller:"CheckinController"}).state("app.groups",{url:"/groups",templateUrl:"views/groups/groups.html",controller:"GroupsController"}),t.otherwise("/checkin")}]).run(["$rootScope","$state","Session",function(e,t,n){e.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0}),e.$on("$stateChangeStart",function(e,r,o){var u=r.data.requireLogin;u&&!n.getToken()&&(e.preventDefault(),t.go("login"))}),n.getToken()||t.go("login")}]),angular.module("checkin").factory("AuthService",["$q","$http","$rootScope","$state","Session",function(e,t,n,r,o){function u(t){var n=t.data;return console.log("auth success",n),o.create(n.token,n.user),e(function(e){e(n.user)})}function s(t,n){return console.log("auth fail",t),r.go("login"),e(function(e,n){n(t)})}var c={},i="auth/";return c.loginWithPassword=function(e,n){return t.post(i+"login",{email:e,password:n}).then(function(e){if(user=e.data.user,!(user.admin||user.checkin&&(user.checkin.groups.length>0||user.checkin.all)))throw new Error("User is not an admin or volunteer");return e}).then(u,s)},c.loginWithToken=function(e){return console.warn("Not actually sure if this works yet!"),t.post(i+"login",{token:e}).then(u,function(){400===status&&o.destroy().then(s)})},c}]),angular.module("checkin").factory("GroupService",["$q","$http","Session",function(e,t,n){var r="api/groups/",o={};return o.getGroups=function(){return t.get(r)},o.createGroup=function(e){return t.post(r,{groupName:e})},o.getVolunteers=function(e){return t.get(r+e+"/volunteers")},o.addVolunteerToGroup=function(e,n){return t.put(r+n+"/volunteers/"+e)},o.removeVolunteerFromGroup=function(e,n){return t.delete(r+n+"/volunteers/"+e)},o.addUsersToGroup=function(e,n){return t.put(r+e+"/users",{users:n})},o.removeUsersFromGroup=function(e,n){return t.delete(r+e+"/users",{users:n})},o}]),angular.module("checkin").service("Session",["$rootScope","$window","$q",function(e,t,n){this.create=function(n,r){t.localStorage.jwt=n,t.localStorage.userId=r._id,t.localStorage.currentUser=JSON.stringify(r),e.currentUser=r},this.destroy=function(){return delete t.localStorage.jwt,delete t.localStorage.userId,delete t.localStorage.currentUser,e.currentUser=null,n(function(e,t){e()})},this.getToken=function(){return t.localStorage.jwt},this.getUserId=function(){return t.localStorage.userId},this.getUser=function(){return JSON.parse(t.localStorage.currentUser)}}]),angular.module("checkin").factory("UserService",["$q","$http","Session",function(e,t,n){var r="api/users",o=r+"/",u="api/groups/",s={};return s.getUsers=function(e){var u=n.getUser();u.admin||u.checkin&&u.checkin.all||e.group||(e.group=u.checkin.groups),e.group&&!Array.isArray(e.group)&&(e.group=[e.group]),void 0===e.page&&void 0===e.size||(e.page=e.page||0,e.size=e.size||50);var s=e?r+"?"+$.param({text:e.text,page:e.page,size:e.size,group:e.group}):o;return t.get(s)},s.checkin=function(e){var r=e._id,s=o+r+"/checkin",c=n.getUser();if(!(c.admin||c.checkin&&c.checkin.all)){var i=e.groups.find(function(e){return c.checkin.groups.indexOf(e)!==-1});s=u+i+"/users/"+r+"/checkin"}return t.post(s)},s.checkout=function(e){var r=e._id,s=o+r+"/checkout",c=n.getUser();if(!(c.admin||c.checkin&&c.checkin.all)){var i=e.groups.find(function(e){return c.checkin.groups.indexOf(e)!==-1});s=u+i+"/users/"+r+"/checkout"}return t.post(s)},s}]),angular.module("checkin").controller("CheckinController",["$scope","UserService",function(e,t){function n(){return e.query?e.query.length>0&&e.query.length<3?s:e.query:null}function r(){e.users={users:[],busy:!1,nextPage:0,totalPages:0,totalUsers:0,getNextPage:function(){this.busy||(this.busy=!0,t.getUsers({text:n(),page:this.nextPage}).then(o.bind(this)),this.nextPage=this.nextPage+1)}}}function o(e){console.log(e.data),this.users=this.users.concat(e.data.users),this.totalUsers=e.data.totalUsers,this.totalPages=e.data.totalPages,this.nextPage=this.nextPage+1,this.busy=!1,u.sticky("refresh")}var u=$(".userSearch > .sticky");u.sticky({context:".userList > table"});var s=null;e.searchUsers=function(){var u=n();console.log("query:",u),u!==s&&(s=u,t.getUsers({page:0,text:u}).then(function(t){u===s&&(r(),o.bind(e.users)(t))}))},e.users={},r(),e.selectedUser=null;var c=$(".userDetails");e.setSelectedUser=function(t){c.modal(),e.selectedUser=t,t?c.modal("show"):c.modal("hide")},e.users.getNextPage(),e.checkin=function(e){console.log("checkin",e),t.checkin(e).then(function(t){console.log("checked in",t),e.status.checkedIn=!0,c.modal("hide")})},e.checkout=function(e){console.log("checkout",e),t.checkout(e).then(function(t){console.log("checked out",t),e.status.checkedIn=!1,c.modal("hide")})}}]),angular.module("checkin").controller("LoginController",["$scope","$state","AuthService",function(e,t,n){function r(e){console.log("success",e),t.go("app.checkin")}function o(e){console.log("failure",e)}e.login=function(){n.loginWithPassword(e.email,e.password).then(r,o)}}]),angular.module("checkin").controller("GroupsController",["$scope","UserService","GroupService",function(e,t,n){function r(t){t=t||e.selectedGroup.searchUsers,e.selectedGroup.searchUsers=t.filter(function(t){return e.selectedGroup.users.findIndex(function(e){return e._id===t._id})===-1})}function o(){return!e.userQuery||e.userQuery.length<3?null:e.userQuery}e.groups=[],e.getGroups=function(){n.getGroups().then(function(t){e.groups=t.data})},e.getGroups(),e.createGroup=function(t){t&&n.createGroup(t).then(function(t){e.groups.push(t.data)})},e.selectedGroup=null,e.selectGroup=function(r){e.selectedNewVolunteer=null,e.selectedGroup=r,n.getVolunteers(r._id).then(function(t){e.selectedGroup.volunteers=t.data.volunteers}),t.getUsers({group:r._id}).then(function(t){e.selectedGroup.users=t.data.users})},e.selectedNewVolunteer=null,e.setSelectedNewVolunteer=function(t){e.selectedNewVolunteer=t,t&&e.$apply()},e.addNewVolunteer=function(t,r){n.addVolunteerToGroup(t._id,r._id).then(function(t){e.selectedGroup.volunteers.push(t.data),e.setSelectedNewVolunteer(null)})},e.removeVolunteerFromGroup=function(t,r){n.removeVolunteerFromGroup(t._id,r._id).then(function(t){e.selectedGroup.volunteers.splice(e.selectedGroup.volunteers.findIndex(function(e){return e._id===t.data._id}),1)})},$(".add-volunteer").search({apiSettings:{responseAsync:function(n,r){n.urlData.query;t.getUsers({text:n.urlData.query}).then(function(t){results=t.data.users.filter(function(t){return e.selectedGroup.volunteers.findIndex(function(e){return e._id===t._id})===-1}).map(function(e){return{title:e.profile.name||e.email,description:e.profile.name?e.email:void 0,user:e}}),r({results:results})})}},minCharacters:3,onSelect:function(t){e.setSelectedNewVolunteer(t.user)}});var u=null;e.searchUsers=function(){var e=o();console.log("query:",e),e&&e!==u&&(u=e,t.getUsers({text:e}).then(function(t){e===u&&(console.log(t.data),r(t.data.users))}))},e.addUsersToGroup=function(){var t=e.selectedGroup.searchUsers.filter(function(e){return e.active}).map(function(e){return e._id});n.addUsersToGroup(e.selectedGroup._id,t).then(function(t){e.selectedGroup.users=t.data.users,r()})},e.addAllUsersToGroup=function(){var t=e.selectedGroup.searchUsers.map(function(e){return e._id});n.addUsersToGroup(e.selectedGroup._id,t).then(function(t){e.selectedGroup.users=t.data.users,r()})}}]),angular.module("checkin").controller("ToolbarController",["$scope","$state","$rootScope","Session",function(e,t,n,r){var o=r.getUser();e.states=[{name:"app.checkin",title:"Checkin"},{name:"app.groups",title:"Groups",adminOnly:!0}].filter(function(e){return!(e.adminOnly&&!o.admin)}),$(".logout").click(function(){r.destroy().then(function(){t.go("login")})})}]),angular.module("checkin").constant("SERVER_URL",{BASE_URL:"https://apply.hackgt.com/"});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJvdXRlcy5qcyIsInNlcnZpY2VzL0F1dGhTZXJ2aWNlLmpzIiwic2VydmljZXMvR3JvdXBTZXJ2aWNlLmpzIiwic2VydmljZXMvU2Vzc2lvbi5qcyIsInNlcnZpY2VzL1VzZXJTZXJ2aWNlLmpzIiwiY2hlY2tpbi9jaGVja2luQ29udHJvbGxlci5qcyIsImxvZ2luL2xvZ2luQ29udHJvbGxlci5qcyIsImdyb3Vwcy9ncm91cHNDb250cm9sbGVyLmpzIiwidG9vbGJhci90b29sYmFyQ29udHJvbGxlci5qcyIsImNvbmZpZy5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJGh0dHBQcm92aWRlciIsIlNFUlZFUl9VUkwiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwiZmFjdG9yeSIsIlNlc3Npb24iLCJyZXF1ZXN0IiwidXJsIiwiaW5kZXhPZiIsIkJBU0VfVVJMIiwiaGVhZGVycyIsInRva2VuIiwiZ2V0VG9rZW4iLCJkaXJlY3RpdmUiLCIkcm9vdFNjb3BlIiwiJHRpbWVvdXQiLCJsaW5rIiwibGlzdGVuZXIiLCJldmVudCIsInRvU3RhdGUiLCJ0aXRsZSIsImRhdGEiLCJwYWdlVGl0bGUiLCIkb24iLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicmVxdWlyZUxvZ2luIiwiYWJzdHJhY3QiLCJ2aWV3cyIsIkAiLCJ0b29sYmFyQGFwcCIsIm90aGVyd2lzZSIsInJ1biIsIiRzdGF0ZSIsImRvY3VtZW50IiwiYm9keSIsInNjcm9sbFRvcCIsImRvY3VtZW50RWxlbWVudCIsInRvUGFyYW1zIiwicHJldmVudERlZmF1bHQiLCJnbyIsIiRxIiwiJGh0dHAiLCJsb2dpblN1Y2Nlc3MiLCJyZXNwb25zZSIsImNvbnNvbGUiLCJsb2ciLCJjcmVhdGUiLCJ1c2VyIiwicmVzb2x2ZSIsImxvZ2luRmFpbHVyZSIsImNhbGxiYWNrIiwicmVqZWN0IiwiYXV0aFNlcnZpY2UiLCJiYXNlVXJsIiwibG9naW5XaXRoUGFzc3dvcmQiLCJlbWFpbCIsInBhc3N3b3JkIiwicG9zdCIsInRoZW4iLCJhZG1pbiIsImNoZWNraW4iLCJncm91cHMiLCJsZW5ndGgiLCJhbGwiLCJFcnJvciIsImxvZ2luV2l0aFRva2VuIiwid2FybiIsInN0YXR1cyIsImRlc3Ryb3kiLCJHcm91cFNlcnZpY2UiLCJnZXRHcm91cHMiLCJnZXQiLCJjcmVhdGVHcm91cCIsImdyb3VwTmFtZSIsImdldFZvbHVudGVlcnMiLCJncm91cElkIiwiYWRkVm9sdW50ZWVyVG9Hcm91cCIsInZvbHVudGVlcklkIiwicHV0IiwicmVtb3ZlVm9sdW50ZWVyRnJvbUdyb3VwIiwiZGVsZXRlIiwiYWRkVXNlcnNUb0dyb3VwIiwidXNlcklkcyIsInVzZXJzIiwicmVtb3ZlVXNlcnNGcm9tR3JvdXAiLCJzZXJ2aWNlIiwiJHdpbmRvdyIsInRoaXMiLCJsb2NhbFN0b3JhZ2UiLCJqd3QiLCJ1c2VySWQiLCJfaWQiLCJjdXJyZW50VXNlciIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRVc2VySWQiLCJnZXRVc2VyIiwicGFyc2UiLCJiYXNlIiwiVXNlclNlcnZpY2UiLCJnZXRVc2VycyIsIm9wdGlvbnMiLCJtZSIsImdyb3VwIiwiQXJyYXkiLCJpc0FycmF5IiwidW5kZWZpbmVkIiwicGFnZSIsInNpemUiLCIkIiwicGFyYW0iLCJ0ZXh0IiwiYXR0ZW5kZWUiLCJhdHRlbmRlZUlkIiwiZmluZCIsImNoZWNrb3V0IiwiJHNjb3BlIiwiZ2V0UXVlcnkiLCJxdWVyeSIsImN1cnJlbnRRdWVyeSIsInJlc2V0VXNlckxpc3QiLCJidXN5IiwibmV4dFBhZ2UiLCJ0b3RhbFBhZ2VzIiwidG90YWxVc2VycyIsImdldE5leHRQYWdlIiwibG9hZEZyb21SZXNwb25zZSIsImJpbmQiLCJjb25jYXQiLCIkc2VhcmNoIiwic3RpY2t5IiwiY29udGV4dCIsInNlYXJjaFVzZXJzIiwic2VsZWN0ZWRVc2VyIiwiJHVzZXJEZXRhaWxzIiwic2V0U2VsZWN0ZWRVc2VyIiwibW9kYWwiLCJjaGVja2VkSW4iLCJBdXRoU2VydmljZSIsIm9uU3VjY2VzcyIsIm9uRmFpbHVyZSIsImxvZ2luIiwic2V0U2VhcmNoVXNlcnMiLCJzZWFyY2hSZXN1bHRzIiwic2VsZWN0ZWRHcm91cCIsImZpbHRlciIsImZpbmRJbmRleCIsImdyb3VwVXNlciIsInVzZXJRdWVyeSIsInNlbGVjdEdyb3VwIiwic2VsZWN0ZWROZXdWb2x1bnRlZXIiLCJ2b2x1bnRlZXJzIiwic2V0U2VsZWN0ZWROZXdWb2x1bnRlZXIiLCIkYXBwbHkiLCJhZGROZXdWb2x1bnRlZXIiLCJzcGxpY2UiLCJlbGVtIiwic2VhcmNoIiwiYXBpU2V0dGluZ3MiLCJyZXNwb25zZUFzeW5jIiwic2V0dGluZ3MiLCJ1cmxEYXRhIiwic2VydmVyUmVzcG9uc2UiLCJyZXN1bHRzIiwidm9sdW50ZWVyIiwibWFwIiwicHJvZmlsZSIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsIm1pbkNoYXJhY3RlcnMiLCJvblNlbGVjdCIsInNlbGVjdGlvbiIsInNlbGVjdGVkVXNlcnMiLCJhY3RpdmUiLCJhZGRBbGxVc2Vyc1RvR3JvdXAiLCJzdGF0ZXMiLCJhZG1pbk9ubHkiLCJjbGljayIsImNvbnN0YW50Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLFdBQ0EsYUFHQUYsS0FBQUcsUUFDQSxnQkFDQSxTQUFBQyxFQUFBQyxHQUdBRCxFQUFBRSxhQUFBQyxLQUFBLHVCQUlBUCxJQUFBUSxRQUFBLG9CQUNBLFVBQ0EsYUFDQSxTQUFBQyxFQUFBSixHQUNBLE9BQ0FLLFFBQUEsU0FBQVAsR0FDQSxJQUFBQSxFQUFBUSxJQUFBQyxRQUFBLFNBQUEsSUFBQVQsRUFBQVEsSUFBQUMsUUFBQSxXQUNBVCxFQUFBUSxJQUFBTixFQUFBUSxTQUFBVixFQUFBUSxJQUNBUixFQUFBVyxRQUFBLCtCQUFBVCxFQUFBUSxTQUVBLElBQUFFLEdBQUFOLEVBQUFPLFVBSUEsT0FIQUQs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LFVBQUFWLEtBQUEsV0FDQTFCLEVBQUFPLEdBQUEsZ0JDdEJBOUMsUUFBQUMsT0FBQSxXQUFBd0wsU0FBQSxjQUVBN0ssU0FBQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdjaGVja2luJywgW1xuICAndWkucm91dGVyJyxcbl0pO1xuXG5hcHAuY29uZmlnKFtcbiAgJyRodHRwUHJvdmlkZXInLFxuICBmdW5jdGlvbigkaHR0cFByb3ZpZGVyLCBTRVJWRVJfVVJMKSB7XG5cbiAgICAvLyBhZGQgcm9vdCB1cmwgdG8gYWxsIGFwaSBhbmQgYXV0aCByZXF1ZXN0c1xuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0FwaUF1dGhlbnRpY2F0b3InKTtcbiAgfVxuXSk7XG5cbmFwcC5mYWN0b3J5KCdBcGlBdXRoZW50aWNhdG9yJywgW1xuICAnU2Vzc2lvbicsXG4gICdTRVJWRVJfVVJMJyxcbiAgZnVuY3Rpb24oU2Vzc2lvbiwgU0VSVkVSX1VSTCkge1xuICAgIHJldHVybiB7XG4gICAgICByZXF1ZXN0OiBmdW5jdGlvbihjb25maWcpIHtcbiAgICAgICAgaWYgKGNvbmZpZy51cmwuaW5kZXhPZignYXBpLycpID09PSAwIHx8IGNvbmZpZy51cmwuaW5kZXhPZignYXV0aC8nKSA9PT0gMCkge1xuICAgICAgICAgIGNvbmZpZy51cmwgPSBTRVJWRVJfVVJMLkJBU0VfVVJMICsgY29uZmlnLnVybDtcbiAgICAgICAgICBjb25maWcuaGVhZGVyc1snQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJ10gPSBTRVJWRVJfVVJMLkJBU0VfVVJMO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0b2tlbiA9IFNlc3Npb24uZ2V0VG9rZW4oKTtcbiAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ3gtYWNjZXNzLXRva2VuJ10gPSB0b2tlbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgfVxuICAgIH07XG4gIH1cbl0pO1xuXG5hcHAuZGlyZWN0aXZlKCd0aXRsZScsIFsnJHJvb3RTY29wZScsICckdGltZW91dCcsXG4gIGZ1bmN0aW9uKCRyb290U2NvcGUsICR0aW1lb3V0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxpbms6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uKGV2ZW50LCB0b1N0YXRlKSB7XG5cbiAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUudGl0bGUgPSAodG9TdGF0ZS5kYXRhICYmIHRvU3RhdGUuZGF0YS5wYWdlVGl0bGUpID9cbiAgICAgICAgICAgICAgdG9TdGF0ZS5kYXRhLnBhZ2VUaXRsZSA6ICdEZWZhdWx0IHRpdGxlJztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmNvbmZpZyhbXG4gICAgJyRzdGF0ZVByb3ZpZGVyJyxcbiAgICAnJHVybFJvdXRlclByb3ZpZGVyJyxcbiAgICBmdW5jdGlvbihcbiAgICAgICRzdGF0ZVByb3ZpZGVyLFxuICAgICAgJHVybFJvdXRlclByb3ZpZGVyKSB7XG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgICAgICAgIHVybDogJy9sb2dpbicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9sb2dpbi9sb2dpbi5odG1sXCIsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgcmVxdWlyZUxvZ2luOiBmYWxzZSxcbiAgICAgICAgICAgICAgcGFnZVRpdGxlOiAnTG9naW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zdGF0ZSgnYXBwJywge1xuICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAnQCc6IHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9iYXNlLmh0bWxcIixcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgJ3Rvb2xiYXJAYXBwJzoge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL3Rvb2xiYXIvdG9vbGJhci5odG1sXCIsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1Rvb2xiYXJDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHJlcXVpcmVMb2dpbjogdHJ1ZSxcbiAgICAgICAgICAgICAgcGFnZVRpdGxlOiAnQ2hlY2tpbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnN0YXRlKCdhcHAuY2hlY2tpbicsIHtcbiAgICAgICAgICAgIHVybDogJy9jaGVja2luJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvY2hlY2tpbi9jaGVja2luLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NoZWNraW5Db250cm9sbGVyJyxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zdGF0ZSgnYXBwLmdyb3VwcycsIHtcbiAgICAgICAgICAgIHVybDogJy9ncm91cHMnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9ncm91cHMvZ3JvdXBzLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0dyb3Vwc0NvbnRyb2xsZXInLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9jaGVja2luJyk7XG4gICAgfVxuICBdKVxuICAucnVuKFtcbiAgICAnJHJvb3RTY29wZScsXG4gICAgJyRzdGF0ZScsXG4gICAgJ1Nlc3Npb24nLFxuICAgIGZ1bmN0aW9uKFxuICAgICAgJHJvb3RTY29wZSxcbiAgICAgICRzdGF0ZSxcbiAgICAgIFNlc3Npb24pe1xuXG4gICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwO1xuICAgICAgfSk7XG5cbiAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMpIHtcbiAgICAgICAgdmFyIHJlcXVpcmVMb2dpbiA9IHRvU3RhdGUuZGF0YS5yZXF1aXJlTG9naW47XG5cbiAgICAgICAgaWYgKHJlcXVpcmVMb2dpbiAmJiAhU2Vzc2lvbi5nZXRUb2tlbigpKSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIVNlc3Npb24uZ2V0VG9rZW4oKSkge1xuICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XG4gICAgICB9XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmZhY3RvcnkoJ0F1dGhTZXJ2aWNlJywgW1xuICAgICckcScsXG4gICAgJyRodHRwJyxcbiAgICAnJHJvb3RTY29wZScsXG4gICAgJyRzdGF0ZScsXG4gICAgJ1Nlc3Npb24nLFxuICAgIGZ1bmN0aW9uKCRxLCAkaHR0cCwgJHJvb3RTY29wZSwgJHN0YXRlLCBTZXNzaW9uKSB7XG4gICAgICB2YXIgYXV0aFNlcnZpY2UgPSB7fTtcbiAgICAgIHZhciBiYXNlVXJsID0gJ2F1dGgvJztcblxuICAgICAgZnVuY3Rpb24gbG9naW5TdWNjZXNzKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgY29uc29sZS5sb2coJ2F1dGggc3VjY2VzcycsIGRhdGEpO1xuICAgICAgICBTZXNzaW9uLmNyZWF0ZShkYXRhLnRva2VuLCBkYXRhLnVzZXIpO1xuICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICAgIHJlc29sdmUoZGF0YS51c2VyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGxvZ2luRmFpbHVyZShkYXRhLCBjYWxsYmFjaykge1xuICAgICAgICBjb25zb2xlLmxvZygnYXV0aCBmYWlsJywgZGF0YSk7XG4gICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIHJlamVjdChkYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIH1cblxuICAgICAgYXV0aFNlcnZpY2UubG9naW5XaXRoUGFzc3dvcmQgPSBmdW5jdGlvbihlbWFpbCwgcGFzc3dvcmQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwXG4gICAgICAgICAgLnBvc3QoYmFzZVVybCArICdsb2dpbicsIHtcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB1c2VyID0gcmVzcG9uc2UuZGF0YS51c2VyO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgISh1c2VyLmFkbWluIHx8XG4gICAgICAgICAgICAgICh1c2VyLmNoZWNraW4gJiZcbiAgICAgICAgICAgICAgICAodXNlci5jaGVja2luLmdyb3Vwcy5sZW5ndGggPiAwIHx8XG4gICAgICAgICAgICAgICAgICB1c2VyLmNoZWNraW4uYWxsKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBpcyBub3QgYW4gYWRtaW4gb3Igdm9sdW50ZWVyJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbihsb2dpblN1Y2Nlc3MsIGxvZ2luRmFpbHVyZSk7XG4gICAgICB9O1xuXG4gICAgICAvLyBUT0RPIHVuc3VyZSBpZiB0aGlzIHdvcmtzIVxuICAgICAgYXV0aFNlcnZpY2UubG9naW5XaXRoVG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJOb3QgYWN0dWFsbHkgc3VyZSBpZiB0aGlzIHdvcmtzIHlldCFcIik7XG4gICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgIC5wb3N0KGJhc2VVcmwgKyAnbG9naW4nLCB7XG4gICAgICAgICAgICB0b2tlbjogdG9rZW5cbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKGxvZ2luU3VjY2VzcywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgU2Vzc2lvbi5kZXN0cm95KCkudGhlbihsb2dpbkZhaWx1cmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlO1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5mYWN0b3J5KCdHcm91cFNlcnZpY2UnLCBbXG4gICAgJyRxJyxcbiAgICAnJGh0dHAnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkcSwgJGh0dHAsIFNlc3Npb24pIHtcbiAgICAgIHZhciBncm91cHMgPSAnYXBpL2dyb3Vwcy8nO1xuXG4gICAgICB2YXIgR3JvdXBTZXJ2aWNlID0ge307XG5cbiAgICAgIEdyb3VwU2VydmljZS5nZXRHcm91cHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmdldChncm91cHMpO1xuICAgICAgfTtcblxuICAgICAgR3JvdXBTZXJ2aWNlLmNyZWF0ZUdyb3VwID0gZnVuY3Rpb24oZ3JvdXBOYW1lKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KGdyb3VwcywgeyBncm91cE5hbWU6IGdyb3VwTmFtZSB9KTtcbiAgICAgIH07XG5cbiAgICAgIEdyb3VwU2VydmljZS5nZXRWb2x1bnRlZXJzID0gZnVuY3Rpb24oZ3JvdXBJZCkge1xuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KGdyb3VwcyArIGdyb3VwSWQgKyAnL3ZvbHVudGVlcnMnKTtcbiAgICAgIH07XG5cbiAgICAgIEdyb3VwU2VydmljZS5hZGRWb2x1bnRlZXJUb0dyb3VwID0gZnVuY3Rpb24odm9sdW50ZWVySWQsIGdyb3VwSWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLnB1dChncm91cHMgKyBncm91cElkICsgJy92b2x1bnRlZXJzLycgKyB2b2x1bnRlZXJJZCk7XG4gICAgICB9O1xuXG4gICAgICBHcm91cFNlcnZpY2UucmVtb3ZlVm9sdW50ZWVyRnJvbUdyb3VwID0gZnVuY3Rpb24odm9sdW50ZWVySWQsIGdyb3VwSWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZShncm91cHMgKyBncm91cElkICsgJy92b2x1bnRlZXJzLycgKyB2b2x1bnRlZXJJZCk7XG4gICAgICB9O1xuXG4gICAgICBHcm91cFNlcnZpY2UuYWRkVXNlcnNUb0dyb3VwID0gZnVuY3Rpb24oZ3JvdXBJZCwgdXNlcklkcykge1xuICAgICAgICByZXR1cm4gJGh0dHAucHV0KGdyb3VwcyArIGdyb3VwSWQgKyAnL3VzZXJzJywgeyB1c2VyczogdXNlcklkcyB9KTtcbiAgICAgIH07XG5cbiAgICAgIEdyb3VwU2VydmljZS5yZW1vdmVVc2Vyc0Zyb21Hcm91cCA9IGZ1bmN0aW9uKGdyb3VwSWQsIHVzZXJJZHMpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZShncm91cHMgKyBncm91cElkICsgJy91c2VycycsIHsgdXNlcnM6IHVzZXJJZHMgfSk7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gR3JvdXBTZXJ2aWNlO1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5zZXJ2aWNlKCdTZXNzaW9uJywgW1xuICAgICckcm9vdFNjb3BlJyxcbiAgICAnJHdpbmRvdycsXG4gICAgJyRxJyxcbiAgICBmdW5jdGlvbigkcm9vdFNjb3BlLCAkd2luZG93LCAkcSl7XG4gICAgICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKHRva2VuLCB1c2VyKXtcbiAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0ID0gdG9rZW47XG4gICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnVzZXJJZCA9IHVzZXIuX2lkO1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlciA9IEpTT04uc3RyaW5naWZ5KHVzZXIpO1xuICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3Q7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS51c2VySWQ7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcjtcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRUb2tlbiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3Q7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmdldFVzZXJJZCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS51c2VySWQ7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmdldFVzZXIgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcik7XG4gICAgICB9O1xuICB9XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5mYWN0b3J5KCdVc2VyU2VydmljZScsIFtcbiAgICAnJHEnLFxuICAgICckaHR0cCcsXG4gICAgJ1Nlc3Npb24nLFxuICAgIGZ1bmN0aW9uKCRxLCAkaHR0cCwgU2Vzc2lvbikge1xuICAgICAgdmFyIHVzZXJzID0gJ2FwaS91c2Vycyc7XG4gICAgICB2YXIgYmFzZSA9IHVzZXJzICsgJy8nO1xuICAgICAgdmFyIGdyb3VwcyA9ICdhcGkvZ3JvdXBzLyc7XG5cbiAgICAgIHZhciBVc2VyU2VydmljZSA9IHt9O1xuXG4gICAgICBVc2VyU2VydmljZS5nZXRVc2VycyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblxuICAgICAgICB2YXIgbWUgPSBTZXNzaW9uLmdldFVzZXIoKTtcbiAgICAgICAgLy8gaWYgbm90IGFuIGFkbWluIGFuZCBubyBncm91cHMgYXJlIHNlbGVjdGVkLCBhdXRvbWF0aWNhbGx5IHNjb3BlXG4gICAgICAgIC8vIHRvIG9ubHkgZ3JvdXBzIHRoYXQgYXJlIHBlcm1pc3Npb25lZFxuICAgICAgICBpZiAoIShtZS5hZG1pbiB8fCAobWUuY2hlY2tpbiAmJiBtZS5jaGVja2luLmFsbCkpKSB7XG4gICAgICAgICAgaWYgKCFvcHRpb25zLmdyb3VwKSB7XG4gICAgICAgICAgICBvcHRpb25zLmdyb3VwID0gbWUuY2hlY2tpbi5ncm91cHM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuZ3JvdXAgJiYgIUFycmF5LmlzQXJyYXkob3B0aW9ucy5ncm91cCkpIHtcbiAgICAgICAgICBvcHRpb25zLmdyb3VwID0gW29wdGlvbnMuZ3JvdXBdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMucGFnZSAhPT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMuc2l6ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgb3B0aW9ucy5wYWdlID0gb3B0aW9ucy5wYWdlIHx8IDA7XG4gICAgICAgICAgb3B0aW9ucy5zaXplID0gb3B0aW9ucy5zaXplIHx8IDUwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVE9ETyBbYWRhaV0geWVzIHRoaXMgaXMga2luZGEgZHVtYiBhbmQgc2hvdWxkIGJlIGJldHRlclxuICAgICAgICB2YXIgdXJsID0gb3B0aW9ucyA/IHVzZXJzICsgJz8nICsgJC5wYXJhbShcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0ZXh0OiBvcHRpb25zLnRleHQsXG4gICAgICAgICAgICBwYWdlOiBvcHRpb25zLnBhZ2UsXG4gICAgICAgICAgICBzaXplOiBvcHRpb25zLnNpemUsXG4gICAgICAgICAgICBncm91cDogb3B0aW9ucy5ncm91cCxcbiAgICAgICAgICB9KSA6IGJhc2U7XG5cbiAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpO1xuICAgICAgfTtcblxuICAgICAgVXNlclNlcnZpY2UuY2hlY2tpbiA9IGZ1bmN0aW9uKGF0dGVuZGVlKSB7XG4gICAgICAgIHZhciBhdHRlbmRlZUlkID0gYXR0ZW5kZWUuX2lkO1xuICAgICAgICB2YXIgdXJsID0gYmFzZSArIGF0dGVuZGVlSWQgKyAnL2NoZWNraW4nO1xuXG4gICAgICAgIHZhciBtZSA9IFNlc3Npb24uZ2V0VXNlcigpO1xuICAgICAgICAvLyBpZiB0aGUgdXNlciBpcyBub3Qgb21uaXBvdGVudCwgZmluZCB0aGUgaW50ZXJzZWN0aW9uIG9mIGJldHdlZW5cbiAgICAgICAgLy8gZ3JvdXBzIHRoYXQgdGhlIHVzZXIgY2FuIGNoZWNraW4gdGhlIGFuZCBhdHRlbmRlZSBpcyBhIG1lbWJlciBvZlxuICAgICAgICBpZiAoIShtZS5hZG1pbiB8fCAobWUuY2hlY2tpbiAmJiBtZS5jaGVja2luLmFsbCkpKSB7XG4gICAgICAgICAgdmFyIGdyb3VwSWQgPSBhdHRlbmRlZS5ncm91cHMuZmluZChmdW5jdGlvbihncm91cElkKSB7XG4gICAgICAgICAgICByZXR1cm4gbWUuY2hlY2tpbi5ncm91cHMuaW5kZXhPZihncm91cElkKSAhPT0gLTE7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdXJsID0gZ3JvdXBzICsgZ3JvdXBJZCArICcvdXNlcnMvJyArIGF0dGVuZGVlSWQgKyAnL2NoZWNraW4nO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsKTtcbiAgICAgIH07XG5cbiAgICAgIFVzZXJTZXJ2aWNlLmNoZWNrb3V0ID0gZnVuY3Rpb24oYXR0ZW5kZWUpIHtcbiAgICAgICAgdmFyIGF0dGVuZGVlSWQgPSBhdHRlbmRlZS5faWQ7XG4gICAgICAgIHZhciB1cmwgPSBiYXNlICsgYXR0ZW5kZWVJZCArICcvY2hlY2tvdXQnO1xuXG4gICAgICAgIHZhciBtZSA9IFNlc3Npb24uZ2V0VXNlcigpO1xuICAgICAgICAvLyBpZiB0aGUgdXNlciBpcyBub3Qgb21uaXBvdGVudCwgZmluZCB0aGUgaW50ZXJzZWN0aW9uIG9mIGJldHdlZW5cbiAgICAgICAgLy8gZ3JvdXBzIHRoYXQgdGhlIHVzZXIgY2FuIGNoZWNrb3V0IHRoZSBhbmQgYXR0ZW5kZWUgaXMgYSBtZW1iZXIgb2ZcbiAgICAgICAgaWYgKCEobWUuYWRtaW4gfHwgKG1lLmNoZWNraW4gJiYgbWUuY2hlY2tpbi5hbGwpKSkge1xuICAgICAgICAgIHZhciBncm91cElkID0gYXR0ZW5kZWUuZ3JvdXBzLmZpbmQoZnVuY3Rpb24oZ3JvdXBJZCkge1xuICAgICAgICAgICAgcmV0dXJuIG1lLmNoZWNraW4uZ3JvdXBzLmluZGV4T2YoZ3JvdXBJZCkgIT09IC0xO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHVybCA9IGdyb3VwcyArIGdyb3VwSWQgKyAnL3VzZXJzLycgKyBhdHRlbmRlZUlkICsgJy9jaGVja291dCc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwpO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIFVzZXJTZXJ2aWNlO1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb250cm9sbGVyKCdDaGVja2luQ29udHJvbGxlcicsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnVXNlclNlcnZpY2UnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNlcnZpY2UpIHtcbiAgICAgIC8vIFRPRE8gbWFrZSB0aGlzIGEgZGlyZWN0aXZlXG4gICAgICB2YXIgJHNlYXJjaCA9ICQoJy51c2VyU2VhcmNoID4gLnN0aWNreScpO1xuICAgICAgJHNlYXJjaC5zdGlja3koe1xuICAgICAgICBjb250ZXh0OiAnLnVzZXJMaXN0ID4gdGFibGUnLFxuICAgICAgfSk7XG5cbiAgICAgIHZhciBjdXJyZW50UXVlcnkgPSBudWxsO1xuICAgICAgLy8gb25seSByZXR1cm4gbmV3IHF1ZXJ5IGlmIGxlbmd0aCA+PSAzLCBlbHNlIHJldHVyblxuICAgICAgZnVuY3Rpb24gZ2V0UXVlcnkoKSB7XG4gICAgICAgIGlmICghJHNjb3BlLnF1ZXJ5KSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLnF1ZXJ5Lmxlbmd0aCA+IDAgJiYgJHNjb3BlLnF1ZXJ5Lmxlbmd0aCA8IDMpIHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudFF1ZXJ5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAkc2NvcGUucXVlcnk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5zZWFyY2hVc2VycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcXVlcnkgPSBnZXRRdWVyeSgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInF1ZXJ5OlwiLCBxdWVyeSk7XG5cbiAgICAgICAgaWYgKHF1ZXJ5ID09PSBjdXJyZW50UXVlcnkpIHsgcmV0dXJuOyB9XG4gICAgICAgIGN1cnJlbnRRdWVyeSA9IHF1ZXJ5O1xuXG4gICAgICAgIC8vIHRoaXMgaXMgYWxsIGEgbG93LWtleSB3b3JrYXJvdW5kIGZvciAkaHR0cCdzIGxhY2sgb2YgY2FuY2VsKClcbiAgICAgICAgVXNlclNlcnZpY2UuZ2V0VXNlcnMoe1xuICAgICAgICAgIHBhZ2U6IDAsIC8vIGluZGljYXRlIHRoYXQgd2Ugd2FudCB0aGlzIHRvIGJlIHBhZ2VkIChzaXplIGlzIGRlZmF1bHQgNTApXG4gICAgICAgICAgdGV4dDogcXVlcnksXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAvLyBpZiB0aGlzIGlzIG5vIGxvbmdlciB0aGUgbW9zdCByZWNlbnQgcXVlcnksIHRoZW4gaWdub3JlXG4gICAgICAgICAgaWYgKHF1ZXJ5ICE9PSBjdXJyZW50UXVlcnkpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgcmVzZXRVc2VyTGlzdCgpO1xuICAgICAgICAgIGxvYWRGcm9tUmVzcG9uc2UuYmluZCgkc2NvcGUudXNlcnMpKHJlc3BvbnNlKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUudXNlcnMgPSB7fTtcbiAgICAgIGZ1bmN0aW9uIHJlc2V0VXNlckxpc3QoKSB7XG4gICAgICAgICRzY29wZS51c2VycyA9IHtcbiAgICAgICAgICB1c2VyczogW10sXG4gICAgICAgICAgYnVzeTogZmFsc2UsXG4gICAgICAgICAgbmV4dFBhZ2U6IDAsXG4gICAgICAgICAgdG90YWxQYWdlczogMCxcbiAgICAgICAgICB0b3RhbFVzZXJzOiAwLFxuICAgICAgICAgIGdldE5leHRQYWdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJ1c3kpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgIHRoaXMuYnVzeSA9IHRydWU7XG5cbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmdldFVzZXJzKHtcbiAgICAgICAgICAgICAgdGV4dDogZ2V0UXVlcnkoKSxcbiAgICAgICAgICAgICAgcGFnZTogdGhpcy5uZXh0UGFnZSxcbiAgICAgICAgICAgIH0pLnRoZW4obG9hZEZyb21SZXNwb25zZS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgdGhpcy5uZXh0UGFnZSA9IHRoaXMubmV4dFBhZ2UgKyAxO1xuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXNldFVzZXJMaXN0KCk7XG5cbiAgICAgICRzY29wZS5zZWxlY3RlZFVzZXIgPSBudWxsO1xuICAgICAgdmFyICR1c2VyRGV0YWlscyA9ICQoJy51c2VyRGV0YWlscycpO1xuXG4gICAgICAkc2NvcGUuc2V0U2VsZWN0ZWRVc2VyID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAkdXNlckRldGFpbHMubW9kYWwoKTtcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkVXNlciA9IHVzZXI7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgJHVzZXJEZXRhaWxzLm1vZGFsKCdzaG93Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJHVzZXJEZXRhaWxzLm1vZGFsKCdoaWRlJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgICRzY29wZS51c2Vycy5nZXROZXh0UGFnZSgpO1xuXG4gICAgICBmdW5jdGlvbiBsb2FkRnJvbVJlc3BvbnNlKHJlc3BvbnNlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuXG4gICAgICAgIHRoaXMudXNlcnMgPSB0aGlzLnVzZXJzLmNvbmNhdChyZXNwb25zZS5kYXRhLnVzZXJzKTtcblxuICAgICAgICB0aGlzLnRvdGFsVXNlcnMgPSByZXNwb25zZS5kYXRhLnRvdGFsVXNlcnM7XG4gICAgICAgIHRoaXMudG90YWxQYWdlcyA9IHJlc3BvbnNlLmRhdGEudG90YWxQYWdlcztcbiAgICAgICAgdGhpcy5uZXh0UGFnZSA9IHRoaXMubmV4dFBhZ2UgKyAxO1xuICAgICAgICB0aGlzLmJ1c3kgPSBmYWxzZTtcblxuICAgICAgICAkc2VhcmNoLnN0aWNreSgncmVmcmVzaCcpO1xuICAgICAgfVxuXG4gICAgICAkc2NvcGUuY2hlY2tpbiA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2NoZWNraW4nLCB1c2VyKTtcbiAgICAgICAgVXNlclNlcnZpY2UuY2hlY2tpbih1c2VyKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGVja2VkIGluJywgZGF0YSk7XG4gICAgICAgICAgICB1c2VyLnN0YXR1cy5jaGVja2VkSW4gPSB0cnVlO1xuICAgICAgICAgICAgJHVzZXJEZXRhaWxzLm1vZGFsKCdoaWRlJyk7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUuY2hlY2tvdXQgPSBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjaGVja291dCcsIHVzZXIpO1xuICAgICAgICBVc2VyU2VydmljZS5jaGVja291dCh1c2VyKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGVja2VkIG91dCcsIGRhdGEpO1xuICAgICAgICAgICAgdXNlci5zdGF0dXMuY2hlY2tlZEluID0gZmFsc2U7XG4gICAgICAgICAgICAkdXNlckRldGFpbHMubW9kYWwoJ2hpZGUnKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmNvbnRyb2xsZXIoJ0xvZ2luQ29udHJvbGxlcicsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlJyxcbiAgICAnQXV0aFNlcnZpY2UnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBBdXRoU2VydmljZSkge1xuXG4gICAgICBmdW5jdGlvbiBvblN1Y2Nlc3MoZGF0YSkge1xuICAgICAgICBjb25zb2xlLmxvZygnc3VjY2VzcycsIGRhdGEpO1xuICAgICAgICAkc3RhdGUuZ28oJ2FwcC5jaGVja2luJyk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIG9uRmFpbHVyZShkYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdmYWlsdXJlJywgZGF0YSk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBBdXRoU2VydmljZS5sb2dpbldpdGhQYXNzd29yZChcbiAgICAgICAgICAkc2NvcGUuZW1haWwsICRzY29wZS5wYXNzd29yZFxuICAgICAgICApLnRoZW4ob25TdWNjZXNzLCBvbkZhaWx1cmUpO1xuICAgICAgfTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuY29udHJvbGxlcignR3JvdXBzQ29udHJvbGxlcicsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnVXNlclNlcnZpY2UnLFxuICAgICdHcm91cFNlcnZpY2UnLFxuICAgIGZ1bmN0aW9uICgkc2NvcGUsIFVzZXJTZXJ2aWNlLCBHcm91cFNlcnZpY2UpIHtcbiAgICAgICRzY29wZS5ncm91cHMgPSBbXTtcblxuICAgICAgJHNjb3BlLmdldEdyb3VwcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBHcm91cFNlcnZpY2UuZ2V0R3JvdXBzKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICRzY29wZS5ncm91cHMgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICAkc2NvcGUuZ2V0R3JvdXBzKCk7XG5cbiAgICAgICRzY29wZS5jcmVhdGVHcm91cCA9IGZ1bmN0aW9uKGdyb3VwTmFtZSkge1xuICAgICAgICBpZiAoIWdyb3VwTmFtZSkgeyByZXR1cm47IH1cblxuICAgICAgICBHcm91cFNlcnZpY2UuY3JlYXRlR3JvdXAoZ3JvdXBOYW1lKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgJHNjb3BlLmdyb3Vwcy5wdXNoKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5zZWxlY3RlZEdyb3VwID0gbnVsbDtcbiAgICAgICRzY29wZS5zZWxlY3RHcm91cCA9IGZ1bmN0aW9uKGdyb3VwKSB7XG4gICAgICAgICRzY29wZS5zZWxlY3RlZE5ld1ZvbHVudGVlciA9IG51bGw7XG4gICAgICAgICRzY29wZS5zZWxlY3RlZEdyb3VwID0gZ3JvdXA7XG4gICAgICAgIEdyb3VwU2VydmljZS5nZXRWb2x1bnRlZXJzKGdyb3VwLl9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICRzY29wZS5zZWxlY3RlZEdyb3VwLnZvbHVudGVlcnMgPSByZXNwb25zZS5kYXRhLnZvbHVudGVlcnM7XG4gICAgICAgIH0pO1xuICAgICAgICBVc2VyU2VydmljZS5nZXRVc2Vycyh7IGdyb3VwOiBncm91cC5faWQgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICRzY29wZS5zZWxlY3RlZEdyb3VwLnVzZXJzID0gcmVzcG9uc2UuZGF0YS51c2VycztcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUuc2VsZWN0ZWROZXdWb2x1bnRlZXIgPSBudWxsO1xuICAgICAgJHNjb3BlLnNldFNlbGVjdGVkTmV3Vm9sdW50ZWVyID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWROZXdWb2x1bnRlZXIgPSB1c2VyO1xuICAgICAgICAvLyBmb3JjZSB1aSByZWZyZXNoIChvdGhlcndpc2Ugd2FpdCB1bnRpbCBhbm90aGVyIGV2ZW50IGZpcmVzKVxuICAgICAgICAvLyBvbmx5IHdoZW4gdGhpcyBpcyBpbml0aWF0ZWQgYnkgdGhlIHNlYXJjaFxuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgJHNjb3BlLmFkZE5ld1ZvbHVudGVlciA9IGZ1bmN0aW9uKHVzZXIsIGdyb3VwKSB7XG4gICAgICAgIEdyb3VwU2VydmljZS5hZGRWb2x1bnRlZXJUb0dyb3VwKHVzZXIuX2lkLCBncm91cC5faWQpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEdyb3VwLnZvbHVudGVlcnMucHVzaChyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgICRzY29wZS5zZXRTZWxlY3RlZE5ld1ZvbHVudGVlcihudWxsKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5yZW1vdmVWb2x1bnRlZXJGcm9tR3JvdXAgPSBmdW5jdGlvbih1c2VyLCBncm91cCkge1xuICAgICAgICBHcm91cFNlcnZpY2UucmVtb3ZlVm9sdW50ZWVyRnJvbUdyb3VwKHVzZXIuX2lkLCBncm91cC5faWQpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEdyb3VwLnZvbHVudGVlcnMuc3BsaWNlKFxuICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cC52b2x1bnRlZXJzLmZpbmRJbmRleChmdW5jdGlvbihlbGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uX2lkID09PSByZXNwb25zZS5kYXRhLl9pZDtcbiAgICAgICAgICAgICAgfSksIDEpO1xuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgLy8gVE9ETyBtb3ZlIHRoaXMgdG8gYSBkaXJlY3RpdmU/XG4gICAgICAkKCcuYWRkLXZvbHVudGVlcicpLnNlYXJjaCh7XG4gICAgICAgIGFwaVNldHRpbmdzOiB7XG4gICAgICAgICAgcmVzcG9uc2VBc3luYzogZnVuY3Rpb24oc2V0dGluZ3MsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgcXVlcnkgPSBzZXR0aW5ncy51cmxEYXRhLnF1ZXJ5O1xuICAgICAgICAgICAgVXNlclNlcnZpY2UuZ2V0VXNlcnMoe3RleHQ6IHNldHRpbmdzLnVybERhdGEucXVlcnl9KVxuICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihzZXJ2ZXJSZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBzZXJ2ZXJSZXNwb25zZS5kYXRhLnVzZXJzXG4gICAgICAgICAgICAgICAgICAvLyBmaWx0ZXIgb3V0IHZvbHVudGVlcnMgdGhhdCBhcmUgYWxyZWFkeSBzZWxlY3RlZFxuICAgICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuc2VsZWN0ZWRHcm91cC52b2x1bnRlZXJzLmZpbmRJbmRleChmdW5jdGlvbih2b2x1bnRlZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9sdW50ZWVyLl9pZCA9PT0gdXNlci5faWQ7XG4gICAgICAgICAgICAgICAgICAgIH0pID09PSAtMTtcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAvLyBtYXAgc2VydmVyIHJlc3BvbnNlIHRvIG1hdGNoIHVpIHNlYXJjaCdzIGV4cGVjdGVkIGZvcm1hdFxuICAgICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHVzZXIucHJvZmlsZS5uYW1lIHx8IHVzZXIuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHVzZXIucHJvZmlsZS5uYW1lID8gdXNlci5lbWFpbCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICB1c2VyOiB1c2VyLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soe1xuICAgICAgICAgICAgICAgICAgcmVzdWx0czogcmVzdWx0cyxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgbWluQ2hhcmFjdGVycyA6IDMsXG4gICAgICAgIG9uU2VsZWN0OiBmdW5jdGlvbihzZWxlY3Rpb24pIHtcbiAgICAgICAgICAkc2NvcGUuc2V0U2VsZWN0ZWROZXdWb2x1bnRlZXIoc2VsZWN0aW9uLnVzZXIpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFRPRE8gdGhpcyBuZWVkcyB0byBiZSBpbiBhIGRpcmVjdGl2ZVxuICAgICAgLy8gKHNlZSBhbG1vc3QgZXhhY3QgY29weSBvZiB0aGlzIGNvZGUgaW4gQ2hlY2tpbkNvbnRyb2xsZXIpXG4gICAgICB2YXIgY3VycmVudFF1ZXJ5ID0gbnVsbDtcbiAgICAgICRzY29wZS5zZWFyY2hVc2VycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcXVlcnkgPSBnZXRRdWVyeSgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInF1ZXJ5OlwiLCBxdWVyeSk7XG5cbiAgICAgICAgaWYgKCFxdWVyeSB8fCBxdWVyeSA9PT0gY3VycmVudFF1ZXJ5KSB7IHJldHVybjsgfVxuICAgICAgICBjdXJyZW50UXVlcnkgPSBxdWVyeTtcblxuICAgICAgICBVc2VyU2VydmljZS5nZXRVc2Vycyh7XG4gICAgICAgICAgdGV4dDogcXVlcnksXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICBpZiAocXVlcnkgIT09IGN1cnJlbnRRdWVyeSkgeyByZXR1cm47IH1cbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTtcblxuICAgICAgICAgIHNldFNlYXJjaFVzZXJzKHJlc3BvbnNlLmRhdGEudXNlcnMpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIGZ1bmN0aW9uIHNldFNlYXJjaFVzZXJzIChzZWFyY2hSZXN1bHRzKSB7XG4gICAgICAgIHNlYXJjaFJlc3VsdHMgPSBzZWFyY2hSZXN1bHRzIHx8ICRzY29wZS5zZWxlY3RlZEdyb3VwLnNlYXJjaFVzZXJzO1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cC5zZWFyY2hVc2VycyA9IHNlYXJjaFJlc3VsdHNcbiAgICAgICAgICAvLyBmaWx0ZXIgb3V0IGFueSB1c2VycyB0aGF0IGFyZSBhbHJlYWR5IGluIHRoaXMgZ3JvdXBcbiAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuc2VsZWN0ZWRHcm91cC51c2Vycy5maW5kSW5kZXgoZnVuY3Rpb24oZ3JvdXBVc2VyKSB7XG4gICAgICAgICAgICAgIHJldHVybiBncm91cFVzZXIuX2lkID09PSB1c2VyLl9pZDtcbiAgICAgICAgICAgIH0pID09PSAtMTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gZ2V0UXVlcnkoKSB7XG4gICAgICAgIGlmICghJHNjb3BlLnVzZXJRdWVyeSB8fCAkc2NvcGUudXNlclF1ZXJ5Lmxlbmd0aCA8IDMpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJHNjb3BlLnVzZXJRdWVyeTtcbiAgICAgIH1cblxuICAgICAgJHNjb3BlLmFkZFVzZXJzVG9Hcm91cCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZWN0ZWRVc2VycyA9ICRzY29wZS5zZWxlY3RlZEdyb3VwLnNlYXJjaFVzZXJzLmZpbHRlcihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHVzZXIuYWN0aXZlO1xuICAgICAgICB9KS5tYXAoZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgIHJldHVybiB1c2VyLl9pZDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgR3JvdXBTZXJ2aWNlLmFkZFVzZXJzVG9Hcm91cCgkc2NvcGUuc2VsZWN0ZWRHcm91cC5faWQsIHNlbGVjdGVkVXNlcnMpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEdyb3VwLnVzZXJzID0gcmVzcG9uc2UuZGF0YS51c2VycztcbiAgICAgICAgICAgIHNldFNlYXJjaFVzZXJzKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUuYWRkQWxsVXNlcnNUb0dyb3VwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxlY3RlZFVzZXJzID0gJHNjb3BlLnNlbGVjdGVkR3JvdXAuc2VhcmNoVXNlcnMubWFwKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICByZXR1cm4gdXNlci5faWQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIEdyb3VwU2VydmljZS5hZGRVc2Vyc1RvR3JvdXAoJHNjb3BlLnNlbGVjdGVkR3JvdXAuX2lkLCBzZWxlY3RlZFVzZXJzKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cC51c2VycyA9IHJlc3BvbnNlLmRhdGEudXNlcnM7XG4gICAgICAgICAgICBzZXRTZWFyY2hVc2VycygpO1xuICAgICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuY29udHJvbGxlcignVG9vbGJhckNvbnRyb2xsZXInLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRzdGF0ZScsXG4gICAgJyRyb290U2NvcGUnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJHJvb3RTY29wZSwgU2Vzc2lvbikge1xuICAgICAgdmFyIHVzZXIgPSBTZXNzaW9uLmdldFVzZXIoKTtcblxuICAgICAgJHNjb3BlLnN0YXRlcyA9IChbXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnYXBwLmNoZWNraW4nLFxuICAgICAgICAgIHRpdGxlOiAnQ2hlY2tpbicsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnYXBwLmdyb3VwcycsXG4gICAgICAgICAgdGl0bGU6ICdHcm91cHMnLFxuICAgICAgICAgIGFkbWluT25seTogdHJ1ZSxcbiAgICAgICAgfVxuICAgICAgXSkuZmlsdGVyKGZ1bmN0aW9uKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiAhKHN0YXRlLmFkbWluT25seSAmJiAhdXNlci5hZG1pbik7XG4gICAgICB9KTtcblxuICAgICAgJCgnLmxvZ291dCcpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICBTZXNzaW9uLmRlc3Ryb3koKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIF0pO1xuIiwiLyoqXG4gKiBIZXJlIGxheSB0aGUgYmFzZSB1cmxzIHVzZWQgaW4gdGhlIGh0dHAgdXJsIGluamVjdG9yXG4gKi9cbmFuZ3VsYXIubW9kdWxlKCdjaGVja2luJykuY29uc3RhbnQoJ1NFUlZFUl9VUkwnLCB7XG4gIC8vIEJBU0VfVVJMOiAgJ2h0dHBzOi8vY2U0ZTc1NzEubmdyb2suaW8vJyxcbiAgQkFTRV9VUkw6ICAnaHR0cHM6Ly9hcHBseS5oYWNrZ3QuY29tLycsXG5cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
