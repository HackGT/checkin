var app=angular.module("checkin",["ui.router","infinite-scroll"]);app.config(["$httpProvider",function(e,t){e.interceptors.push("ApiAuthenticator")}]),app.factory("ApiAuthenticator",["Session","SERVER_URL",function(e,t){return{request:function(n){0!==n.url.indexOf("api/")&&0!==n.url.indexOf("auth/")||(n.url=t.BASE_URL+n.url,n.headers["Access-Control-Allow-Origin"]=t.BASE_URL);var o=e.getToken();return o&&(n.headers["x-access-token"]=o),n}}}]),app.directive("title",["$rootScope","$timeout",function(e,t){return{link:function(){var n=function(n,o){t(function(){e.title=o.data&&o.data.pageTitle?o.data.pageTitle:"Default title"})};e.$on("$stateChangeSuccess",n)}}}]),angular.module("checkin").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("login",{url:"/login",templateUrl:"views/login/login.html",controller:"LoginController",data:{requireLogin:!1,pageTitle:"Login"}}).state("app",{abstract:!0,views:{"@":{templateUrl:"views/base.html"},"sidebar@app":{templateUrl:"views/sidebar/sidebar.html",controller:"SidebarController"}},data:{requireLogin:!0,pageTitle:"Checkin"}}).state("app.checkin",{url:"/",templateUrl:"views/checkin/checkin.html",controller:"CheckinController"}),t.otherwise("404")}]).run(["$rootScope","$state","Session",function(e,t,n){e.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0}),e.$on("$stateChangeStart",function(e,o,r){var i=o.data.requireLogin;i&&!n.getToken()&&(e.preventDefault(),t.go("login"))})}]),angular.module("checkin").service("Session",["$rootScope","$window","$q",function(e,t,n){this.create=function(n,o){t.localStorage.jwt=n,t.localStorage.userId=o._id,t.localStorage.currentUser=JSON.stringify(o),e.currentUser=o},this.destroy=function(){return delete t.localStorage.jwt,delete t.localStorage.userId,delete t.localStorage.currentUser,e.currentUser=null,n(function(e,t){e()})},this.getToken=function(){return t.localStorage.jwt},this.getUserId=function(){return t.localStorage.userId},this.getUser=function(){return JSON.parse(t.localStorage.currentUser)}}]),angular.module("checkin").factory("UserService",["$q","$http","Session",function(e,t,n){var o="api/users",r=o+"/",i={};return i.getUsers=function(e){var n=e?o+"?"+$.param({text:e.text,page:e.page?e.page:0,size:e.size?e.size:50}):r;return t.get(n)},i.checkin=function(e){return t.post(r+e+"/checkin")},i.checkout=function(e){return t.post(r+e+"/checkout")},i}]),angular.module("checkin").factory("AuthService",["$q","$http","$rootScope","$state","Session",function(e,t,n,o,r){function i(t){var n=t.data;return console.log("auth success",n),r.create(n.token,n.user),e(function(e){e(n.user)})}function c(t,n){return console.log("auth fail",t),o.go("login"),e(function(e,n){n(t)})}var a={},s="auth/";return a.loginWithPassword=function(e,n){return t.post(s+"login",{email:e,password:n}).then(i,c)},a.loginWithToken=function(e){return console.warn("Not actually sure if this works yet!"),t.post(s+"login",{token:e}).then(i,function(){400===status&&r.destroy().then(c)})},a}]),angular.module("checkin").controller("CheckinController",["$scope","UserService",function(e,t){e.users={users:[],busy:!1,nextPage:0,totalPages:1/0},e.selectedUser=null,e.setSelectedUser=function(t){var n=$(".ui.modal.userDetails");n.modal(),e.selectedUser=t,t?n.modal("show"):n.modal("hide")},e.users.getNextPage=function(){this.busy||this.nextPage>=this.totalPages||(this.busy=!0,t.getUsers({page:this.nextPage}).then(function(e){console.log(e.data),this.users=this.users.concat(e.data.users),this.totalPages=e.data.totalPages,this.nextPage+=1,this.busy=!1}.bind(this)))},e.checkin=function(e){t.checkin(e).then(function(e){console.log("checked in",e)})},e.checkout=function(e){t.checkout(e).then(function(e){console.log("checked out",e)})}}]),angular.module("checkin").controller("LoginController",["$scope","AuthService",function(e,t){function n(e){console.log("success",e)}function o(e){console.log("failure",e)}e.login=function(){t.loginWithPassword(e.email,e.password).then(n,o)}}]),angular.module("checkin").controller("SidebarController",["$scope","Session",function(e,t){}]),angular.module("checkin").constant("SERVER_URL",{BASE_URL:"https://ce4e7571.ngrok.io/"});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJvdXRlcy5qcyIsInNlc3Npb24vU2Vzc2lvbi5qcyIsInVzZXJzL1VzZXJTZXJ2aWNlLmpzIiwiYXV0aC9BdXRoU2VydmljZS5qcyIsImNoZWNraW4vY2hlY2tpbkNvbnRyb2xsZXIuanMiLCJsb2dpbi9sb2dpbkNvbnRyb2xsZXIuanMiLCJzaWRlYmFyL1NpZGViYXJDb250cm9sbGVyLmpzIiwiY29uZmlnLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkaHR0cFByb3ZpZGVyIiwiU0VSVkVSX1VSTCIsImludGVyY2VwdG9ycyIsInB1c2giLCJmYWN0b3J5IiwiU2Vzc2lvbiIsInJlcXVlc3QiLCJ1cmwiLCJpbmRleE9mIiwiQkFTRV9VUkwiLCJoZWFkZXJzIiwidG9rZW4iLCJnZXRUb2tlbiIsImRpcmVjdGl2ZSIsIiRyb290U2NvcGUiLCIkdGltZW91dCIsImxpbmsiLCJsaXN0ZW5lciIsImV2ZW50IiwidG9TdGF0ZSIsInRpdGxlIiwiZGF0YSIsInBhZ2VUaXRsZSIsIiRvbiIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwic3RhdGUiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJyZXF1aXJlTG9naW4iLCJhYnN0cmFjdCIsInZpZXdzIiwiQCIsInNpZGViYXJAYXBwIiwib3RoZXJ3aXNlIiwicnVuIiwiJHN0YXRlIiwiZG9jdW1lbnQiLCJib2R5Iiwic2Nyb2xsVG9wIiwiZG9jdW1lbnRFbGVtZW50IiwidG9QYXJhbXMiLCJwcmV2ZW50RGVmYXVsdCIsImdvIiwic2VydmljZSIsIiR3aW5kb3ciLCIkcSIsInRoaXMiLCJjcmVhdGUiLCJ1c2VyIiwibG9jYWxTdG9yYWdlIiwiand0IiwidXNlcklkIiwiX2lkIiwiY3VycmVudFVzZXIiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVzdHJveSIsInJlc29sdmUiLCJyZWplY3QiLCJnZXRVc2VySWQiLCJnZXRVc2VyIiwicGFyc2UiLCIkaHR0cCIsInVzZXJzIiwiYmFzZSIsIlVzZXJTZXJ2aWNlIiwiZ2V0VXNlcnMiLCJvcHRpb25zIiwiJCIsInBhcmFtIiwidGV4dCIsInBhZ2UiLCJzaXplIiwiZ2V0IiwiY2hlY2tpbiIsInBvc3QiLCJjaGVja291dCIsImxvZ2luU3VjY2VzcyIsInJlc3BvbnNlIiwiY29uc29sZSIsImxvZyIsImxvZ2luRmFpbHVyZSIsImNhbGxiYWNrIiwiYXV0aFNlcnZpY2UiLCJiYXNlVXJsIiwibG9naW5XaXRoUGFzc3dvcmQiLCJlbWFpbCIsInBhc3N3b3JkIiwidGhlbiIsImxvZ2luV2l0aFRva2VuIiwid2FybiIsInN0YXR1cyIsIiRzY29wZSIsImJ1c3kiLCJuZXh0UGFnZSIsInRvdGFsUGFnZXMiLCJJbmZpbml0eSIsInNlbGVjdGVkVXNlciIsInNldFNlbGVjdGVkVXNlciIsIiR1c2VyRGV0YWlscyIsIm1vZGFsIiwiZ2V0TmV4dFBhZ2UiLCJjb25jYXQiLCJiaW5kIiwiQXV0aFNlcnZpY2UiLCJvblN1Y2Nlc3MiLCJvbkZhaWx1cmUiLCJsb2dpbiIsImNvbnN0YW50Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLFdBQ0EsWUFDQSxtQkFHQUYsS0FBQUcsUUFDQSxnQkFDQSxTQUFBQyxFQUFBQyxHQUdBRCxFQUFBRSxhQUFBQyxLQUFBLHVCQUlBUCxJQUFBUSxRQUFBLG9CQUNBLFVBQ0EsYUFDQSxTQUFBQyxFQUFBSixHQUNBLE9BQ0FLLFFBQUEsU0FBQVAsR0FDQSxJQUFBQSxFQUFBUSxJQUFBQyxRQUFBLFNBQUEsSUFBQVQsRUFBQVEsSUFBQUMsUUFBQSxXQUNBVCxFQUFBUSxJQUFBTixFQUFBUSxTQUFBVixFQUFBUSxJQUNBUixFQUFBVyxRQUFBLCtCQUFBVCxFQUFBUSxTQUVBLElBQUFFLEdBQUFOLEVBQUFPLFVBSUEsT0FIQUQsS0FDQVosRUFBQVcsUUFBQSxrQkFBQUMsR0FFQVosT0FNQUgsSUFBQWlCLFVBQUEsU0FBQSxhQUFBLFdBQ0EsU0FBQUMsRUFBQUMsR0FDQSxPQUNBQyxLQUFBLFdBRUEsR0FBQUMsR0FBQSxTQUFBQyxFQUFBQyxHQUVBSixFQUFBLFdBQ0FELEVBQUFNLE1BQUFELEVBQUFFLE1BQUFGLEVBQUFFLEtBQUFDLFVBQ0FILEVBQUFFLEtBQUFDLFVBQUEsa0JBSUFSLEdBQUFTLElBQUEsc0JBQUFOLFFDL0NBcEIsUUFBQUMsT0FBQSxXQUNBQyxRQUNBLGlCQUNBLHFCQUNBLFNBQ0F5QixFQUNBQyxHQUNBRCxFQUNBRSxNQUFBLFNBQ0FuQixJQUFBLFNBQ0FvQixZQUFBLHlCQUNBQyxXQUFBLGtCQUNBUCxNQUNBUSxjQUFBLEVBQ0FQLFVBQUEsV0FHQUksTUFBQSxPQUNBSSxVQUFBLEVBQ0FDLE9BQ0FDLEtBQ0FMLFlBQUEsbUJBRUFNLGVBQ0FOLFlBQUEsNkJBQ0FDLFdBQUEsc0JBR0FQLE1BQ0FRLGNBQUEsRUFDQVAsVUFBQSxhQUdBSSxNQUFBLGVBQ0FuQixJQUFBLElBQ0FvQixZQUFBLDZCQUNBQyxXQUFBLHNCQUdBSCxFQUFBUyxVQUFBLFVBR0FDLEtBQ0EsYUFDQSxTQUNBLFVBQ0EsU0FDQXJCLEVBQ0FzQixFQUNBL0IsR0FFQVMsRUFBQVMsSUFBQSxzQkFBQSxXQUNBYyxTQUFBQyxLQUFBQyxVQUFBRixTQUFBRyxnQkFBQUQsVUFBQSxJQUdBekIsRUFBQVMsSUFBQSxvQkFBQSxTQUFBTCxFQUFBQyxFQUFBc0IsR0FDQSxHQUFBWixHQUFBVixFQUFBRSxLQUFBUSxZQUVBQSxLQUFBeEIsRUFBQU8sYUFDQU0sRUFBQXdCLGlCQUNBTixFQUFBTyxHQUFBLGVDNURBOUMsUUFBQUMsT0FBQSxXQUNBOEMsUUFBQSxXQUNBLGFBQ0EsVUFDQSxLQUNBLFNBQUE5QixFQUFBK0IsRUFBQUMsR0FDQUMsS0FBQUMsT0FBQSxTQUFBckMsRUFBQXNDLEdBQ0FKLEVBQUFLLGFBQUFDLElBQUF4QyxFQUNBa0MsRUFBQUssYUFBQUUsT0FBQUgsRUFBQUksSUFDQVIsRUFBQUssYUFBQUksWUFBQUMsS0FBQUMsVUFBQVAsR0FDQW5DLEVBQUF3QyxZQUFBTCxHQUdBRixLQUFBVSxRQUFBLFdBS0EsYUFKQVosR0FBQUssYUFBQUMsVUFDQU4sR0FBQUssYUFBQUUsYUFDQVAsR0FBQUssYUFBQUksWUFDQXhDLEVBQUF3QyxZQUFBLEtBQ0FSLEVBQUEsU0FBQVksRUFBQUMsR0FDQUQsT0FJQVgsS0FBQW5DLFNBQUEsV0FDQSxNQUFBaUMsR0FBQUssYUFBQUMsS0FHQUosS0FBQWEsVUFBQSxXQUNBLE1BQUFmLEdBQUFLLGFBQUFFLFFBR0FMLEtBQUFjLFFBQUEsV0FDQSxNQUFBTixNQUFBTyxNQUFBakIsRUFBQUssYUFBQUksaUJDaENBekQsUUFBQUMsT0FBQSxXQUNBTSxRQUFBLGVBQ0EsS0FDQSxRQUNBLFVBQ0EsU0FBQTBDLEVBQUFpQixFQUFBMUQsR0FDQSxHQUFBMkQsR0FBQSxZQUNBQyxFQUFBRCxFQUFBLElBRUFFLElBcUJBLE9BbkJBQSxHQUFBQyxTQUFBLFNBQUFDLEdBQ0EsR0FBQTdELEdBQUE2RCxFQUFBSixFQUFBLElBQUFLLEVBQUFDLE9BRUFDLEtBQUFILEVBQUFHLEtBQ0FDLEtBQUFKLEVBQUFJLEtBQUFKLEVBQUFJLEtBQUEsRUFDQUMsS0FBQUwsRUFBQUssS0FBQUwsRUFBQUssS0FBQSxLQUNBUixDQUVBLE9BQUFGLEdBQUFXLElBQUFuRSxJQUdBMkQsRUFBQVMsUUFBQSxTQUFBdkIsR0FDQSxNQUFBVyxHQUFBYSxLQUFBWCxFQUFBYixFQUFBLGFBR0FjLEVBQUFXLFNBQUEsU0FBQXpCLEdBQ0EsTUFBQVcsR0FBQWEsS0FBQVgsRUFBQWIsRUFBQSxjQUdBYyxLQzlCQXJFLFFBQUFDLE9BQUEsV0FDQU0sUUFBQSxlQUNBLEtBQ0EsUUFDQSxhQUNBLFNBQ0EsVUFDQSxTQUFBMEMsRUFBQWlCLEVBQUFqRCxFQUFBc0IsRUFBQS9CLEdBSUEsUUFBQXlFLEdBQUFDLEdBQ0EsR0FBQTFELEdBQUEwRCxFQUFBMUQsSUFHQSxPQUZBMkQsU0FBQUMsSUFBQSxlQUFBNUQsR0FDQWhCLEVBQUEyQyxPQUFBM0IsRUFBQVYsTUFBQVUsRUFBQTRCLE1BQ0FILEVBQUEsU0FBQVksR0FDQUEsRUFBQXJDLEVBQUE0QixRQUlBLFFBQUFpQyxHQUFBN0QsRUFBQThELEdBR0EsTUFGQUgsU0FBQUMsSUFBQSxZQUFBNUQsR0FDQWUsRUFBQU8sR0FBQSxTQUNBRyxFQUFBLFNBQUFZLEVBQUFDLEdBQ0FBLEVBQUF0QyxLQWhCQSxHQUFBK0QsTUFDQUMsRUFBQSxPQTJDQSxPQXZCQUQsR0FBQUUsa0JBQUEsU0FBQUMsRUFBQUMsR0FDQSxNQUFBekIsR0FDQWEsS0FBQVMsRUFBQSxTQUNBRSxNQUFBQSxFQUNBQyxTQUFBQSxJQUVBQyxLQUFBWCxFQUFBSSxJQUlBRSxFQUFBTSxlQUFBLFNBQUEvRSxHQUVBLE1BREFxRSxTQUFBVyxLQUFBLHdDQUNBNUIsRUFDQWEsS0FBQVMsRUFBQSxTQUNBMUUsTUFBQUEsSUFFQThFLEtBQUFYLEVBQUEsV0FDQSxNQUFBYyxRQUNBdkYsRUFBQW9ELFVBQUFnQyxLQUFBUCxNQUtBRSxLQ3BEQXZGLFFBQUFDLE9BQUEsV0FDQThCLFdBQUEscUJBQ0EsU0FDQSxjQUNBLFNBQUFpRSxFQUFBM0IsR0FFQTJCLEVBQUE3QixPQUNBQSxTQUNBOEIsTUFBQSxFQUNBQyxTQUFBLEVBQ0FDLFdBQUFDLEVBQUFBLEdBR0FKLEVBQUFLLGFBQUEsS0FDQUwsRUFBQU0sZ0JBQUEsU0FBQWxELEdBQ0EsR0FBQW1ELEdBQUEvQixFQUFBLHdCQUNBK0IsR0FBQUMsUUFDQVIsRUFBQUssYUFBQWpELEVBQ0FBLEVBQ0FtRCxFQUFBQyxNQUFBLFFBRUFELEVBQUFDLE1BQUEsU0FLQVIsRUFBQTdCLE1BQUFzQyxZQUFBLFdBQ0F2RCxLQUFBK0MsTUFDQS9DLEtBQUFnRCxVQUFBaEQsS0FBQWlELGFBRUFqRCxLQUFBK0MsTUFBQSxFQUVBNUIsRUFBQUMsVUFDQUssS0FBQXpCLEtBQUFnRCxXQUNBTixLQUFBLFNBQUFWLEdBQ0FDLFFBQUFDLElBQUFGLEVBQUExRCxNQUVBMEIsS0FBQWlCLE1BQUFqQixLQUFBaUIsTUFBQXVDLE9BQUF4QixFQUFBMUQsS0FBQTJDLE9BRUFqQixLQUFBaUQsV0FBQWpCLEVBQUExRCxLQUFBMkUsV0FDQWpELEtBQUFnRCxVQUFBLEVBQ0FoRCxLQUFBK0MsTUFBQSxHQUNBVSxLQUFBekQsU0FJQThDLEVBQUFsQixRQUFBLFNBQUF2QixHQUNBYyxFQUFBUyxRQUFBdkIsR0FDQXFDLEtBQUEsU0FBQXBFLEdBQ0EyRCxRQUFBQyxJQUFBLGFBQUE1RCxNQUlBd0UsRUFBQWhCLFNBQUEsU0FBQXpCLEdBQ0FjLEVBQUFXLFNBQUF6QixHQUNBcUMsS0FBQSxTQUFBcEUsR0FDQTJELFFBQUFDLElBQUEsY0FBQTVELFNDeERBeEIsUUFBQUMsT0FBQSxXQUNBOEIsV0FBQSxtQkFDQSxTQUNBLGNBQ0EsU0FBQWlFLEVBQUFZLEdBRUEsUUFBQUMsR0FBQXJGLEdBQ0EyRCxRQUFBQyxJQUFBLFVBQUE1RCxHQUdBLFFBQUFzRixHQUFBdEYsR0FDQTJELFFBQUFDLElBQUEsVUFBQTVELEdBR0F3RSxFQUFBZSxNQUFBLFdBQ0FILEVBQUFuQixrQkFDQU8sRUFBQU4sTUFBQU0sRUFBQUwsVUFDQUMsS0FBQWlCLEVBQUFDLE9DakJBOUcsUUFBQUMsT0FBQSxXQUNBOEIsV0FBQSxxQkFDQSxTQUNBLFVBQ0EsU0FBQWlFLEVBQUF4RixPQ0RBUixRQUFBQyxPQUFBLFdBQUErRyxTQUFBLGNBQ0FwRyxTQUFBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nLCBbXG4gICd1aS5yb3V0ZXInLFxuICAnaW5maW5pdGUtc2Nyb2xsJyxcbl0pO1xuXG5hcHAuY29uZmlnKFtcbiAgJyRodHRwUHJvdmlkZXInLFxuICBmdW5jdGlvbigkaHR0cFByb3ZpZGVyLCBTRVJWRVJfVVJMKSB7XG5cbiAgICAvLyBhZGQgcm9vdCB1cmwgdG8gYWxsIGFwaSBhbmQgYXV0aCByZXF1ZXN0c1xuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0FwaUF1dGhlbnRpY2F0b3InKTtcbiAgfVxuXSk7XG5cbmFwcC5mYWN0b3J5KCdBcGlBdXRoZW50aWNhdG9yJywgW1xuICAnU2Vzc2lvbicsXG4gICdTRVJWRVJfVVJMJyxcbiAgZnVuY3Rpb24oU2Vzc2lvbiwgU0VSVkVSX1VSTCkge1xuICAgIHJldHVybiB7XG4gICAgICByZXF1ZXN0OiBmdW5jdGlvbihjb25maWcpIHtcbiAgICAgICAgaWYgKGNvbmZpZy51cmwuaW5kZXhPZignYXBpLycpID09PSAwIHx8IGNvbmZpZy51cmwuaW5kZXhPZignYXV0aC8nKSA9PT0gMCkge1xuICAgICAgICAgIGNvbmZpZy51cmwgPSBTRVJWRVJfVVJMLkJBU0VfVVJMICsgY29uZmlnLnVybDtcbiAgICAgICAgICBjb25maWcuaGVhZGVyc1snQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJ10gPSBTRVJWRVJfVVJMLkJBU0VfVVJMO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0b2tlbiA9IFNlc3Npb24uZ2V0VG9rZW4oKTtcbiAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ3gtYWNjZXNzLXRva2VuJ10gPSB0b2tlbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgfVxuICAgIH07XG4gIH1cbl0pO1xuXG5hcHAuZGlyZWN0aXZlKCd0aXRsZScsIFsnJHJvb3RTY29wZScsICckdGltZW91dCcsXG4gIGZ1bmN0aW9uKCRyb290U2NvcGUsICR0aW1lb3V0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxpbms6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uKGV2ZW50LCB0b1N0YXRlKSB7XG5cbiAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUudGl0bGUgPSAodG9TdGF0ZS5kYXRhICYmIHRvU3RhdGUuZGF0YS5wYWdlVGl0bGUpID9cbiAgICAgICAgICAgICAgdG9TdGF0ZS5kYXRhLnBhZ2VUaXRsZSA6ICdEZWZhdWx0IHRpdGxlJztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmNvbmZpZyhbXG4gICAgJyRzdGF0ZVByb3ZpZGVyJyxcbiAgICAnJHVybFJvdXRlclByb3ZpZGVyJyxcbiAgICBmdW5jdGlvbihcbiAgICAgICRzdGF0ZVByb3ZpZGVyLFxuICAgICAgJHVybFJvdXRlclByb3ZpZGVyKSB7XG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgICAgICAgIHVybDogJy9sb2dpbicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9sb2dpbi9sb2dpbi5odG1sXCIsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgcmVxdWlyZUxvZ2luOiBmYWxzZSxcbiAgICAgICAgICAgICAgcGFnZVRpdGxlOiAnTG9naW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zdGF0ZSgnYXBwJywge1xuICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAnQCc6IHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9iYXNlLmh0bWxcIixcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgJ3NpZGViYXJAYXBwJzoge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL3NpZGViYXIvc2lkZWJhci5odG1sXCIsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1NpZGViYXJDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHJlcXVpcmVMb2dpbjogdHJ1ZSxcbiAgICAgICAgICAgICAgcGFnZVRpdGxlOiAnQ2hlY2tpbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnN0YXRlKCdhcHAuY2hlY2tpbicsIHtcbiAgICAgICAgICAgIHVybDogJy8nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jaGVja2luL2NoZWNraW4uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ2hlY2tpbkNvbnRyb2xsZXInLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJzQwNCcpO1xuICAgIH1cbiAgXSlcbiAgLnJ1bihbXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbihcbiAgICAgICRyb290U2NvcGUsXG4gICAgICAkc3RhdGUsXG4gICAgICBTZXNzaW9uKXtcblxuICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDA7XG4gICAgICB9KTtcblxuICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcykge1xuICAgICAgICB2YXIgcmVxdWlyZUxvZ2luID0gdG9TdGF0ZS5kYXRhLnJlcXVpcmVMb2dpbjtcblxuICAgICAgICBpZiAocmVxdWlyZUxvZ2luICYmICFTZXNzaW9uLmdldFRva2VuKCkpIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgICAgfVxuXG4gICAgICB9KTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuc2VydmljZSgnU2Vzc2lvbicsIFtcbiAgICAnJHJvb3RTY29wZScsXG4gICAgJyR3aW5kb3cnLFxuICAgICckcScsXG4gICAgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHdpbmRvdywgJHEpe1xuICAgICAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbih0b2tlbiwgdXNlcil7XG4gICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dCA9IHRva2VuO1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS51c2VySWQgPSB1c2VyLl9pZDtcbiAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIgPSBKU09OLnN0cmluZ2lmeSh1c2VyKTtcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbigpe1xuICAgICAgICBkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0O1xuICAgICAgICBkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2UudXNlcklkO1xuICAgICAgICBkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXI7XG4gICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0O1xuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRVc2VySWQgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudXNlcklkO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIpO1xuICAgICAgfTtcbiAgfV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBbXG4gICAgJyRxJyxcbiAgICAnJGh0dHAnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkcSwgJGh0dHAsIFNlc3Npb24pIHtcbiAgICAgIHZhciB1c2VycyA9ICdhcGkvdXNlcnMnO1xuICAgICAgdmFyIGJhc2UgPSB1c2VycyArICcvJztcblxuICAgICAgdmFyIFVzZXJTZXJ2aWNlID0ge307XG5cbiAgICAgIFVzZXJTZXJ2aWNlLmdldFVzZXJzID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB2YXIgdXJsID0gb3B0aW9ucyA/IHVzZXJzICsgJz8nICsgJC5wYXJhbShcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0ZXh0OiBvcHRpb25zLnRleHQsXG4gICAgICAgICAgICBwYWdlOiBvcHRpb25zLnBhZ2UgPyBvcHRpb25zLnBhZ2UgOiAwLFxuICAgICAgICAgICAgc2l6ZTogb3B0aW9ucy5zaXplID8gb3B0aW9ucy5zaXplIDogNTBcbiAgICAgICAgICB9KSA6IGJhc2U7XG5cbiAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpO1xuICAgICAgfTtcblxuICAgICAgVXNlclNlcnZpY2UuY2hlY2tpbiA9IGZ1bmN0aW9uKHVzZXJJZCkge1xuICAgICAgICByZXR1cm4gJGh0dHAucG9zdChiYXNlICsgdXNlcklkICsgJy9jaGVja2luJyk7XG4gICAgICB9O1xuXG4gICAgICBVc2VyU2VydmljZS5jaGVja291dCA9IGZ1bmN0aW9uKHVzZXJJZCkge1xuICAgICAgICByZXR1cm4gJGh0dHAucG9zdChiYXNlICsgdXNlcklkICsgJy9jaGVja291dCcpO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIFVzZXJTZXJ2aWNlO1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5mYWN0b3J5KCdBdXRoU2VydmljZScsIFtcbiAgICAnJHEnLFxuICAgICckaHR0cCcsXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkcSwgJGh0dHAsICRyb290U2NvcGUsICRzdGF0ZSwgU2Vzc2lvbikge1xuICAgICAgdmFyIGF1dGhTZXJ2aWNlID0ge307XG4gICAgICB2YXIgYmFzZVVybCA9ICdhdXRoLyc7XG5cbiAgICAgIGZ1bmN0aW9uIGxvZ2luU3VjY2VzcyhyZXNwb25zZSkge1xuICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIGNvbnNvbGUubG9nKCdhdXRoIHN1Y2Nlc3MnLCBkYXRhKTtcbiAgICAgICAgU2Vzc2lvbi5jcmVhdGUoZGF0YS50b2tlbiwgZGF0YS51c2VyKTtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgICByZXNvbHZlKGRhdGEudXNlcik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBsb2dpbkZhaWx1cmUoZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2F1dGggZmFpbCcsIGRhdGEpO1xuICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICByZWplY3QoZGF0YSk7XG4gICAgICAgIH0pO1xuXG4gICAgICB9XG5cbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luV2l0aFBhc3N3b3JkID0gZnVuY3Rpb24oZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgIC5wb3N0KGJhc2VVcmwgKyAnbG9naW4nLCB7XG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbihsb2dpblN1Y2Nlc3MsIGxvZ2luRmFpbHVyZSk7XG4gICAgICB9O1xuXG4gICAgICAvLyBUT0RPIHVuc3VyZSBpZiB0aGlzIHdvcmtzIVxuICAgICAgYXV0aFNlcnZpY2UubG9naW5XaXRoVG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJOb3QgYWN0dWFsbHkgc3VyZSBpZiB0aGlzIHdvcmtzIHlldCFcIik7XG4gICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgIC5wb3N0KGJhc2VVcmwgKyAnbG9naW4nLCB7XG4gICAgICAgICAgICB0b2tlbjogdG9rZW5cbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKGxvZ2luU3VjY2VzcywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgU2Vzc2lvbi5kZXN0cm95KCkudGhlbihsb2dpbkZhaWx1cmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlO1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb250cm9sbGVyKCdDaGVja2luQ29udHJvbGxlcicsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnVXNlclNlcnZpY2UnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNlcnZpY2UpIHtcblxuICAgICAgJHNjb3BlLnVzZXJzID0ge1xuICAgICAgICB1c2VyczogW10sXG4gICAgICAgIGJ1c3k6IGZhbHNlLFxuICAgICAgICBuZXh0UGFnZTogMCxcbiAgICAgICAgdG90YWxQYWdlczogSW5maW5pdHksXG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUuc2VsZWN0ZWRVc2VyID0gbnVsbDtcbiAgICAgICRzY29wZS5zZXRTZWxlY3RlZFVzZXIgPSBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgIHZhciAkdXNlckRldGFpbHMgPSAkKCcudWkubW9kYWwudXNlckRldGFpbHMnKTtcbiAgICAgICAgJHVzZXJEZXRhaWxzLm1vZGFsKCk7XG4gICAgICAgICRzY29wZS5zZWxlY3RlZFVzZXIgPSB1c2VyO1xuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICR1c2VyRGV0YWlscy5tb2RhbCgnc2hvdycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICR1c2VyRGV0YWlscy5tb2RhbCgnaGlkZScpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG5cbiAgICAgICRzY29wZS51c2Vycy5nZXROZXh0UGFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5idXN5KSB7IHJldHVybjsgfVxuICAgICAgICBpZiAodGhpcy5uZXh0UGFnZSA+PSB0aGlzLnRvdGFsUGFnZXMpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdGhpcy5idXN5ID0gdHJ1ZTtcblxuICAgICAgICBVc2VyU2VydmljZS5nZXRVc2Vycyh7XG4gICAgICAgICAgcGFnZTogdGhpcy5uZXh0UGFnZSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuXG4gICAgICAgICAgdGhpcy51c2VycyA9IHRoaXMudXNlcnMuY29uY2F0KHJlc3BvbnNlLmRhdGEudXNlcnMpO1xuXG4gICAgICAgICAgdGhpcy50b3RhbFBhZ2VzID0gcmVzcG9uc2UuZGF0YS50b3RhbFBhZ2VzO1xuICAgICAgICAgIHRoaXMubmV4dFBhZ2UgKz0gMTtcbiAgICAgICAgICB0aGlzLmJ1c3kgPSBmYWxzZTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgIH07XG5cblxuICAgICAgJHNjb3BlLmNoZWNraW4gPSBmdW5jdGlvbih1c2VySWQpIHtcbiAgICAgICAgVXNlclNlcnZpY2UuY2hlY2tpbih1c2VySWQpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NoZWNrZWQgaW4nLCBkYXRhKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5jaGVja291dCA9IGZ1bmN0aW9uKHVzZXJJZCkge1xuICAgICAgICBVc2VyU2VydmljZS5jaGVja291dCh1c2VySWQpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NoZWNrZWQgb3V0JywgZGF0YSk7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBbXG4gICAgJyRzY29wZScsXG4gICAgJ0F1dGhTZXJ2aWNlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsIEF1dGhTZXJ2aWNlKSB7XG5cbiAgICAgIGZ1bmN0aW9uIG9uU3VjY2VzcyhkYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzdWNjZXNzJywgZGF0YSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIG9uRmFpbHVyZShkYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdmYWlsdXJlJywgZGF0YSk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBBdXRoU2VydmljZS5sb2dpbldpdGhQYXNzd29yZChcbiAgICAgICAgICAkc2NvcGUuZW1haWwsICRzY29wZS5wYXNzd29yZFxuICAgICAgICApLnRoZW4ob25TdWNjZXNzLCBvbkZhaWx1cmUpO1xuICAgICAgfTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuY29udHJvbGxlcignU2lkZWJhckNvbnRyb2xsZXInLCBbXG4gICAgJyRzY29wZScsXG4gICAgJ1Nlc3Npb24nLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgU2Vzc2lvbikge1xuICAgIH1cbiAgXSk7XG4iLCIvKipcbiAqIEhlcmUgbGF5IHRoZSBiYXNlIHVybHMgdXNlZCBpbiB0aGUgaHR0cCB1cmwgaW5qZWN0b3JcbiAqL1xuYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKS5jb25zdGFudCgnU0VSVkVSX1VSTCcsIHtcbiAgQkFTRV9VUkw6ICAnaHR0cHM6Ly9jZTRlNzU3MS5uZ3Jvay5pby8nLFxuICAvLyBCQVNFX1VSTDogICdodHRwczovL2FwcGx5LmhhY2tndC5jb20vJyxcblxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
