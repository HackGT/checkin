var app=angular.module("checkin",["ui.router"]);app.config(["$httpProvider",function(e,t){e.interceptors.push("ApiAuthenticator")}]),app.factory("ApiAuthenticator",["Session","SERVER_URL",function(e,t){return{request:function(n){0!==n.url.indexOf("api/")&&0!==n.url.indexOf("auth/")||(n.url=t.BASE_URL+n.url,n.headers["Access-Control-Allow-Origin"]=t.BASE_URL);var r=e.getToken();return r&&(n.headers["x-access-token"]=r),n}}}]),app.directive("title",["$rootScope","$timeout",function(e,t){return{link:function(){var n=function(n,r){t(function(){e.title=r.data&&r.data.pageTitle?r.data.pageTitle:"Default title"})};e.$on("$stateChangeSuccess",n)}}}]),angular.module("checkin").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("login",{url:"/login",templateUrl:"views/login/login.html",controller:"LoginController",data:{requireLogin:!1,pageTitle:"Login"}}).state("app",{abstract:!0,views:{"@":{templateUrl:"views/base.html"},"toolbar@app":{templateUrl:"views/toolbar/toolbar.html",controller:"ToolbarController"}},data:{requireLogin:!0,pageTitle:"Checkin"}}).state("app.checkin",{url:"/checkin",templateUrl:"views/checkin/checkin.html",controller:"CheckinController"}).state("app.groups",{url:"/groups",templateUrl:"views/groups/groups.html",controller:"GroupsController"}),t.otherwise("/checkin")}]).run(["$rootScope","$state","Session",function(e,t,n){e.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0}),e.$on("$stateChangeStart",function(e,r,o){var u=r.data.requireLogin;u&&!n.getToken()&&(e.preventDefault(),t.go("login"))}),n.getToken()||t.go("login")}]),angular.module("checkin").factory("AuthService",["$q","$http","$rootScope","$state","Session",function(e,t,n,r,o){function u(t){var n=t.data;return console.log("auth success",n),o.create(n.token,n.user),e(function(e){e(n.user)})}function s(t,n){return console.log("auth fail",t),r.go("login"),e(function(e,n){n(t)})}var c={},i="auth/";return c.loginWithPassword=function(e,n){return t.post(i+"login",{email:e,password:n}).then(function(e){if(user=e.data.user,!(user.admin||user.checkin&&(user.checkin.groups.length>0||user.checkin.all)))throw new Error("User is not an admin or volunteer");return e}).then(u,s)},c.loginWithToken=function(e){return console.warn("Not actually sure if this works yet!"),t.post(i+"login",{token:e}).then(u,function(){400===status&&o.destroy().then(s)})},c}]),angular.module("checkin").factory("GroupService",["$q","$http","Session",function(e,t,n){var r="api/groups/",o={};return o.getGroups=function(){return t.get(r)},o.createGroup=function(e){return t.post(r,{groupName:e})},o.getVolunteers=function(e){return t.get(r+e+"/volunteers")},o.addVolunteerToGroup=function(e,n){return t.put(r+n+"/volunteers/"+e)},o.removeVolunteerFromGroup=function(e,n){return t.delete(r+n+"/volunteers/"+e)},o.addUsersToGroup=function(e,n){return t.put(r+e+"/users",{users:n})},o.removeUsersFromGroup=function(e,n){return t.delete(r+e+"/users",{users:n})},o}]),angular.module("checkin").service("Session",["$rootScope","$window","$q",function(e,t,n){this.create=function(n,r){t.localStorage.jwt=n,t.localStorage.userId=r._id,t.localStorage.currentUser=JSON.stringify(r),e.currentUser=r},this.destroy=function(){return delete t.localStorage.jwt,delete t.localStorage.userId,delete t.localStorage.currentUser,e.currentUser=null,n(function(e,t){e()})},this.getToken=function(){return t.localStorage.jwt},this.getUserId=function(){return t.localStorage.userId},this.getUser=function(){return JSON.parse(t.localStorage.currentUser)}}]),angular.module("checkin").factory("UserService",["$q","$http","Session",function(e,t,n){var r="api/users",o=r+"/",u="api/groups/",s={};return s.getUsers=function(e){var u=n.getUser();u.admin||u.checkin&&u.checkin.all||e.group||(e.group=u.checkin.groups),e.group&&!Array.isArray(e.group)&&(e.group=[e.group]),void 0===e.page&&void 0===e.size||(e.page=e.page||0,e.size=e.size||50);var s=e?r+"?"+$.param({text:e.text,page:e.page,size:e.size,group:e.group}):o;return t.get(s)},s.checkin=function(e){var r=e._id,s=o+r+"/checkin",c=n.getUser();if(!(c.admin||c.checkin&&c.checkin.all)){var i=e.groups.find(function(e){return c.checkin.groups.indexOf(e)!==-1});s=u+i+"/users/"+r+"/checkin"}return t.post(s)},s.checkout=function(e){var r=e._id,s=o+r+"/checkout",c=n.getUser();if(!(c.admin||c.checkin&&c.checkin.all)){var i=e.groups.find(function(e){return c.checkin.groups.indexOf(e)!==-1});s=u+i+"/users/"+r+"/checkout"}return t.post(s)},s}]),angular.module("checkin").controller("GroupsController",["$scope","UserService","GroupService",function(e,t,n){function r(t){t=t||e.selectedGroup.searchUsers,e.selectedGroup.searchUsers=t.filter(function(t){return e.selectedGroup.users.findIndex(function(e){return e._id===t._id})===-1})}function o(){return!e.userQuery||e.userQuery.length<3?null:e.userQuery}e.groups=[],e.getGroups=function(){n.getGroups().then(function(t){e.groups=t.data})},e.getGroups(),e.createGroup=function(t){t&&n.createGroup(t).then(function(t){e.groups.push(t.data)})},e.selectedGroup=null,e.selectGroup=function(r){e.selectedNewVolunteer=null,e.selectedGroup=r,n.getVolunteers(r._id).then(function(t){e.selectedGroup.volunteers=t.data.volunteers}),t.getUsers({group:r._id}).then(function(t){e.selectedGroup.users=t.data.users})},e.selectedNewVolunteer=null,e.setSelectedNewVolunteer=function(t){e.selectedNewVolunteer=t,t&&e.$apply()},e.addNewVolunteer=function(t,r){n.addVolunteerToGroup(t._id,r._id).then(function(t){e.selectedGroup.volunteers.push(t.data),e.setSelectedNewVolunteer(null)})},e.removeVolunteerFromGroup=function(t,r){n.removeVolunteerFromGroup(t._id,r._id).then(function(t){e.selectedGroup.volunteers.splice(e.selectedGroup.volunteers.findIndex(function(e){return e._id===t.data._id}),1)})},$(".add-volunteer").search({apiSettings:{responseAsync:function(n,r){n.urlData.query;t.getUsers({text:n.urlData.query}).then(function(t){results=t.data.users.filter(function(t){return e.selectedGroup.volunteers.findIndex(function(e){return e._id===t._id})===-1}).map(function(e){return{title:e.profile.name||e.email,description:e.profile.name?e.email:void 0,user:e}}),r({results:results})})}},minCharacters:3,onSelect:function(t){e.setSelectedNewVolunteer(t.user)}});var u=null;e.searchUsers=function(){var e=o();console.log("query:",e),e&&e!==u&&(u=e,t.getUsers({text:e}).then(function(t){e===u&&(console.log(t.data),r(t.data.users))}))},e.addUsersToGroup=function(){var t=e.selectedGroup.searchUsers.filter(function(e){return e.active}).map(function(e){return e._id});n.addUsersToGroup(e.selectedGroup._id,t).then(function(t){e.selectedGroup.users=t.data.users,r()})},e.addAllUsersToGroup=function(){var t=e.selectedGroup.searchUsers.map(function(e){return e._id});n.addUsersToGroup(e.selectedGroup._id,t).then(function(t){e.selectedGroup.users=t.data.users,r()})}}]),angular.module("checkin").controller("CheckinController",["$scope","UserService",function(e,t){function n(){return e.query?e.query.length>0&&e.query.length<3?i:e.query:null}function r(){e.users={users:[],busy:!1,nextPage:0,totalPages:0,totalUsers:0,getNextPage:function(){this.busy||(this.busy=!0,t.getUsers({text:n(),page:this.nextPage}).then(o.bind(this)),this.nextPage=this.nextPage+1)}}}function o(e){console.log(e.data),this.users=this.users.concat(e.data.users),this.totalUsers=e.data.totalUsers,this.totalPages=e.data.totalPages,this.nextPage=this.nextPage+1,this.busy=!1,c.sticky("refresh")}function u(e){return t.checkin(e).then(function(t){return console.log("checked in",t),e.status.checkedIn=!0,e})}function s(e){return t.checkout(e).then(function(t){return console.log("checked out",t),e.status.checkedIn=!1,e})}var c=$(".userSearch > .sticky");c.sticky({context:".userList > table"});var i=null;e.searchUsers=function(){var u=n();console.log("query:",u),u!==i&&(i=u,t.getUsers({page:0,text:u}).then(function(t){u===i&&(r(),o.bind(e.users)(t))}))},e.users={},r(),e.selectedUser=null;var l=$(".userDetails");$(".smsNotifications");e.setSelectedUser=function(t){e.selectedUser=t,t?l.modal({onApprove:function(){u(t).then(function(e){})},onDeny:function(){s(t).then(function(e){})}}).modal("show"):l.modal("hide")},e.users.getNextPage()}]),angular.module("checkin").controller("LoginController",["$scope","$state","AuthService",function(e,t,n){function r(e){console.log("success",e),t.go("app.checkin")}function o(e){console.log("failure",e)}e.login=function(){n.loginWithPassword(e.email,e.password).then(r,o)}}]),angular.module("checkin").controller("ToolbarController",["$scope","$state","$rootScope","Session",function(e,t,n,r){var o=r.getUser();e.states=[{name:"app.checkin",title:"Checkin"},{name:"app.groups",title:"Groups",adminOnly:!0}].filter(function(e){return!(e.adminOnly&&!o.admin)}),$(".logout").click(function(){r.destroy().then(function(){t.go("login")})})}]),angular.module("checkin").constant("SERVER_URL",{BASE_URL:"https://apply.hackgt.com/"});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJvdXRlcy5qcyIsInNlcnZpY2VzL0F1dGhTZXJ2aWNlLmpzIiwic2VydmljZXMvR3JvdXBTZXJ2aWNlLmpzIiwic2VydmljZXMvU2Vzc2lvbi5qcyIsInNlcnZpY2VzL1VzZXJTZXJ2aWNlLmpzIiwiZ3JvdXBzL2dyb3Vwc0NvbnRyb2xsZXIuanMiLCJjaGVja2luL2NoZWNraW5Db250cm9sbGVyLmpzIiwibG9naW4vbG9naW5Db250cm9sbGVyLmpzIiwidG9vbGJhci90b29sYmFyQ29udHJvbGxlci5qcyIsImNvbmZpZy5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJGh0dHBQcm92aWRlciIsIlNFUlZFUl9VUkwiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwiZmFjdG9yeSIsIlNlc3Npb24iLCJyZXF1ZXN0IiwidXJsIiwiaW5kZXhPZiIsIkJBU0VfVVJMIiwiaGVhZGVycyIsInRva2VuIiwiZ2V0VG9rZW4iLCJkaXJlY3RpdmUiLCIkcm9vdFNjb3BlIiwiJHRpbWVvdXQiLCJsaW5rIiwibGlzdGVuZXIiLCJldmVudCIsInRvU3RhdGUiLCJ0aXRsZSIsImRhdGEiLCJwYWdlVGl0bGUiLCIkb24iLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicmVxdWlyZUxvZ2luIiwiYWJzdHJhY3QiLCJ2aWV3cyIsIkAiLCJ0b29sYmFyQGFwcCIsIm90aGVyd2lzZSIsInJ1biIsIiRzdGF0ZSIsImRvY3VtZW50IiwiYm9keSIsInNjcm9sbFRvcCIsImRvY3VtZW50RWxlbWVudCIsInRvUGFyYW1zIiwicHJldmVudERlZmF1bHQiLCJnbyIsIiRxIiwiJGh0dHAiLCJsb2dpblN1Y2Nlc3MiLCJyZXNwb25zZSIsImNvbnNvbGUiLCJsb2ciLCJjcmVhdGUiLCJ1c2VyIiwicmVzb2x2ZSIsImxvZ2luRmFpbHVyZSIsImNhbGxiYWNrIiwicmVqZWN0IiwiYXV0aFNlcnZpY2UiLCJiYXNlVXJsIiwibG9naW5XaXRoUGFzc3dvcmQiLCJlbWFpbCIsInBhc3N3b3JkIiwicG9zdCIsInRoZW4iLCJhZG1pbiIsImNoZWNraW4iLCJncm91cHMiLCJsZW5ndGgiLCJhbGwiLCJFcnJvciIsImxvZ2luV2l0aFRva2VuIiwid2FybiIsInN0YXR1cyIsImRlc3Ryb3kiLCJHcm91cFNlcnZpY2UiLCJnZXRHcm91cHMiLCJnZXQiLCJjcmVhdGVHcm91cCIsImdyb3VwTmFtZSIsImdldFZvbHVudGVlcnMiLCJncm91cElkIiwiYWRkVm9sdW50ZWVyVG9Hcm91cCIsInZvbHVudGVlcklkIiwicHV0IiwicmVtb3ZlVm9sdW50ZWVyRnJvbUdyb3VwIiwiZGVsZXRlIiwiYWRkVXNlcnNUb0dyb3VwIiwidXNlcklkcyIsInVzZXJzIiwicmVtb3ZlVXNlcnNGcm9tR3JvdXAiLCJzZXJ2aWNlIiwiJHdpbmRvdyIsInRoaXMiLCJsb2NhbFN0b3JhZ2UiLCJqd3QiLCJ1c2VySWQiLCJfaWQiLCJjdXJyZW50VXNlciIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRVc2VySWQiLCJnZXRVc2VyIiwicGFyc2UiLCJiYXNlIiwiVXNlclNlcnZpY2UiLCJnZXRVc2VycyIsIm9wdGlvbnMiLCJtZSIsImdyb3VwIiwiQXJyYXkiLCJpc0FycmF5IiwidW5kZWZpbmVkIiwicGFnZSIsInNpemUiLCIkIiwicGFyYW0iLCJ0ZXh0IiwiYXR0ZW5kZWUiLCJhdHRlbmRlZUlkIiwiZmluZCIsImNoZWNrb3V0IiwiJHNjb3BlIiwic2V0U2VhcmNoVXNlcnMiLCJzZWFyY2hSZXN1bHRzIiwic2VsZWN0ZWRHcm91cCIsInNlYXJjaFVzZXJzIiwiZmlsdGVyIiwiZmluZEluZGV4IiwiZ3JvdXBVc2VyIiwiZ2V0UXVlcnkiLCJ1c2VyUXVlcnkiLCJzZWxlY3RHcm91cCIsInNlbGVjdGVkTmV3Vm9sdW50ZWVyIiwidm9sdW50ZWVycyIsInNldFNlbGVjdGVkTmV3Vm9sdW50ZWVyIiwiJGFwcGx5IiwiYWRkTmV3Vm9sdW50ZWVyIiwic3BsaWNlIiwiZWxlbSIsInNlYXJjaCIsImFwaVNldHRpbmdzIiwicmVzcG9uc2VBc3luYyIsInNldHRpbmdzIiwidXJsRGF0YSIsInF1ZXJ5Iiwic2VydmVyUmVzcG9uc2UiLCJyZXN1bHRzIiwidm9sdW50ZWVyIiwibWFwIiwicHJvZmlsZSIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsIm1pbkNoYXJhY3RlcnMiLCJvblNlbGVjdCIsInNlbGVjdGlvbiIsImN1cnJlbnRRdWVyeSIsInNlbGVjdGVkVXNlcnMiLCJhY3RpdmUiLCJhZGRBbGxVc2Vyc1RvR3JvdXAiLCJyZXNldFVzZXJMaXN0IiwiYnVzeSIsIm5leHRQYWdlIiwidG90YWxQYWdlcyIsInRvdGFsVXNlcnMiLCJnZXROZXh0UGFnZSIsImxvYWRGcm9tUmVzcG9uc2UiLCJiaW5kIiwiY29uY2F0IiwiJHNlYXJjaCIsInN0aWNreSIsImNoZWNrZWRJbiIsImNvbnRleHQiLCJzZWxlY3RlZFVzZXIiLCIkdXNlckRldGFpbHMiLCJzZXRTZWxlY3RlZFVzZXIiLCJtb2RhbCIsIm9uQXBwcm92ZSIsIm9uRGVueSIsIkF1dGhTZXJ2aWNlIiwib25TdWNjZXNzIiwib25GYWlsdXJlIiwibG9naW4iLCJzdGF0ZXMiLCJhZG1pbk9ubHkiLCJjbGljayIsImNvbnN0YW50Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLFdBQ0EsYUFHQUYsS0FBQUcsUUFDQSxnQkFDQSxTQUFBQyxFQUFBQyxHQUdBRCxFQUFBRSxhQUFBQyxLQUFBLHVCQUlBUCxJQUFBUSxRQUFBLG9CQUNBLFVBQ0EsYUFDQSxTQUFBQyxFQUFBSixHQUNBLE9BQ0FLLFFBQUEsU0FBQVAsR0FDQSxJQUFBQSxFQUFBUSxJQUFBQyxRQUFBLFNBQUEsSUFBQVQsRUFBQVEsSUFBQUMsUUFBQSxXQUNBVCxFQUFBUSxJQUFBTixFQUFBUSxTQUFBVixFQUFBUSxJQUNBUixFQUFBVyxRQUFBLCtCQUFBVCxFQUFBUSxTQUVBLElBQUFFLEdBQUFOLEVBQUFPLFVBSUEsT0FIQUQsS0FDQVosRUFBQVcsUUFBQSxrQkFBQUMsR0FFQVosT0FNQUgsSUFBQWlCLFVBQUEsU0FBQSxhQUFBLFdBQ0EsU0FBQUMsRUFBQUMsR0FDQSxPQUNBQyxLQUFBLFdBRUEsR0FBQUMsR0FBQSxTQUFBQyxFQUFBQyxHQUVBSixFQUFBLFdBQ0FELEVBQUFNLE1BQUFELEVBQUFFLE1BQUFGLEVBQUFFLEtBQUFDLFVBQ0FILEVBQUFFLEtBQUFDLFVBQUEsa0JBSUFSLEdBQUFTLElBQUEsc0JBQUFOLFFDOUNBcEIsUUFBQUMsT0FBQSxXQUNBQyxRQUNBLGlCQUNBLHFCQUNBLFNBQ0F5QixFQUNBQyxHQUNBRCxFQUNBRSxNQUFBLFNBQ0FuQixJQUFBLFNBQ0FvQixZQUFBLHlCQUNBQyxXQUFBLGtCQUNBUCxNQUNBUSxjQUFBLEVBQ0FQLFVBQUEsV0FHQUksTUFBQSxPQUNBSSxVQUFBLEVBQ0FDLE9BQ0FDLEtBQ0FMLFlBQUEsbUJBRUFNLGVBQ0FOLFlBQUEsNkJBQ0FDLFdBQUEsc0JBR0FQLE1BQ0FRLGNBQUEsRUFDQVAsVUFBQSxhQUdBSSxNQUFBLGVBQ0FuQixJQUFBLFdBQ0FvQixZQUFBLDZCQUNBQyxXQUFBLHNCQUVBRixNQUFBLGNBQ0FuQixJQUFBLFVBQ0FvQixZQUFBLDJCQUNBQyxXQUFBLHFCQUdBSCxFQUFBUyxVQUFBLGVBR0FDLEtBQ0EsYUFDQSxTQUNBLFVBQ0EsU0FDQXJCLEVBQ0FzQixFQUNBL0IsR0FFQVMsRUFBQVMsSUFBQSxzQkFBQSxXQUNBYyxTQUFBQyxLQUFBQyxVQUFBRixTQUFBRyxnQkFBQUQsVUFBQSxJQUdBekIsRUFBQVMsSUFBQSxvQkFBQSxTQUFBTCxFQUFBQyxFQUFBc0IsR0FDQSxHQUFBWixHQUFBVixFQUFBRSxLQUFBUSxZQUVBQSxLQUFBeEIsRUFBQU8sYUFDQU0sRUFBQXdCLGlCQUNBTixFQUFBTyxHQUFBLFlBSUF0QyxFQUFBTyxZQUNBd0IsRUFBQU8sR0FBQSxZQ3RFQTlDLFFBQUFDLE9BQUEsV0FDQU0sUUFBQSxlQUNBLEtBQ0EsUUFDQSxhQUNBLFNBQ0EsVUFDQSxTQUFBd0MsRUFBQUMsRUFBQS9CLEVBQUFzQixFQUFBL0IsR0FJQSxRQUFBeUMsR0FBQUMsR0FDQSxHQUFBMUIsR0FBQTBCLEVBQUExQixJQUdBLE9BRkEyQixTQUFBQyxJQUFBLGVBQUE1QixHQUNBaEIsRUFBQTZDLE9BQUE3QixFQUFBVixNQUFBVSxFQUFBOEIsTUFDQVAsRUFBQSxTQUFBUSxHQUNBQSxFQUFBL0IsRUFBQThCLFFBSUEsUUFBQUUsR0FBQWhDLEVBQUFpQyxHQUdBLE1BRkFOLFNBQUFDLElBQUEsWUFBQTVCLEdBQ0FlLEVBQUFPLEdBQUEsU0FDQUMsRUFBQSxTQUFBUSxFQUFBRyxHQUNBQSxFQUFBbEMsS0FoQkEsR0FBQW1DLE1BQ0FDLEVBQUEsT0F5REEsT0FyQ0FELEdBQUFFLGtCQUFBLFNBQUFDLEVBQUFDLEdBQ0EsTUFBQWYsR0FDQWdCLEtBQUFKLEVBQUEsU0FDQUUsTUFBQUEsRUFDQUMsU0FBQUEsSUFFQUUsS0FBQSxTQUFBZixHQUVBLEdBREFJLEtBQUFKLEVBQUExQixLQUFBOEIsT0FFQUEsS0FBQVksT0FDQVosS0FBQWEsVUFDQWIsS0FBQWEsUUFBQUMsT0FBQUMsT0FBQSxHQUNBZixLQUFBYSxRQUFBRyxNQUlBLEtBQUEsSUFBQUMsT0FBQSxvQ0FFQSxPQUFBckIsS0FFQWUsS0FBQWhCLEVBQUFPLElBSUFHLEVBQUFhLGVBQUEsU0FBQTFELEdBRUEsTUFEQXFDLFNBQUFzQixLQUFBLHdDQUNBekIsRUFDQWdCLEtBQUFKLEVBQUEsU0FDQTlDLE1BQUFBLElBRUFtRCxLQUFBaEIsRUFBQSxXQUNBLE1BQUF5QixRQUNBbEUsRUFBQW1FLFVBQUFWLEtBQUFULE1BS0FHLEtDbEVBM0QsUUFBQUMsT0FBQSxXQUNBTSxRQUFBLGdCQUNBLEtBQ0EsUUFDQSxVQUNBLFNBQUF3QyxFQUFBQyxFQUFBeEMsR0FDQSxHQUFBNEQsR0FBQSxjQUVBUSxJQThCQSxPQTVCQUEsR0FBQUMsVUFBQSxXQUNBLE1BQUE3QixHQUFBOEIsSUFBQVYsSUFHQVEsRUFBQUcsWUFBQSxTQUFBQyxHQUNBLE1BQUFoQyxHQUFBZ0IsS0FBQUksR0FBQVksVUFBQUEsS0FHQUosRUFBQUssY0FBQSxTQUFBQyxHQUNBLE1BQUFsQyxHQUFBOEIsSUFBQVYsRUFBQWMsRUFBQSxnQkFHQU4sRUFBQU8sb0JBQUEsU0FBQUMsRUFBQUYsR0FDQSxNQUFBbEMsR0FBQXFDLElBQUFqQixFQUFBYyxFQUFBLGVBQUFFLElBR0FSLEVBQUFVLHlCQUFBLFNBQUFGLEVBQUFGLEdBQ0EsTUFBQWxDLEdBQUF1QyxPQUFBbkIsRUFBQWMsRUFBQSxlQUFBRSxJQUdBUixFQUFBWSxnQkFBQSxTQUFBTixFQUFBTyxHQUNBLE1BQUF6QyxHQUFBcUMsSUFBQWpCLEVBQUFjLEVBQUEsVUFBQVEsTUFBQUQsS0FHQWIsRUFBQWUscUJBQUEsU0FBQVQsRUFBQU8sR0FDQSxNQUFBekMsR0FBQXVDLE9BQUFuQixFQUFBYyxFQUFBLFVBQUFRLE1BQUFELEtBR0FiLEtDdENBNUUsUUFBQUMsT0FBQSxXQUNBMkYsUUFBQSxXQUNBLGFBQ0EsVUFDQSxLQUNBLFNBQUEzRSxFQUFBNEUsRUFBQTlDLEdBQ0ErQyxLQUFBekMsT0FBQSxTQUFBdkMsRUFBQXdDLEdBQ0F1QyxFQUFBRSxhQUFBQyxJQUFBbEYsRUFDQStFLEVBQUFFLGFBQUFFLE9BQUEzQyxFQUFBNEMsSUFDQUwsRUFBQUUsYUFBQUksWUFBQUMsS0FBQUMsVUFBQS9DLEdBQ0FyQyxFQUFBa0YsWUFBQTdDLEdBR0F3QyxLQUFBbkIsUUFBQSxXQUtBLGFBSkFrQixHQUFBRSxhQUFBQyxVQUNBSCxHQUFBRSxhQUFBRSxhQUNBSixHQUFBRSxhQUFBSSxZQUNBbEYsRUFBQWtGLFlBQUEsS0FDQXBELEVBQUEsU0FBQVEsRUFBQUcsR0FDQUgsT0FJQXVDLEtBQUEvRSxTQUFBLFdBQ0EsTUFBQThFLEdBQUFFLGFBQUFDLEtBR0FGLEtBQUFRLFVBQUEsV0FDQSxNQUFBVCxHQUFBRSxhQUFBRSxRQUdBSCxLQUFBUyxRQUFBLFdBQ0EsTUFBQUgsTUFBQUksTUFBQVgsRUFBQUUsYUFBQUksaUJDaENBbkcsUUFBQUMsT0FBQSxXQUNBTSxRQUFBLGVBQ0EsS0FDQSxRQUNBLFVBQ0EsU0FBQXdDLEVBQUFDLEVBQUF4QyxHQUNBLEdBQUFrRixHQUFBLFlBQ0FlLEVBQUFmLEVBQUEsSUFDQXRCLEVBQUEsY0FFQXNDLElBNkVBLE9BM0VBQSxHQUFBQyxTQUFBLFNBQUFDLEdBRUEsR0FBQUMsR0FBQXJHLEVBQUErRixTQUdBTSxHQUFBM0MsT0FBQTJDLEVBQUExQyxTQUFBMEMsRUFBQTFDLFFBQUFHLEtBQ0FzQyxFQUFBRSxRQUNBRixFQUFBRSxNQUFBRCxFQUFBMUMsUUFBQUMsUUFJQXdDLEVBQUFFLFFBQUFDLE1BQUFDLFFBQUFKLEVBQUFFLFNBQ0FGLEVBQUFFLE9BQUFGLEVBQUFFLFFBR0FHLFNBQUFMLEVBQUFNLE1BQUFELFNBQUFMLEVBQUFPLE9BQ0FQLEVBQUFNLEtBQUFOLEVBQUFNLE1BQUEsRUFDQU4sRUFBQU8sS0FBQVAsRUFBQU8sTUFBQSxHQUlBLElBQUF6RyxHQUFBa0csRUFBQWxCLEVBQUEsSUFBQTBCLEVBQUFDLE9BRUFDLEtBQUFWLEVBQUFVLEtBQ0FKLEtBQUFOLEVBQUFNLEtBQ0FDLEtBQUFQLEVBQUFPLEtBQ0FMLE1BQUFGLEVBQUFFLFFBQ0FMLENBRUEsT0FBQXpELEdBQUE4QixJQUFBcEUsSUFZQWdHLEVBQUF2QyxRQUFBLFNBQUFvRCxHQUNBLEdBQUFDLEdBQUFELEVBQUFyQixJQUNBeEYsRUFBQStGLEVBQUFlLEVBQUEsV0FFQVgsRUFBQXJHLEVBQUErRixTQUdBLE1BQUFNLEVBQUEzQyxPQUFBMkMsRUFBQTFDLFNBQUEwQyxFQUFBMUMsUUFBQUcsS0FBQSxDQUNBLEdBQUFZLEdBQUFxQyxFQUFBbkQsT0FBQXFELEtBQUEsU0FBQXZDLEdBQ0EsTUFBQTJCLEdBQUExQyxRQUFBQyxPQUFBekQsUUFBQXVFLE1BQUEsR0FFQXhFLEdBQUEwRCxFQUFBYyxFQUFBLFVBQUFzQyxFQUFBLFdBR0EsTUFBQXhFLEdBQUFnQixLQUFBdEQsSUFHQWdHLEVBQUFnQixTQUFBLFNBQUFILEdBQ0EsR0FBQUMsR0FBQUQsRUFBQXJCLElBQ0F4RixFQUFBK0YsRUFBQWUsRUFBQSxZQUVBWCxFQUFBckcsRUFBQStGLFNBR0EsTUFBQU0sRUFBQTNDLE9BQUEyQyxFQUFBMUMsU0FBQTBDLEVBQUExQyxRQUFBRyxLQUFBLENBQ0EsR0FBQVksR0FBQXFDLEVBQUFuRCxPQUFBcUQsS0FBQSxTQUFBdkMsR0FDQSxNQUFBMkIsR0FBQTFDLFFBQUFDLE9BQUF6RCxRQUFBdUUsTUFBQSxHQUVBeEUsR0FBQTBELEVBQUFjLEVBQUEsVUFBQXNDLEVBQUEsWUFHQSxNQUFBeEUsR0FBQWdCLEtBQUF0RCxJQUdBZ0csS0N2RkExRyxRQUFBQyxPQUFBLFdBQ0E4QixXQUFBLG9CQUNBLFNBQ0EsY0FDQSxlQUNBLFNBQUE0RixFQUFBakIsRUFBQTlCLEdBZ0hBLFFBQUFnRCxHQUFBQyxHQUNBQSxFQUFBQSxHQUFBRixFQUFBRyxjQUFBQyxZQUNBSixFQUFBRyxjQUFBQyxZQUFBRixFQUVBRyxPQUFBLFNBQUExRSxHQUNBLE1BQUFxRSxHQUFBRyxjQUFBcEMsTUFBQXVDLFVBQUEsU0FBQUMsR0FDQSxNQUFBQSxHQUFBaEMsTUFBQTVDLEVBQUE0QyxTQUNBLElBSUEsUUFBQWlDLEtBQ0EsT0FBQVIsRUFBQVMsV0FBQVQsRUFBQVMsVUFBQS9ELE9BQUEsRUFDQSxLQUVBc0QsRUFBQVMsVUE5SEFULEVBQUF2RCxVQUVBdUQsRUFBQTlDLFVBQUEsV0FDQUQsRUFBQUMsWUFBQVosS0FBQSxTQUFBZixHQUNBeUUsRUFBQXZELE9BQUFsQixFQUFBMUIsUUFHQW1HLEVBQUE5QyxZQUVBOEMsRUFBQTVDLFlBQUEsU0FBQUMsR0FDQUEsR0FFQUosRUFBQUcsWUFBQUMsR0FBQWYsS0FBQSxTQUFBZixHQUNBeUUsRUFBQXZELE9BQUE5RCxLQUFBNEMsRUFBQTFCLFNBSUFtRyxFQUFBRyxjQUFBLEtBQ0FILEVBQUFVLFlBQUEsU0FBQXZCLEdBQ0FhLEVBQUFXLHFCQUFBLEtBQ0FYLEVBQUFHLGNBQUFoQixFQUNBbEMsRUFBQUssY0FBQTZCLEVBQUFaLEtBQUFqQyxLQUFBLFNBQUFmLEdBQ0F5RSxFQUFBRyxjQUFBUyxXQUFBckYsRUFBQTFCLEtBQUErRyxhQUVBN0IsRUFBQUMsVUFBQUcsTUFBQUEsRUFBQVosTUFBQWpDLEtBQUEsU0FBQWYsR0FDQXlFLEVBQUFHLGNBQUFwQyxNQUFBeEMsRUFBQTFCLEtBQUFrRSxTQUlBaUMsRUFBQVcscUJBQUEsS0FDQVgsRUFBQWEsd0JBQUEsU0FBQWxGLEdBQ0FxRSxFQUFBVyxxQkFBQWhGLEVBR0FBLEdBQ0FxRSxFQUFBYyxVQUlBZCxFQUFBZSxnQkFBQSxTQUFBcEYsRUFBQXdELEdBQ0FsQyxFQUFBTyxvQkFBQTdCLEVBQUE0QyxJQUFBWSxFQUFBWixLQUNBakMsS0FBQSxTQUFBZixHQUNBeUUsRUFBQUcsY0FBQVMsV0FBQWpJLEtBQUE0QyxFQUFBMUIsTUFDQW1HLEVBQUFhLHdCQUFBLFNBSUFiLEVBQUFyQyx5QkFBQSxTQUFBaEMsRUFBQXdELEdBQ0FsQyxFQUFBVSx5QkFBQWhDLEVBQUE0QyxJQUFBWSxFQUFBWixLQUNBakMsS0FBQSxTQUFBZixHQUNBeUUsRUFBQUcsY0FBQVMsV0FBQUksT0FDQWhCLEVBQUFHLGNBQUFTLFdBQUFOLFVBQUEsU0FBQVcsR0FDQSxNQUFBQSxHQUFBMUMsTUFBQWhELEVBQUExQixLQUFBMEUsTUFDQSxNQUtBa0IsRUFBQSxrQkFBQXlCLFFBQ0FDLGFBQ0FDLGNBQUEsU0FBQUMsRUFBQXZGLEdBQ0F1RixFQUFBQyxRQUFBQyxLQUNBeEMsR0FBQUMsVUFBQVcsS0FBQTBCLEVBQUFDLFFBQUFDLFFBQ0FqRixLQUFBLFNBQUFrRixHQUNBQyxRQUFBRCxFQUFBM0gsS0FBQWtFLE1BRUFzQyxPQUFBLFNBQUExRSxHQUNBLE1BQUFxRSxHQUFBRyxjQUFBUyxXQUFBTixVQUFBLFNBQUFvQixHQUNBLE1BQUFBLEdBQUFuRCxNQUFBNUMsRUFBQTRDLFNBQ0EsSUFHQW9ELElBQUEsU0FBQWhHLEdBQ0EsT0FDQS9CLE1BQUErQixFQUFBaUcsUUFBQUMsTUFBQWxHLEVBQUFRLE1BQ0EyRixZQUFBbkcsRUFBQWlHLFFBQUFDLEtBQUFsRyxFQUFBUSxNQUFBbUQsT0FDQTNELEtBQUFBLEtBR0FHLEdBQ0EyRixRQUFBQSxjQUtBTSxjQUFBLEVBQ0FDLFNBQUEsU0FBQUMsR0FDQWpDLEVBQUFhLHdCQUFBb0IsRUFBQXRHLFFBTUEsSUFBQXVHLEdBQUEsSUFDQWxDLEdBQUFJLFlBQUEsV0FDQSxHQUFBbUIsR0FBQWYsR0FDQWhGLFNBQUFDLElBQUEsU0FBQThGLEdBRUFBLEdBQUFBLElBQUFXLElBQ0FBLEVBQUFYLEVBRUF4QyxFQUFBQyxVQUNBVyxLQUFBNEIsSUFDQWpGLEtBQUEsU0FBQWYsR0FDQWdHLElBQUFXLElBQ0ExRyxRQUFBQyxJQUFBRixFQUFBMUIsTUFFQW9HLEVBQUExRSxFQUFBMUIsS0FBQWtFLFlBc0JBaUMsRUFBQW5DLGdCQUFBLFdBQ0EsR0FBQXNFLEdBQUFuQyxFQUFBRyxjQUFBQyxZQUFBQyxPQUFBLFNBQUExRSxHQUNBLE1BQUFBLEdBQUF5RyxTQUNBVCxJQUFBLFNBQUFoRyxHQUNBLE1BQUFBLEdBQUE0QyxLQUdBdEIsR0FBQVksZ0JBQUFtQyxFQUFBRyxjQUFBNUIsSUFBQTRELEdBQ0E3RixLQUFBLFNBQUFmLEdBQ0F5RSxFQUFBRyxjQUFBcEMsTUFBQXhDLEVBQUExQixLQUFBa0UsTUFDQWtDLE9BSUFELEVBQUFxQyxtQkFBQSxXQUNBLEdBQUFGLEdBQUFuQyxFQUFBRyxjQUFBQyxZQUFBdUIsSUFBQSxTQUFBaEcsR0FDQSxNQUFBQSxHQUFBNEMsS0FHQXRCLEdBQUFZLGdCQUFBbUMsRUFBQUcsY0FBQTVCLElBQUE0RCxHQUNBN0YsS0FBQSxTQUFBZixHQUNBeUUsRUFBQUcsY0FBQXBDLE1BQUF4QyxFQUFBMUIsS0FBQWtFLE1BQ0FrQyxVQzdKQTVILFFBQUFDLE9BQUEsV0FDQThCLFdBQUEscUJBQ0EsU0FDQSxjQUNBLFNBQUE0RixFQUFBakIsR0FTQSxRQUFBeUIsS0FDQSxNQUFBUixHQUFBdUIsTUFFQXZCLEVBQUF1QixNQUFBN0UsT0FBQSxHQUFBc0QsRUFBQXVCLE1BQUE3RSxPQUFBLEVBQ0F3RixFQUVBbEMsRUFBQXVCLE1BSkEsS0EyQkEsUUFBQWUsS0FDQXRDLEVBQUFqQyxPQUNBQSxTQUNBd0UsTUFBQSxFQUNBQyxTQUFBLEVBQ0FDLFdBQUEsRUFDQUMsV0FBQSxFQUNBQyxZQUFBLFdBQ0F4RSxLQUFBb0UsT0FFQXBFLEtBQUFvRSxNQUFBLEVBRUF4RCxFQUFBQyxVQUNBVyxLQUFBYSxJQUNBakIsS0FBQXBCLEtBQUFxRSxXQUNBbEcsS0FBQXNHLEVBQUFDLEtBQUExRSxPQUVBQSxLQUFBcUUsU0FBQXJFLEtBQUFxRSxTQUFBLEtBNkNBLFFBQUFJLEdBQUFySCxHQUNBQyxRQUFBQyxJQUFBRixFQUFBMUIsTUFFQXNFLEtBQUFKLE1BQUFJLEtBQUFKLE1BQUErRSxPQUFBdkgsRUFBQTFCLEtBQUFrRSxPQUVBSSxLQUFBdUUsV0FBQW5ILEVBQUExQixLQUFBNkksV0FDQXZFLEtBQUFzRSxXQUFBbEgsRUFBQTFCLEtBQUE0SSxXQUNBdEUsS0FBQXFFLFNBQUFyRSxLQUFBcUUsU0FBQSxFQUNBckUsS0FBQW9FLE1BQUEsRUFFQVEsRUFBQUMsT0FBQSxXQUdBLFFBQUF4RyxHQUFBYixHQUNBLE1BQUFvRCxHQUFBdkMsUUFBQWIsR0FDQVcsS0FBQSxTQUFBekMsR0FHQSxNQUZBMkIsU0FBQUMsSUFBQSxhQUFBNUIsR0FDQThCLEVBQUFvQixPQUFBa0csV0FBQSxFQUNBdEgsSUFJQSxRQUFBb0UsR0FBQXBFLEdBQ0EsTUFBQW9ELEdBQUFnQixTQUFBcEUsR0FDQVcsS0FBQSxTQUFBekMsR0FHQSxNQUZBMkIsU0FBQUMsSUFBQSxjQUFBNUIsR0FDQThCLEVBQUFvQixPQUFBa0csV0FBQSxFQUNBdEgsSUE3SEEsR0FBQW9ILEdBQUF0RCxFQUFBLHdCQUNBc0QsR0FBQUMsUUFDQUUsUUFBQSxxQkFHQSxJQUFBaEIsR0FBQSxJQVdBbEMsR0FBQUksWUFBQSxXQUNBLEdBQUFtQixHQUFBZixHQUNBaEYsU0FBQUMsSUFBQSxTQUFBOEYsR0FFQUEsSUFBQVcsSUFDQUEsRUFBQVgsRUFHQXhDLEVBQUFDLFVBQ0FPLEtBQUEsRUFDQUksS0FBQTRCLElBQ0FqRixLQUFBLFNBQUFmLEdBRUFnRyxJQUFBVyxJQUNBSSxJQUNBTSxFQUFBQyxLQUFBN0MsRUFBQWpDLE9BQUF4QyxRQUlBeUUsRUFBQWpDLFNBc0JBdUUsSUFFQXRDLEVBQUFtRCxhQUFBLElBQ0EsSUFBQUMsR0FBQTNELEVBQUEsZUFDQUEsR0FBQSxvQkFFQU8sR0FBQXFELGdCQUFBLFNBQUExSCxHQUNBcUUsRUFBQW1ELGFBQUF4SCxFQUNBQSxFQUNBeUgsRUFBQUUsT0FFQUMsVUFBQSxXQUNBL0csRUFBQWIsR0FBQVcsS0FBQSxTQUFBWCxPQWdCQTZILE9BQUEsV0FDQXpELEVBQUFwRSxHQUFBVyxLQUFBLFNBQUFYLFNBSUEySCxNQUFBLFFBRUFGLEVBQUFFLE1BQUEsU0FJQXRELEVBQUFqQyxNQUFBNEUsaUJDdEdBdEssUUFBQUMsT0FBQSxXQUNBOEIsV0FBQSxtQkFDQSxTQUNBLFNBQ0EsY0FDQSxTQUFBNEYsRUFBQXBGLEVBQUE2SSxHQUVBLFFBQUFDLEdBQUE3SixHQUNBMkIsUUFBQUMsSUFBQSxVQUFBNUIsR0FDQWUsRUFBQU8sR0FBQSxlQUdBLFFBQUF3SSxHQUFBOUosR0FDQTJCLFFBQUFDLElBQUEsVUFBQTVCLEdBR0FtRyxFQUFBNEQsTUFBQSxXQUNBSCxFQUFBdkgsa0JBQ0E4RCxFQUFBN0QsTUFBQTZELEVBQUE1RCxVQUNBRSxLQUFBb0gsRUFBQUMsT0NuQkF0TCxRQUFBQyxPQUFBLFdBQ0E4QixXQUFBLHFCQUNBLFNBQ0EsU0FDQSxhQUNBLFVBQ0EsU0FBQTRGLEVBQUFwRixFQUFBdEIsRUFBQVQsR0FDQSxHQUFBOEMsR0FBQTlDLEVBQUErRixTQUVBb0IsR0FBQTZELFNBRUFoQyxLQUFBLGNBQ0FqSSxNQUFBLFlBR0FpSSxLQUFBLGFBQ0FqSSxNQUFBLFNBQ0FrSyxXQUFBLElBRUF6RCxPQUFBLFNBQUFuRyxHQUNBLFFBQUFBLEVBQUE0SixZQUFBbkksRUFBQVksU0FHQWtELEVBQUEsV0FBQXNFLE1BQUEsV0FDQWxMLEVBQUFtRSxVQUFBVixLQUFBLFdBQ0ExQixFQUFBTyxHQUFBLGdCQ3RCQTlDLFFBQUFDLE9BQUEsV0FBQTBMLFNBQUEsY0FFQS9LLFNBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicsIFtcbiAgJ3VpLnJvdXRlcicsXG5dKTtcblxuYXBwLmNvbmZpZyhbXG4gICckaHR0cFByb3ZpZGVyJyxcbiAgZnVuY3Rpb24oJGh0dHBQcm92aWRlciwgU0VSVkVSX1VSTCkge1xuXG4gICAgLy8gYWRkIHJvb3QgdXJsIHRvIGFsbCBhcGkgYW5kIGF1dGggcmVxdWVzdHNcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBcGlBdXRoZW50aWNhdG9yJyk7XG4gIH1cbl0pO1xuXG5hcHAuZmFjdG9yeSgnQXBpQXV0aGVudGljYXRvcicsIFtcbiAgJ1Nlc3Npb24nLFxuICAnU0VSVkVSX1VSTCcsXG4gIGZ1bmN0aW9uKFNlc3Npb24sIFNFUlZFUl9VUkwpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVxdWVzdDogZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgICAgIGlmIChjb25maWcudXJsLmluZGV4T2YoJ2FwaS8nKSA9PT0gMCB8fCBjb25maWcudXJsLmluZGV4T2YoJ2F1dGgvJykgPT09IDApIHtcbiAgICAgICAgICBjb25maWcudXJsID0gU0VSVkVSX1VSTC5CQVNFX1VSTCArIGNvbmZpZy51cmw7XG4gICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbiddID0gU0VSVkVSX1VSTC5CQVNFX1VSTDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdG9rZW4gPSBTZXNzaW9uLmdldFRva2VuKCk7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWyd4LWFjY2Vzcy10b2tlbiddID0gdG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgIH1cbiAgICB9O1xuICB9XG5dKTtcblxuYXBwLmRpcmVjdGl2ZSgndGl0bGUnLCBbJyRyb290U2NvcGUnLCAnJHRpbWVvdXQnLFxuICBmdW5jdGlvbigkcm9vdFNjb3BlLCAkdGltZW91dCkge1xuICAgIHJldHVybiB7XG4gICAgICBsaW5rOiBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgbGlzdGVuZXIgPSBmdW5jdGlvbihldmVudCwgdG9TdGF0ZSkge1xuXG4gICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnRpdGxlID0gKHRvU3RhdGUuZGF0YSAmJiB0b1N0YXRlLmRhdGEucGFnZVRpdGxlKSA/XG4gICAgICAgICAgICAgIHRvU3RhdGUuZGF0YS5wYWdlVGl0bGUgOiAnRGVmYXVsdCB0aXRsZSc7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBsaXN0ZW5lcik7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb25maWcoW1xuICAgICckc3RhdGVQcm92aWRlcicsXG4gICAgJyR1cmxSb3V0ZXJQcm92aWRlcicsXG4gICAgZnVuY3Rpb24oXG4gICAgICAkc3RhdGVQcm92aWRlcixcbiAgICAgICR1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XG4gICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvbG9naW4vbG9naW4uaHRtbFwiLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHJlcXVpcmVMb2dpbjogZmFsc2UsXG4gICAgICAgICAgICAgIHBhZ2VUaXRsZTogJ0xvZ2luJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc3RhdGUoJ2FwcCcsIHtcbiAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgJ0AnOiB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvYmFzZS5odG1sXCIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICd0b29sYmFyQGFwcCc6IHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy90b29sYmFyL3Rvb2xiYXIuaHRtbFwiLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUb29sYmFyQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICByZXF1aXJlTG9naW46IHRydWUsXG4gICAgICAgICAgICAgIHBhZ2VUaXRsZTogJ0NoZWNraW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zdGF0ZSgnYXBwLmNoZWNraW4nLCB7XG4gICAgICAgICAgICB1cmw6ICcvY2hlY2tpbicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NoZWNraW4vY2hlY2tpbi5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDaGVja2luQ29udHJvbGxlcicsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc3RhdGUoJ2FwcC5ncm91cHMnLCB7XG4gICAgICAgICAgICB1cmw6ICcvZ3JvdXBzJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvZ3JvdXBzL2dyb3Vwcy5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdHcm91cHNDb250cm9sbGVyJyxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvY2hlY2tpbicpO1xuICAgIH1cbiAgXSlcbiAgLnJ1bihbXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbihcbiAgICAgICRyb290U2NvcGUsXG4gICAgICAkc3RhdGUsXG4gICAgICBTZXNzaW9uKXtcblxuICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcbiAgICAgIH0pO1xuXG4gICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zKSB7XG4gICAgICAgIHZhciByZXF1aXJlTG9naW4gPSB0b1N0YXRlLmRhdGEucmVxdWlyZUxvZ2luO1xuXG4gICAgICAgIGlmIChyZXF1aXJlTG9naW4gJiYgIVNlc3Npb24uZ2V0VG9rZW4oKSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKCFTZXNzaW9uLmdldFRva2VuKCkpIHtcbiAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgfVxuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5mYWN0b3J5KCdBdXRoU2VydmljZScsIFtcbiAgICAnJHEnLFxuICAgICckaHR0cCcsXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkcSwgJGh0dHAsICRyb290U2NvcGUsICRzdGF0ZSwgU2Vzc2lvbikge1xuICAgICAgdmFyIGF1dGhTZXJ2aWNlID0ge307XG4gICAgICB2YXIgYmFzZVVybCA9ICdhdXRoLyc7XG5cbiAgICAgIGZ1bmN0aW9uIGxvZ2luU3VjY2VzcyhyZXNwb25zZSkge1xuICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIGNvbnNvbGUubG9nKCdhdXRoIHN1Y2Nlc3MnLCBkYXRhKTtcbiAgICAgICAgU2Vzc2lvbi5jcmVhdGUoZGF0YS50b2tlbiwgZGF0YS51c2VyKTtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgICByZXNvbHZlKGRhdGEudXNlcik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBsb2dpbkZhaWx1cmUoZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2F1dGggZmFpbCcsIGRhdGEpO1xuICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICByZWplY3QoZGF0YSk7XG4gICAgICAgIH0pO1xuXG4gICAgICB9XG5cbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luV2l0aFBhc3N3b3JkID0gZnVuY3Rpb24oZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgIC5wb3N0KGJhc2VVcmwgKyAnbG9naW4nLCB7XG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgdXNlciA9IHJlc3BvbnNlLmRhdGEudXNlcjtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICEodXNlci5hZG1pbiB8fFxuICAgICAgICAgICAgICAodXNlci5jaGVja2luICYmXG4gICAgICAgICAgICAgICAgKHVzZXIuY2hlY2tpbi5ncm91cHMubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgICAgICAgdXNlci5jaGVja2luLmFsbClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgaXMgbm90IGFuIGFkbWluIG9yIHZvbHVudGVlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4obG9naW5TdWNjZXNzLCBsb2dpbkZhaWx1cmUpO1xuICAgICAgfTtcblxuICAgICAgLy8gVE9ETyB1bnN1cmUgaWYgdGhpcyB3b3JrcyFcbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luV2l0aFRva2VuID0gZnVuY3Rpb24odG9rZW4pIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiTm90IGFjdHVhbGx5IHN1cmUgaWYgdGhpcyB3b3JrcyB5ZXQhXCIpO1xuICAgICAgICByZXR1cm4gJGh0dHBcbiAgICAgICAgICAucG9zdChiYXNlVXJsICsgJ2xvZ2luJywge1xuICAgICAgICAgICAgdG9rZW46IHRva2VuXG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbihsb2dpblN1Y2Nlc3MsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgIFNlc3Npb24uZGVzdHJveSgpLnRoZW4obG9naW5GYWlsdXJlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBhdXRoU2VydmljZTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuZmFjdG9yeSgnR3JvdXBTZXJ2aWNlJywgW1xuICAgICckcScsXG4gICAgJyRodHRwJyxcbiAgICAnU2Vzc2lvbicsXG4gICAgZnVuY3Rpb24oJHEsICRodHRwLCBTZXNzaW9uKSB7XG4gICAgICB2YXIgZ3JvdXBzID0gJ2FwaS9ncm91cHMvJztcblxuICAgICAgdmFyIEdyb3VwU2VydmljZSA9IHt9O1xuXG4gICAgICBHcm91cFNlcnZpY2UuZ2V0R3JvdXBzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5nZXQoZ3JvdXBzKTtcbiAgICAgIH07XG5cbiAgICAgIEdyb3VwU2VydmljZS5jcmVhdGVHcm91cCA9IGZ1bmN0aW9uKGdyb3VwTmFtZSkge1xuICAgICAgICByZXR1cm4gJGh0dHAucG9zdChncm91cHMsIHsgZ3JvdXBOYW1lOiBncm91cE5hbWUgfSk7XG4gICAgICB9O1xuXG4gICAgICBHcm91cFNlcnZpY2UuZ2V0Vm9sdW50ZWVycyA9IGZ1bmN0aW9uKGdyb3VwSWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmdldChncm91cHMgKyBncm91cElkICsgJy92b2x1bnRlZXJzJyk7XG4gICAgICB9O1xuXG4gICAgICBHcm91cFNlcnZpY2UuYWRkVm9sdW50ZWVyVG9Hcm91cCA9IGZ1bmN0aW9uKHZvbHVudGVlcklkLCBncm91cElkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wdXQoZ3JvdXBzICsgZ3JvdXBJZCArICcvdm9sdW50ZWVycy8nICsgdm9sdW50ZWVySWQpO1xuICAgICAgfTtcblxuICAgICAgR3JvdXBTZXJ2aWNlLnJlbW92ZVZvbHVudGVlckZyb21Hcm91cCA9IGZ1bmN0aW9uKHZvbHVudGVlcklkLCBncm91cElkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoZ3JvdXBzICsgZ3JvdXBJZCArICcvdm9sdW50ZWVycy8nICsgdm9sdW50ZWVySWQpO1xuICAgICAgfTtcblxuICAgICAgR3JvdXBTZXJ2aWNlLmFkZFVzZXJzVG9Hcm91cCA9IGZ1bmN0aW9uKGdyb3VwSWQsIHVzZXJJZHMpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLnB1dChncm91cHMgKyBncm91cElkICsgJy91c2VycycsIHsgdXNlcnM6IHVzZXJJZHMgfSk7XG4gICAgICB9O1xuXG4gICAgICBHcm91cFNlcnZpY2UucmVtb3ZlVXNlcnNGcm9tR3JvdXAgPSBmdW5jdGlvbihncm91cElkLCB1c2VySWRzKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoZ3JvdXBzICsgZ3JvdXBJZCArICcvdXNlcnMnLCB7IHVzZXJzOiB1c2VySWRzIH0pO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIEdyb3VwU2VydmljZTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuc2VydmljZSgnU2Vzc2lvbicsIFtcbiAgICAnJHJvb3RTY29wZScsXG4gICAgJyR3aW5kb3cnLFxuICAgICckcScsXG4gICAgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHdpbmRvdywgJHEpe1xuICAgICAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbih0b2tlbiwgdXNlcil7XG4gICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dCA9IHRva2VuO1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS51c2VySWQgPSB1c2VyLl9pZDtcbiAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIgPSBKU09OLnN0cmluZ2lmeSh1c2VyKTtcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbigpe1xuICAgICAgICBkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0O1xuICAgICAgICBkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2UudXNlcklkO1xuICAgICAgICBkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXI7XG4gICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0O1xuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRVc2VySWQgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UudXNlcklkO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIpO1xuICAgICAgfTtcbiAgfV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBbXG4gICAgJyRxJyxcbiAgICAnJGh0dHAnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkcSwgJGh0dHAsIFNlc3Npb24pIHtcbiAgICAgIHZhciB1c2VycyA9ICdhcGkvdXNlcnMnO1xuICAgICAgdmFyIGJhc2UgPSB1c2VycyArICcvJztcbiAgICAgIHZhciBncm91cHMgPSAnYXBpL2dyb3Vwcy8nO1xuXG4gICAgICB2YXIgVXNlclNlcnZpY2UgPSB7fTtcblxuICAgICAgVXNlclNlcnZpY2UuZ2V0VXNlcnMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG5cbiAgICAgICAgdmFyIG1lID0gU2Vzc2lvbi5nZXRVc2VyKCk7XG4gICAgICAgIC8vIGlmIG5vdCBhbiBhZG1pbiBhbmQgbm8gZ3JvdXBzIGFyZSBzZWxlY3RlZCwgYXV0b21hdGljYWxseSBzY29wZVxuICAgICAgICAvLyB0byBvbmx5IGdyb3VwcyB0aGF0IGFyZSBwZXJtaXNzaW9uZWRcbiAgICAgICAgaWYgKCEobWUuYWRtaW4gfHwgKG1lLmNoZWNraW4gJiYgbWUuY2hlY2tpbi5hbGwpKSkge1xuICAgICAgICAgIGlmICghb3B0aW9ucy5ncm91cCkge1xuICAgICAgICAgICAgb3B0aW9ucy5ncm91cCA9IG1lLmNoZWNraW4uZ3JvdXBzO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLmdyb3VwICYmICFBcnJheS5pc0FycmF5KG9wdGlvbnMuZ3JvdXApKSB7XG4gICAgICAgICAgb3B0aW9ucy5ncm91cCA9IFtvcHRpb25zLmdyb3VwXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLnBhZ2UgIT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLnNpemUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG9wdGlvbnMucGFnZSA9IG9wdGlvbnMucGFnZSB8fCAwO1xuICAgICAgICAgIG9wdGlvbnMuc2l6ZSA9IG9wdGlvbnMuc2l6ZSB8fCA1MDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRPRE8gW2FkYWldIHllcyB0aGlzIGlzIGtpbmRhIGR1bWIgYW5kIHNob3VsZCBiZSBiZXR0ZXJcbiAgICAgICAgdmFyIHVybCA9IG9wdGlvbnMgPyB1c2VycyArICc/JyArICQucGFyYW0oXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogb3B0aW9ucy50ZXh0LFxuICAgICAgICAgICAgcGFnZTogb3B0aW9ucy5wYWdlLFxuICAgICAgICAgICAgc2l6ZTogb3B0aW9ucy5zaXplLFxuICAgICAgICAgICAgZ3JvdXA6IG9wdGlvbnMuZ3JvdXAsXG4gICAgICAgICAgfSkgOiBiYXNlO1xuXG4gICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKTtcbiAgICAgIH07XG5cbiAgICAgIC8vIFVzZXJTZXJ2aWNlLnVwZGF0ZUNvbmZpcm1hdGlvbiA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgIC8vICAgdmFyIGlkID0gdXNlci5faWQ7XG4gICAgICAvLyAgIHZhciBjb25maXJtYXRpb24gPSB1c2VyLmNvbmZpcm1hdGlvbjtcbiAgICAgIC8vXG4gICAgICAvLyAgIHJldHVybiAkaHR0cC5wb3N0KGJhc2UgKyBpZCArICcvY29uZmlybScsIHtcbiAgICAgIC8vICAgICBjb25maXJtYXRpb246IGNvbmZpcm1hdGlvbixcbiAgICAgIC8vICAgfSk7XG4gICAgICAvLyB9O1xuXG4gICAgICBVc2VyU2VydmljZS5jaGVja2luID0gZnVuY3Rpb24oYXR0ZW5kZWUpIHtcbiAgICAgICAgdmFyIGF0dGVuZGVlSWQgPSBhdHRlbmRlZS5faWQ7XG4gICAgICAgIHZhciB1cmwgPSBiYXNlICsgYXR0ZW5kZWVJZCArICcvY2hlY2tpbic7XG5cbiAgICAgICAgdmFyIG1lID0gU2Vzc2lvbi5nZXRVc2VyKCk7XG4gICAgICAgIC8vIGlmIHRoZSB1c2VyIGlzIG5vdCBvbW5pcG90ZW50LCBmaW5kIHRoZSBpbnRlcnNlY3Rpb24gb2YgYmV0d2VlblxuICAgICAgICAvLyBncm91cHMgdGhhdCB0aGUgdXNlciBjYW4gY2hlY2tpbiB0aGUgYW5kIGF0dGVuZGVlIGlzIGEgbWVtYmVyIG9mXG4gICAgICAgIGlmICghKG1lLmFkbWluIHx8IChtZS5jaGVja2luICYmIG1lLmNoZWNraW4uYWxsKSkpIHtcbiAgICAgICAgICB2YXIgZ3JvdXBJZCA9IGF0dGVuZGVlLmdyb3Vwcy5maW5kKGZ1bmN0aW9uKGdyb3VwSWQpIHtcbiAgICAgICAgICAgIHJldHVybiBtZS5jaGVja2luLmdyb3Vwcy5pbmRleE9mKGdyb3VwSWQpICE9PSAtMTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB1cmwgPSBncm91cHMgKyBncm91cElkICsgJy91c2Vycy8nICsgYXR0ZW5kZWVJZCArICcvY2hlY2tpbic7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwpO1xuICAgICAgfTtcblxuICAgICAgVXNlclNlcnZpY2UuY2hlY2tvdXQgPSBmdW5jdGlvbihhdHRlbmRlZSkge1xuICAgICAgICB2YXIgYXR0ZW5kZWVJZCA9IGF0dGVuZGVlLl9pZDtcbiAgICAgICAgdmFyIHVybCA9IGJhc2UgKyBhdHRlbmRlZUlkICsgJy9jaGVja291dCc7XG5cbiAgICAgICAgdmFyIG1lID0gU2Vzc2lvbi5nZXRVc2VyKCk7XG4gICAgICAgIC8vIGlmIHRoZSB1c2VyIGlzIG5vdCBvbW5pcG90ZW50LCBmaW5kIHRoZSBpbnRlcnNlY3Rpb24gb2YgYmV0d2VlblxuICAgICAgICAvLyBncm91cHMgdGhhdCB0aGUgdXNlciBjYW4gY2hlY2tvdXQgdGhlIGFuZCBhdHRlbmRlZSBpcyBhIG1lbWJlciBvZlxuICAgICAgICBpZiAoIShtZS5hZG1pbiB8fCAobWUuY2hlY2tpbiAmJiBtZS5jaGVja2luLmFsbCkpKSB7XG4gICAgICAgICAgdmFyIGdyb3VwSWQgPSBhdHRlbmRlZS5ncm91cHMuZmluZChmdW5jdGlvbihncm91cElkKSB7XG4gICAgICAgICAgICByZXR1cm4gbWUuY2hlY2tpbi5ncm91cHMuaW5kZXhPZihncm91cElkKSAhPT0gLTE7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdXJsID0gZ3JvdXBzICsgZ3JvdXBJZCArICcvdXNlcnMvJyArIGF0dGVuZGVlSWQgKyAnL2NoZWNrb3V0JztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCk7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gVXNlclNlcnZpY2U7XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmNvbnRyb2xsZXIoJ0dyb3Vwc0NvbnRyb2xsZXInLCBbXG4gICAgJyRzY29wZScsXG4gICAgJ1VzZXJTZXJ2aWNlJyxcbiAgICAnR3JvdXBTZXJ2aWNlJyxcbiAgICBmdW5jdGlvbiAoJHNjb3BlLCBVc2VyU2VydmljZSwgR3JvdXBTZXJ2aWNlKSB7XG4gICAgICAkc2NvcGUuZ3JvdXBzID0gW107XG5cbiAgICAgICRzY29wZS5nZXRHcm91cHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgR3JvdXBTZXJ2aWNlLmdldEdyb3VwcygpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAkc2NvcGUuZ3JvdXBzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgJHNjb3BlLmdldEdyb3VwcygpO1xuXG4gICAgICAkc2NvcGUuY3JlYXRlR3JvdXAgPSBmdW5jdGlvbihncm91cE5hbWUpIHtcbiAgICAgICAgaWYgKCFncm91cE5hbWUpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgR3JvdXBTZXJ2aWNlLmNyZWF0ZUdyb3VwKGdyb3VwTmFtZSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICRzY29wZS5ncm91cHMucHVzaChyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cCA9IG51bGw7XG4gICAgICAkc2NvcGUuc2VsZWN0R3JvdXAgPSBmdW5jdGlvbihncm91cCkge1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWROZXdWb2x1bnRlZXIgPSBudWxsO1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cCA9IGdyb3VwO1xuICAgICAgICBHcm91cFNlcnZpY2UuZ2V0Vm9sdW50ZWVycyhncm91cC5faWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cC52b2x1bnRlZXJzID0gcmVzcG9uc2UuZGF0YS52b2x1bnRlZXJzO1xuICAgICAgICB9KTtcbiAgICAgICAgVXNlclNlcnZpY2UuZ2V0VXNlcnMoeyBncm91cDogZ3JvdXAuX2lkIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cC51c2VycyA9IHJlc3BvbnNlLmRhdGEudXNlcnM7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLnNlbGVjdGVkTmV3Vm9sdW50ZWVyID0gbnVsbDtcbiAgICAgICRzY29wZS5zZXRTZWxlY3RlZE5ld1ZvbHVudGVlciA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkTmV3Vm9sdW50ZWVyID0gdXNlcjtcbiAgICAgICAgLy8gZm9yY2UgdWkgcmVmcmVzaCAob3RoZXJ3aXNlIHdhaXQgdW50aWwgYW5vdGhlciBldmVudCBmaXJlcylcbiAgICAgICAgLy8gb25seSB3aGVuIHRoaXMgaXMgaW5pdGlhdGVkIGJ5IHRoZSBzZWFyY2hcbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5hZGROZXdWb2x1bnRlZXIgPSBmdW5jdGlvbih1c2VyLCBncm91cCkge1xuICAgICAgICBHcm91cFNlcnZpY2UuYWRkVm9sdW50ZWVyVG9Hcm91cCh1c2VyLl9pZCwgZ3JvdXAuX2lkKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cC52b2x1bnRlZXJzLnB1c2gocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICAkc2NvcGUuc2V0U2VsZWN0ZWROZXdWb2x1bnRlZXIobnVsbCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUucmVtb3ZlVm9sdW50ZWVyRnJvbUdyb3VwID0gZnVuY3Rpb24odXNlciwgZ3JvdXApIHtcbiAgICAgICAgR3JvdXBTZXJ2aWNlLnJlbW92ZVZvbHVudGVlckZyb21Hcm91cCh1c2VyLl9pZCwgZ3JvdXAuX2lkKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cC52b2x1bnRlZXJzLnNwbGljZShcbiAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkR3JvdXAudm9sdW50ZWVycy5maW5kSW5kZXgoZnVuY3Rpb24oZWxlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLl9pZCA9PT0gcmVzcG9uc2UuZGF0YS5faWQ7XG4gICAgICAgICAgICAgIH0pLCAxKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIC8vIFRPRE8gbW92ZSB0aGlzIHRvIGEgZGlyZWN0aXZlP1xuICAgICAgJCgnLmFkZC12b2x1bnRlZXInKS5zZWFyY2goe1xuICAgICAgICBhcGlTZXR0aW5nczoge1xuICAgICAgICAgIHJlc3BvbnNlQXN5bmM6IGZ1bmN0aW9uKHNldHRpbmdzLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gc2V0dGluZ3MudXJsRGF0YS5xdWVyeTtcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLmdldFVzZXJzKHt0ZXh0OiBzZXR0aW5ncy51cmxEYXRhLnF1ZXJ5fSlcbiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oc2VydmVyUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzID0gc2VydmVyUmVzcG9uc2UuZGF0YS51c2Vyc1xuICAgICAgICAgICAgICAgICAgLy8gZmlsdGVyIG91dCB2b2x1bnRlZXJzIHRoYXQgYXJlIGFscmVhZHkgc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnNlbGVjdGVkR3JvdXAudm9sdW50ZWVycy5maW5kSW5kZXgoZnVuY3Rpb24odm9sdW50ZWVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvbHVudGVlci5faWQgPT09IHVzZXIuX2lkO1xuICAgICAgICAgICAgICAgICAgICB9KSA9PT0gLTE7XG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgLy8gbWFwIHNlcnZlciByZXNwb25zZSB0byBtYXRjaCB1aSBzZWFyY2gncyBleHBlY3RlZCBmb3JtYXRcbiAgICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB1c2VyLnByb2ZpbGUubmFtZSB8fCB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB1c2VyLnByb2ZpbGUubmFtZSA/IHVzZXIuZW1haWwgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgdXNlcjogdXNlcixcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHMsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIG1pbkNoYXJhY3RlcnMgOiAzLFxuICAgICAgICBvblNlbGVjdDogZnVuY3Rpb24oc2VsZWN0aW9uKSB7XG4gICAgICAgICAgJHNjb3BlLnNldFNlbGVjdGVkTmV3Vm9sdW50ZWVyKHNlbGVjdGlvbi51c2VyKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBUT0RPIHRoaXMgbmVlZHMgdG8gYmUgaW4gYSBkaXJlY3RpdmVcbiAgICAgIC8vIChzZWUgYWxtb3N0IGV4YWN0IGNvcHkgb2YgdGhpcyBjb2RlIGluIENoZWNraW5Db250cm9sbGVyKVxuICAgICAgdmFyIGN1cnJlbnRRdWVyeSA9IG51bGw7XG4gICAgICAkc2NvcGUuc2VhcmNoVXNlcnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHF1ZXJ5ID0gZ2V0UXVlcnkoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJxdWVyeTpcIiwgcXVlcnkpO1xuXG4gICAgICAgIGlmICghcXVlcnkgfHwgcXVlcnkgPT09IGN1cnJlbnRRdWVyeSkgeyByZXR1cm47IH1cbiAgICAgICAgY3VycmVudFF1ZXJ5ID0gcXVlcnk7XG5cbiAgICAgICAgVXNlclNlcnZpY2UuZ2V0VXNlcnMoe1xuICAgICAgICAgIHRleHQ6IHF1ZXJ5LFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgaWYgKHF1ZXJ5ICE9PSBjdXJyZW50UXVlcnkpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7XG5cbiAgICAgICAgICBzZXRTZWFyY2hVc2VycyhyZXNwb25zZS5kYXRhLnVzZXJzKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBmdW5jdGlvbiBzZXRTZWFyY2hVc2VycyAoc2VhcmNoUmVzdWx0cykge1xuICAgICAgICBzZWFyY2hSZXN1bHRzID0gc2VhcmNoUmVzdWx0cyB8fCAkc2NvcGUuc2VsZWN0ZWRHcm91cC5zZWFyY2hVc2VycztcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkR3JvdXAuc2VhcmNoVXNlcnMgPSBzZWFyY2hSZXN1bHRzXG4gICAgICAgICAgLy8gZmlsdGVyIG91dCBhbnkgdXNlcnMgdGhhdCBhcmUgYWxyZWFkeSBpbiB0aGlzIGdyb3VwXG4gICAgICAgICAgLmZpbHRlcihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnNlbGVjdGVkR3JvdXAudXNlcnMuZmluZEluZGV4KGZ1bmN0aW9uKGdyb3VwVXNlcikge1xuICAgICAgICAgICAgICByZXR1cm4gZ3JvdXBVc2VyLl9pZCA9PT0gdXNlci5faWQ7XG4gICAgICAgICAgICB9KSA9PT0gLTE7XG4gICAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGdldFF1ZXJ5KCkge1xuICAgICAgICBpZiAoISRzY29wZS51c2VyUXVlcnkgfHwgJHNjb3BlLnVzZXJRdWVyeS5sZW5ndGggPCAzKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICRzY29wZS51c2VyUXVlcnk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5hZGRVc2Vyc1RvR3JvdXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNlbGVjdGVkVXNlcnMgPSAkc2NvcGUuc2VsZWN0ZWRHcm91cC5zZWFyY2hVc2Vycy5maWx0ZXIoZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgIHJldHVybiB1c2VyLmFjdGl2ZTtcbiAgICAgICAgfSkubWFwKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICByZXR1cm4gdXNlci5faWQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIEdyb3VwU2VydmljZS5hZGRVc2Vyc1RvR3JvdXAoJHNjb3BlLnNlbGVjdGVkR3JvdXAuX2lkLCBzZWxlY3RlZFVzZXJzKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cC51c2VycyA9IHJlc3BvbnNlLmRhdGEudXNlcnM7XG4gICAgICAgICAgICBzZXRTZWFyY2hVc2VycygpO1xuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLmFkZEFsbFVzZXJzVG9Hcm91cCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZWN0ZWRVc2VycyA9ICRzY29wZS5zZWxlY3RlZEdyb3VwLnNlYXJjaFVzZXJzLm1hcChmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHVzZXIuX2lkO1xuICAgICAgICB9KTtcblxuICAgICAgICBHcm91cFNlcnZpY2UuYWRkVXNlcnNUb0dyb3VwKCRzY29wZS5zZWxlY3RlZEdyb3VwLl9pZCwgc2VsZWN0ZWRVc2VycylcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkR3JvdXAudXNlcnMgPSByZXNwb25zZS5kYXRhLnVzZXJzO1xuICAgICAgICAgICAgc2V0U2VhcmNoVXNlcnMoKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmNvbnRyb2xsZXIoJ0NoZWNraW5Db250cm9sbGVyJywgW1xuICAgICckc2NvcGUnLFxuICAgICdVc2VyU2VydmljZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU2VydmljZSkge1xuICAgICAgLy8gVE9ETyBtYWtlIHRoaXMgYSBkaXJlY3RpdmVcbiAgICAgIHZhciAkc2VhcmNoID0gJCgnLnVzZXJTZWFyY2ggPiAuc3RpY2t5Jyk7XG4gICAgICAkc2VhcmNoLnN0aWNreSh7XG4gICAgICAgIGNvbnRleHQ6ICcudXNlckxpc3QgPiB0YWJsZScsXG4gICAgICB9KTtcblxuICAgICAgdmFyIGN1cnJlbnRRdWVyeSA9IG51bGw7XG4gICAgICAvLyBvbmx5IHJldHVybiBuZXcgcXVlcnkgaWYgbGVuZ3RoID49IDMsIGVsc2UgcmV0dXJuXG4gICAgICBmdW5jdGlvbiBnZXRRdWVyeSgpIHtcbiAgICAgICAgaWYgKCEkc2NvcGUucXVlcnkpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmICgkc2NvcGUucXVlcnkubGVuZ3RoID4gMCAmJiAkc2NvcGUucXVlcnkubGVuZ3RoIDwgMykge1xuICAgICAgICAgIHJldHVybiBjdXJyZW50UXVlcnk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICRzY29wZS5xdWVyeTtcbiAgICAgIH1cblxuICAgICAgJHNjb3BlLnNlYXJjaFVzZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBxdWVyeSA9IGdldFF1ZXJ5KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwicXVlcnk6XCIsIHF1ZXJ5KTtcblxuICAgICAgICBpZiAocXVlcnkgPT09IGN1cnJlbnRRdWVyeSkgeyByZXR1cm47IH1cbiAgICAgICAgY3VycmVudFF1ZXJ5ID0gcXVlcnk7XG5cbiAgICAgICAgLy8gdGhpcyBpcyBhbGwgYSBsb3cta2V5IHdvcmthcm91bmQgZm9yICRodHRwJ3MgbGFjayBvZiBjYW5jZWwoKVxuICAgICAgICBVc2VyU2VydmljZS5nZXRVc2Vycyh7XG4gICAgICAgICAgcGFnZTogMCwgLy8gaW5kaWNhdGUgdGhhdCB3ZSB3YW50IHRoaXMgdG8gYmUgcGFnZWQgKHNpemUgaXMgZGVmYXVsdCA1MClcbiAgICAgICAgICB0ZXh0OiBxdWVyeSxcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgIC8vIGlmIHRoaXMgaXMgbm8gbG9uZ2VyIHRoZSBtb3N0IHJlY2VudCBxdWVyeSwgdGhlbiBpZ25vcmVcbiAgICAgICAgICBpZiAocXVlcnkgIT09IGN1cnJlbnRRdWVyeSkgeyByZXR1cm47IH1cbiAgICAgICAgICByZXNldFVzZXJMaXN0KCk7XG4gICAgICAgICAgbG9hZEZyb21SZXNwb25zZS5iaW5kKCRzY29wZS51c2VycykocmVzcG9uc2UpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS51c2VycyA9IHt9O1xuICAgICAgZnVuY3Rpb24gcmVzZXRVc2VyTGlzdCgpIHtcbiAgICAgICAgJHNjb3BlLnVzZXJzID0ge1xuICAgICAgICAgIHVzZXJzOiBbXSxcbiAgICAgICAgICBidXN5OiBmYWxzZSxcbiAgICAgICAgICBuZXh0UGFnZTogMCxcbiAgICAgICAgICB0b3RhbFBhZ2VzOiAwLFxuICAgICAgICAgIHRvdGFsVXNlcnM6IDAsXG4gICAgICAgICAgZ2V0TmV4dFBhZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYnVzeSkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgdGhpcy5idXN5ID0gdHJ1ZTtcblxuICAgICAgICAgICAgVXNlclNlcnZpY2UuZ2V0VXNlcnMoe1xuICAgICAgICAgICAgICB0ZXh0OiBnZXRRdWVyeSgpLFxuICAgICAgICAgICAgICBwYWdlOiB0aGlzLm5leHRQYWdlLFxuICAgICAgICAgICAgfSkudGhlbihsb2FkRnJvbVJlc3BvbnNlLmJpbmQodGhpcykpO1xuXG4gICAgICAgICAgICB0aGlzLm5leHRQYWdlID0gdGhpcy5uZXh0UGFnZSArIDE7XG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJlc2V0VXNlckxpc3QoKTtcblxuICAgICAgJHNjb3BlLnNlbGVjdGVkVXNlciA9IG51bGw7XG4gICAgICB2YXIgJHVzZXJEZXRhaWxzID0gJCgnLnVzZXJEZXRhaWxzJyk7XG4gICAgICB2YXIgJHNtc05vdGlmaWNhdGlvbnMgPSAkKCcuc21zTm90aWZpY2F0aW9ucycpO1xuXG4gICAgICAkc2NvcGUuc2V0U2VsZWN0ZWRVc2VyID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRVc2VyID0gdXNlcjtcbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAkdXNlckRldGFpbHMubW9kYWwoe1xuICAgICAgICAgICAgLy8gJ2FwcHJvdmFsJyA9IGNoZWNraW5nIGluXG4gICAgICAgICAgICBvbkFwcHJvdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBjaGVja2luKHVzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgIC8vIG5vdCB3b3JraW5nIHBseiBpZ25vcmVcbiAgICAgICAgICAgICAgICAvLyBpZiAoIXVzZXIuY29uZmlybWF0aW9uLndhbnRzU01TTm90aWZpY2F0aW9ucykge1xuICAgICAgICAgICAgICAgIC8vICAgJHNtc05vdGlmaWNhdGlvbnMubW9kYWwoe1xuICAgICAgICAgICAgICAgIC8vICAgICBvbkRlbnk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vICAgICAgIHVzZXIuY29uZmlybWF0aW9uLndhbnRzU01TTm90aWZpY2F0aW9ucyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vICAgICAgIHVwZGF0ZUNvbmZpcm1hdGlvbih1c2VyKTtcbiAgICAgICAgICAgICAgICAvLyAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyAgICAgb25BcHByb3ZlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgICB1c2VyLmNvbmZpcm1hdGlvbi53YW50c1NNU05vdGlmaWNhdGlvbnMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8vICAgICAgIHVwZGF0ZUNvbmZpcm1hdGlvbih1c2VyKTtcbiAgICAgICAgICAgICAgICAvLyAgICAgfVxuICAgICAgICAgICAgICAgIC8vICAgfSkubW9kYWwoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRGVueTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGNoZWNrb3V0KHVzZXIpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgIC8vIG5vdGhpbmcgcmlnaHQgbm93XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLm1vZGFsKCdzaG93Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJHVzZXJEZXRhaWxzLm1vZGFsKCdoaWRlJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgICRzY29wZS51c2Vycy5nZXROZXh0UGFnZSgpO1xuXG4gICAgICBmdW5jdGlvbiBsb2FkRnJvbVJlc3BvbnNlKHJlc3BvbnNlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuXG4gICAgICAgIHRoaXMudXNlcnMgPSB0aGlzLnVzZXJzLmNvbmNhdChyZXNwb25zZS5kYXRhLnVzZXJzKTtcblxuICAgICAgICB0aGlzLnRvdGFsVXNlcnMgPSByZXNwb25zZS5kYXRhLnRvdGFsVXNlcnM7XG4gICAgICAgIHRoaXMudG90YWxQYWdlcyA9IHJlc3BvbnNlLmRhdGEudG90YWxQYWdlcztcbiAgICAgICAgdGhpcy5uZXh0UGFnZSA9IHRoaXMubmV4dFBhZ2UgKyAxO1xuICAgICAgICB0aGlzLmJ1c3kgPSBmYWxzZTtcblxuICAgICAgICAkc2VhcmNoLnN0aWNreSgncmVmcmVzaCcpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjaGVja2luKHVzZXIpIHtcbiAgICAgICAgcmV0dXJuIFVzZXJTZXJ2aWNlLmNoZWNraW4odXNlcilcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2hlY2tlZCBpbicsIGRhdGEpO1xuICAgICAgICAgICAgdXNlci5zdGF0dXMuY2hlY2tlZEluID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB1c2VyO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjaGVja291dCh1c2VyKSB7XG4gICAgICAgIHJldHVybiBVc2VyU2VydmljZS5jaGVja291dCh1c2VyKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGVja2VkIG91dCcsIGRhdGEpO1xuICAgICAgICAgICAgdXNlci5zdGF0dXMuY2hlY2tlZEluID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gdXNlcjtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gbm90IHdvcmtpbmcgeWV0XG4gICAgICAvLyBmdW5jdGlvbiB1cGRhdGVDb25maXJtYXRpb24odXNlcikge1xuICAgICAgLy8gICByZXR1cm4gVXNlclNlcnZpY2UudXBkYXRlQ29uZmlybWF0aW9uKHVzZXIpXG4gICAgICAvLyAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgLy8gICAgICAgY29uc29sZS5sb2coJ3VwZGF0ZSBjb25maXJtYXRpb24nLCBkYXRhKTtcbiAgICAgIC8vICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgLy8gICAgIH0pO1xuICAgICAgLy8gfVxuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRzdGF0ZScsXG4gICAgJ0F1dGhTZXJ2aWNlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgQXV0aFNlcnZpY2UpIHtcblxuICAgICAgZnVuY3Rpb24gb25TdWNjZXNzKGRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3N1Y2Nlc3MnLCBkYXRhKTtcbiAgICAgICAgJHN0YXRlLmdvKCdhcHAuY2hlY2tpbicpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBvbkZhaWx1cmUoZGF0YSkge1xuICAgICAgICBjb25zb2xlLmxvZygnZmFpbHVyZScsIGRhdGEpO1xuICAgICAgfVxuXG4gICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgQXV0aFNlcnZpY2UubG9naW5XaXRoUGFzc3dvcmQoXG4gICAgICAgICAgJHNjb3BlLmVtYWlsLCAkc2NvcGUucGFzc3dvcmRcbiAgICAgICAgKS50aGVuKG9uU3VjY2Vzcywgb25GYWlsdXJlKTtcbiAgICAgIH07XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmNvbnRyb2xsZXIoJ1Rvb2xiYXJDb250cm9sbGVyJywgW1xuICAgICckc2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICckcm9vdFNjb3BlJyxcbiAgICAnU2Vzc2lvbicsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRyb290U2NvcGUsIFNlc3Npb24pIHtcbiAgICAgIHZhciB1c2VyID0gU2Vzc2lvbi5nZXRVc2VyKCk7XG5cbiAgICAgICRzY29wZS5zdGF0ZXMgPSAoW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2FwcC5jaGVja2luJyxcbiAgICAgICAgICB0aXRsZTogJ0NoZWNraW4nLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2FwcC5ncm91cHMnLFxuICAgICAgICAgIHRpdGxlOiAnR3JvdXBzJyxcbiAgICAgICAgICBhZG1pbk9ubHk6IHRydWUsXG4gICAgICAgIH1cbiAgICAgIF0pLmZpbHRlcihmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgICByZXR1cm4gIShzdGF0ZS5hZG1pbk9ubHkgJiYgIXVzZXIuYWRtaW4pO1xuICAgICAgfSk7XG5cbiAgICAgICQoJy5sb2dvdXQnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgU2Vzc2lvbi5kZXN0cm95KCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICBdKTtcbiIsIi8qKlxuICogSGVyZSBsYXkgdGhlIGJhc2UgdXJscyB1c2VkIGluIHRoZSBodHRwIHVybCBpbmplY3RvclxuICovXG5hbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpLmNvbnN0YW50KCdTRVJWRVJfVVJMJywge1xuICAvLyBCQVNFX1VSTDogJ2h0dHA6Ly9kZjNiODYwNi5uZ3Jvay5pby8nLFxuICBCQVNFX1VSTDogICdodHRwczovL2FwcGx5LmhhY2tndC5jb20vJyxcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
