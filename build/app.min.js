var app=angular.module("checkin",["ui.router"]);app.config(["$httpProvider",function(e,t){e.interceptors.push("ApiAuthenticator")}]),app.factory("ApiAuthenticator",["Session","SERVER_URL",function(e,t){return{request:function(n){0!==n.url.indexOf("api/")&&0!==n.url.indexOf("auth/")||(n.url=t.BASE_URL+n.url,n.headers["Access-Control-Allow-Origin"]=t.BASE_URL);var o=e.getToken();return o&&(n.headers["x-access-token"]=o),n}}}]),app.directive("title",["$rootScope","$timeout",function(e,t){return{link:function(){var n=function(n,o){t(function(){e.title=o.data&&o.data.pageTitle?o.data.pageTitle:"Default title"})};e.$on("$stateChangeSuccess",n)}}}]),angular.module("checkin").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("login",{url:"/login",templateUrl:"views/login/login.html",controller:"LoginController",data:{requireLogin:!1,pageTitle:"Login"}}).state("app",{abstract:!0,views:{"@":{templateUrl:"views/base.html"},"toolbar@app":{templateUrl:"views/toolbar/toolbar.html",controller:"ToolbarController"}},data:{requireLogin:!0,pageTitle:"Checkin"}}).state("app.checkin",{url:"/",templateUrl:"views/checkin/checkin.html",controller:"CheckinController"}),t.otherwise("/")}]).run(["$rootScope","$state","Session",function(e,t,n){e.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0}),e.$on("$stateChangeStart",function(e,o,r){var c=o.data.requireLogin;c&&!n.getToken()&&(e.preventDefault(),t.go("login"))}),n.getToken()||t.go("login")}]),angular.module("checkin").factory("AuthService",["$q","$http","$rootScope","$state","Session",function(e,t,n,o,r){function c(t){var n=t.data;return console.log("auth success",n),r.create(n.token,n.user),e(function(e){e(n.user)})}function i(t,n){return console.log("auth fail",t),o.go("login"),e(function(e,n){n(t)})}var s={},a="auth/";return s.loginWithPassword=function(e,n){return t.post(a+"login",{email:e,password:n}).then(c,i)},s.loginWithToken=function(e){return console.warn("Not actually sure if this works yet!"),t.post(a+"login",{token:e}).then(c,function(){400===status&&r.destroy().then(i)})},s}]),angular.module("checkin").service("Session",["$rootScope","$window","$q",function(e,t,n){this.create=function(n,o){t.localStorage.jwt=n,t.localStorage.userId=o._id,t.localStorage.currentUser=JSON.stringify(o),e.currentUser=o},this.destroy=function(){return delete t.localStorage.jwt,delete t.localStorage.userId,delete t.localStorage.currentUser,e.currentUser=null,n(function(e,t){e()})},this.getToken=function(){return t.localStorage.jwt},this.getUserId=function(){return t.localStorage.userId},this.getUser=function(){return JSON.parse(t.localStorage.currentUser)}}]),angular.module("checkin").factory("UserService",["$q","$http","Session",function(e,t,n){var o="api/users",r=o+"/",c={};return c.getUsers=function(e){var n=e?o+"?"+$.param({text:e.text,page:e.page?e.page:0,size:e.size?e.size:50}):r;return t.get(n)},c.checkin=function(e){return t.post(r+e+"/checkin")},c.checkout=function(e){return t.post(r+e+"/checkout")},c}]),angular.module("checkin").controller("CheckinController",["$scope","UserService",function(e,t){function n(){return e.query}function o(){e.users={users:[],busy:!1,nextPage:0,totalPages:0,totalUsers:0}}function r(e){console.log(e.data),this.users=this.users.concat(e.data.users),this.totalUsers=e.data.totalUsers,this.totalPages=e.data.totalPages,this.nextPage=this.nextPage+1,this.busy=!1,c.sticky("refresh")}var c=$(".userSearch > .sticky");c.sticky({context:".userList > table"});var i=null;e.searchUsers=function(){var c=n();if(console.log("query:",c),c!==i){var s=i=t.getUsers({text:c});s.then(function(t){s===i&&(o(),r.bind(e.users)(t))})}},e.users={},o(),e.selectedUser=null,e.setSelectedUser=function(t){var n=$(".userDetails");n.modal(),e.selectedUser=t,t?n.modal("show"):n.modal("hide")},e.users.getNextPage=function(){this.busy||(this.busy=!0,this.nextPage=this.nextPage+1,t.getUsers({text:n(),page:this.nextPage}).then(r.bind(this)))},e.users.getNextPage(),e.checkin=function(e){t.checkin(e).then(function(e){console.log("checked in",e)})},e.checkout=function(e){t.checkout(e).then(function(e){console.log("checked out",e)})}}]),angular.module("checkin").controller("LoginController",["$scope","$state","AuthService",function(e,t,n){function o(e){console.log("success",e),t.go("app.checkin")}function r(e){console.log("failure",e)}e.login=function(){n.loginWithPassword(e.email,e.password).then(o,r)}}]),angular.module("checkin").controller("ToolbarController",["$scope","$state","Session",function(e,t,n){$(".logout").click(function(){n.destroy().then(function(){t.go("login")})})}]),angular.module("checkin").constant("SERVER_URL",{BASE_URL:"https://ce4e7571.ngrok.io/"});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJvdXRlcy5qcyIsImF1dGgvQXV0aFNlcnZpY2UuanMiLCJzZXNzaW9uL1Nlc3Npb24uanMiLCJ1c2Vycy9Vc2VyU2VydmljZS5qcyIsImNoZWNraW4vY2hlY2tpbkNvbnRyb2xsZXIuanMiLCJsb2dpbi9sb2dpbkNvbnRyb2xsZXIuanMiLCJ0b29sYmFyL3Rvb2xiYXJDb250cm9sbGVyLmpzIiwiY29uZmlnLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkaHR0cFByb3ZpZGVyIiwiU0VSVkVSX1VSTCIsImludGVyY2VwdG9ycyIsInB1c2giLCJmYWN0b3J5IiwiU2Vzc2lvbiIsInJlcXVlc3QiLCJ1cmwiLCJpbmRleE9mIiwiQkFTRV9VUkwiLCJoZWFkZXJzIiwidG9rZW4iLCJnZXRUb2tlbiIsImRpcmVjdGl2ZSIsIiRyb290U2NvcGUiLCIkdGltZW91dCIsImxpbmsiLCJsaXN0ZW5lciIsImV2ZW50IiwidG9TdGF0ZSIsInRpdGxlIiwiZGF0YSIsInBhZ2VUaXRsZSIsIiRvbiIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwic3RhdGUiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJyZXF1aXJlTG9naW4iLCJhYnN0cmFjdCIsInZpZXdzIiwiQCIsInRvb2xiYXJAYXBwIiwib3RoZXJ3aXNlIiwicnVuIiwiJHN0YXRlIiwiZG9jdW1lbnQiLCJib2R5Iiwic2Nyb2xsVG9wIiwiZG9jdW1lbnRFbGVtZW50IiwidG9QYXJhbXMiLCJwcmV2ZW50RGVmYXVsdCIsImdvIiwiJHEiLCIkaHR0cCIsImxvZ2luU3VjY2VzcyIsInJlc3BvbnNlIiwiY29uc29sZSIsImxvZyIsImNyZWF0ZSIsInVzZXIiLCJyZXNvbHZlIiwibG9naW5GYWlsdXJlIiwiY2FsbGJhY2siLCJyZWplY3QiLCJhdXRoU2VydmljZSIsImJhc2VVcmwiLCJsb2dpbldpdGhQYXNzd29yZCIsImVtYWlsIiwicGFzc3dvcmQiLCJwb3N0IiwidGhlbiIsImxvZ2luV2l0aFRva2VuIiwid2FybiIsInN0YXR1cyIsImRlc3Ryb3kiLCJzZXJ2aWNlIiwiJHdpbmRvdyIsInRoaXMiLCJsb2NhbFN0b3JhZ2UiLCJqd3QiLCJ1c2VySWQiLCJfaWQiLCJjdXJyZW50VXNlciIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRVc2VySWQiLCJnZXRVc2VyIiwicGFyc2UiLCJ1c2VycyIsImJhc2UiLCJVc2VyU2VydmljZSIsImdldFVzZXJzIiwib3B0aW9ucyIsIiQiLCJwYXJhbSIsInRleHQiLCJwYWdlIiwic2l6ZSIsImdldCIsImNoZWNraW4iLCJjaGVja291dCIsIiRzY29wZSIsImdldFF1ZXJ5IiwicXVlcnkiLCJyZXNldFVzZXJMaXN0IiwiYnVzeSIsIm5leHRQYWdlIiwidG90YWxQYWdlcyIsInRvdGFsVXNlcnMiLCJsb2FkRnJvbVJlc3BvbnNlIiwiY29uY2F0IiwiJHNlYXJjaCIsInN0aWNreSIsImNvbnRleHQiLCJjdXJyZW50UXVlcnkiLCJzZWFyY2hVc2VycyIsInRoaXNRdWVyeSIsImJpbmQiLCJzZWxlY3RlZFVzZXIiLCJzZXRTZWxlY3RlZFVzZXIiLCIkdXNlckRldGFpbHMiLCJtb2RhbCIsImdldE5leHRQYWdlIiwiQXV0aFNlcnZpY2UiLCJvblN1Y2Nlc3MiLCJvbkZhaWx1cmUiLCJsb2dpbiIsImNsaWNrIiwiY29uc3RhbnQiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsV0FDQSxhQUdBRixLQUFBRyxRQUNBLGdCQUNBLFNBQUFDLEVBQUFDLEdBR0FELEVBQUFFLGFBQUFDLEtBQUEsdUJBSUFQLElBQUFRLFFBQUEsb0JBQ0EsVUFDQSxhQUNBLFNBQUFDLEVBQUFKLEdBQ0EsT0FDQUssUUFBQSxTQUFBUCxHQUNBLElBQUFBLEVBQUFRLElBQUFDLFFBQUEsU0FBQSxJQUFBVCxFQUFBUSxJQUFBQyxRQUFBLFdBQ0FULEVBQUFRLElBQUFOLEVBQUFRLFNBQUFWLEVBQUFRLElBQ0FS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QSxXQUNBOEIsV0FBQSxtQkFDQSxTQUNBLFNBQ0EsY0FDQSxTQUFBaUUsRUFBQXpELEVBQUErRSxHQUVBLFFBQUFDLEdBQUEvRixHQUNBMkIsUUFBQUMsSUFBQSxVQUFBNUIsR0FDQWUsRUFBQU8sR0FBQSxlQUdBLFFBQUEwRSxHQUFBaEcsR0FDQTJCLFFBQUFDLElBQUEsVUFBQTVCLEdBR0F3RSxFQUFBeUIsTUFBQSxXQUNBSCxFQUFBekQsa0JBQ0FtQyxFQUFBbEMsTUFBQWtDLEVBQUFqQyxVQUNBRSxLQUFBc0QsRUFBQUMsT0NuQkF4SCxRQUFBQyxPQUFBLFdBQ0E4QixXQUFBLHFCQUNBLFNBQ0EsU0FDQSxVQUNBLFNBQUFpRSxFQUFBekQsRUFBQS9CLEdBQ0FnRixFQUFBLFdBQUFrQyxNQUFBLFdBQ0FsSCxFQUFBNkQsVUFBQUosS0FBQSxXQUNBMUIsRUFBQU8sR0FBQSxnQkNMQTlDLFFBQUFDLE9BQUEsV0FBQTBILFNBQUEsY0FDQS9HLFNBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicsIFtcbiAgJ3VpLnJvdXRlcicsXG5dKTtcblxuYXBwLmNvbmZpZyhbXG4gICckaHR0cFByb3ZpZGVyJyxcbiAgZnVuY3Rpb24oJGh0dHBQcm92aWRlciwgU0VSVkVSX1VSTCkge1xuXG4gICAgLy8gYWRkIHJvb3QgdXJsIHRvIGFsbCBhcGkgYW5kIGF1dGggcmVxdWVzdHNcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBcGlBdXRoZW50aWNhdG9yJyk7XG4gIH1cbl0pO1xuXG5hcHAuZmFjdG9yeSgnQXBpQXV0aGVudGljYXRvcicsIFtcbiAgJ1Nlc3Npb24nLFxuICAnU0VSVkVSX1VSTCcsXG4gIGZ1bmN0aW9uKFNlc3Npb24sIFNFUlZFUl9VUkwpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVxdWVzdDogZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgICAgIGlmIChjb25maWcudXJsLmluZGV4T2YoJ2FwaS8nKSA9PT0gMCB8fCBjb25maWcudXJsLmluZGV4T2YoJ2F1dGgvJykgPT09IDApIHtcbiAgICAgICAgICBjb25maWcudXJsID0gU0VSVkVSX1VSTC5CQVNFX1VSTCArIGNvbmZpZy51cmw7XG4gICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbiddID0gU0VSVkVSX1VSTC5CQVNFX1VSTDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdG9rZW4gPSBTZXNzaW9uLmdldFRva2VuKCk7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWyd4LWFjY2Vzcy10b2tlbiddID0gdG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgIH1cbiAgICB9O1xuICB9XG5dKTtcblxuYXBwLmRpcmVjdGl2ZSgndGl0bGUnLCBbJyRyb290U2NvcGUnLCAnJHRpbWVvdXQnLFxuICBmdW5jdGlvbigkcm9vdFNjb3BlLCAkdGltZW91dCkge1xuICAgIHJldHVybiB7XG4gICAgICBsaW5rOiBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgbGlzdGVuZXIgPSBmdW5jdGlvbihldmVudCwgdG9TdGF0ZSkge1xuXG4gICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnRpdGxlID0gKHRvU3RhdGUuZGF0YSAmJiB0b1N0YXRlLmRhdGEucGFnZVRpdGxlKSA/XG4gICAgICAgICAgICAgIHRvU3RhdGUuZGF0YS5wYWdlVGl0bGUgOiAnRGVmYXVsdCB0aXRsZSc7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBsaXN0ZW5lcik7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb25maWcoW1xuICAgICckc3RhdGVQcm92aWRlcicsXG4gICAgJyR1cmxSb3V0ZXJQcm92aWRlcicsXG4gICAgZnVuY3Rpb24oXG4gICAgICAkc3RhdGVQcm92aWRlcixcbiAgICAgICR1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XG4gICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvbG9naW4vbG9naW4uaHRtbFwiLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHJlcXVpcmVMb2dpbjogZmFsc2UsXG4gICAgICAgICAgICAgIHBhZ2VUaXRsZTogJ0xvZ2luJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc3RhdGUoJ2FwcCcsIHtcbiAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgJ0AnOiB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvYmFzZS5odG1sXCIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICd0b29sYmFyQGFwcCc6IHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy90b29sYmFyL3Rvb2xiYXIuaHRtbFwiLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUb29sYmFyQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICByZXF1aXJlTG9naW46IHRydWUsXG4gICAgICAgICAgICAgIHBhZ2VUaXRsZTogJ0NoZWNraW4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zdGF0ZSgnYXBwLmNoZWNraW4nLCB7XG4gICAgICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvY2hlY2tpbi9jaGVja2luLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NoZWNraW5Db250cm9sbGVyJyxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG4gICAgfVxuICBdKVxuICAucnVuKFtcbiAgICAnJHJvb3RTY29wZScsXG4gICAgJyRzdGF0ZScsXG4gICAgJ1Nlc3Npb24nLFxuICAgIGZ1bmN0aW9uKFxuICAgICAgJHJvb3RTY29wZSxcbiAgICAgICRzdGF0ZSxcbiAgICAgIFNlc3Npb24pe1xuXG4gICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcbiAgICAgIH0pO1xuXG4gICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zKSB7XG4gICAgICAgIHZhciByZXF1aXJlTG9naW4gPSB0b1N0YXRlLmRhdGEucmVxdWlyZUxvZ2luO1xuXG4gICAgICAgIGlmIChyZXF1aXJlTG9naW4gJiYgIVNlc3Npb24uZ2V0VG9rZW4oKSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKCFTZXNzaW9uLmdldFRva2VuKCkpIHtcbiAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgfVxuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5mYWN0b3J5KCdBdXRoU2VydmljZScsIFtcbiAgICAnJHEnLFxuICAgICckaHR0cCcsXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkcSwgJGh0dHAsICRyb290U2NvcGUsICRzdGF0ZSwgU2Vzc2lvbikge1xuICAgICAgdmFyIGF1dGhTZXJ2aWNlID0ge307XG4gICAgICB2YXIgYmFzZVVybCA9ICdhdXRoLyc7XG5cbiAgICAgIGZ1bmN0aW9uIGxvZ2luU3VjY2VzcyhyZXNwb25zZSkge1xuICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIGNvbnNvbGUubG9nKCdhdXRoIHN1Y2Nlc3MnLCBkYXRhKTtcbiAgICAgICAgU2Vzc2lvbi5jcmVhdGUoZGF0YS50b2tlbiwgZGF0YS51c2VyKTtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgICByZXNvbHZlKGRhdGEudXNlcik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBsb2dpbkZhaWx1cmUoZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2F1dGggZmFpbCcsIGRhdGEpO1xuICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICByZWplY3QoZGF0YSk7XG4gICAgICAgIH0pO1xuXG4gICAgICB9XG5cbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luV2l0aFBhc3N3b3JkID0gZnVuY3Rpb24oZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgIC5wb3N0KGJhc2VVcmwgKyAnbG9naW4nLCB7XG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbihsb2dpblN1Y2Nlc3MsIGxvZ2luRmFpbHVyZSk7XG4gICAgICB9O1xuXG4gICAgICAvLyBUT0RPIHVuc3VyZSBpZiB0aGlzIHdvcmtzIVxuICAgICAgYXV0aFNlcnZpY2UubG9naW5XaXRoVG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJOb3QgYWN0dWFsbHkgc3VyZSBpZiB0aGlzIHdvcmtzIHlldCFcIik7XG4gICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgIC5wb3N0KGJhc2VVcmwgKyAnbG9naW4nLCB7XG4gICAgICAgICAgICB0b2tlbjogdG9rZW5cbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKGxvZ2luU3VjY2VzcywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgU2Vzc2lvbi5kZXN0cm95KCkudGhlbihsb2dpbkZhaWx1cmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlO1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5zZXJ2aWNlKCdTZXNzaW9uJywgW1xuICAgICckcm9vdFNjb3BlJyxcbiAgICAnJHdpbmRvdycsXG4gICAgJyRxJyxcbiAgICBmdW5jdGlvbigkcm9vdFNjb3BlLCAkd2luZG93LCAkcSl7XG4gICAgICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKHRva2VuLCB1c2VyKXtcbiAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0ID0gdG9rZW47XG4gICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnVzZXJJZCA9IHVzZXIuX2lkO1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlciA9IEpTT04uc3RyaW5naWZ5KHVzZXIpO1xuICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3Q7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS51c2VySWQ7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcjtcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRUb2tlbiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3Q7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmdldFVzZXJJZCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS51c2VySWQ7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmdldFVzZXIgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcik7XG4gICAgICB9O1xuICB9XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5mYWN0b3J5KCdVc2VyU2VydmljZScsIFtcbiAgICAnJHEnLFxuICAgICckaHR0cCcsXG4gICAgJ1Nlc3Npb24nLFxuICAgIGZ1bmN0aW9uKCRxLCAkaHR0cCwgU2Vzc2lvbikge1xuICAgICAgdmFyIHVzZXJzID0gJ2FwaS91c2Vycyc7XG4gICAgICB2YXIgYmFzZSA9IHVzZXJzICsgJy8nO1xuXG4gICAgICB2YXIgVXNlclNlcnZpY2UgPSB7fTtcblxuICAgICAgVXNlclNlcnZpY2UuZ2V0VXNlcnMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIC8vIFRPRE8gW2FkYWldIHllcyB0aGlzIGlzIGtpbmRhIGR1bWIgYW5kIHNob3VsZCBiZSBiZXR0ZXJcbiAgICAgICAgdmFyIHVybCA9IG9wdGlvbnMgPyB1c2VycyArICc/JyArICQucGFyYW0oXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogb3B0aW9ucy50ZXh0LFxuICAgICAgICAgICAgcGFnZTogb3B0aW9ucy5wYWdlID8gb3B0aW9ucy5wYWdlIDogMCxcbiAgICAgICAgICAgIHNpemU6IG9wdGlvbnMuc2l6ZSA/IG9wdGlvbnMuc2l6ZSA6IDUwXG4gICAgICAgICAgfSkgOiBiYXNlO1xuXG4gICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKTtcbiAgICAgIH07XG5cbiAgICAgIFVzZXJTZXJ2aWNlLmNoZWNraW4gPSBmdW5jdGlvbih1c2VySWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoYmFzZSArIHVzZXJJZCArICcvY2hlY2tpbicpO1xuICAgICAgfTtcblxuICAgICAgVXNlclNlcnZpY2UuY2hlY2tvdXQgPSBmdW5jdGlvbih1c2VySWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoYmFzZSArIHVzZXJJZCArICcvY2hlY2tvdXQnKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBVc2VyU2VydmljZTtcbiAgICB9XG4gIF0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuY29udHJvbGxlcignQ2hlY2tpbkNvbnRyb2xsZXInLCBbXG4gICAgJyRzY29wZScsXG4gICAgJ1VzZXJTZXJ2aWNlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsIFVzZXJTZXJ2aWNlKSB7XG5cbiAgICAgIHZhciAkc2VhcmNoID0gJCgnLnVzZXJTZWFyY2ggPiAuc3RpY2t5Jyk7XG4gICAgICAkc2VhcmNoLnN0aWNreSh7XG4gICAgICAgIGNvbnRleHQ6ICcudXNlckxpc3QgPiB0YWJsZScsXG4gICAgICB9KTtcblxuICAgICAgdmFyIGN1cnJlbnRRdWVyeSA9IG51bGw7XG4gICAgICBmdW5jdGlvbiBnZXRRdWVyeSgpIHtcbiAgICAgICAgcmV0dXJuICRzY29wZS5xdWVyeTtcbiAgICAgICAgLy8gcmV0dXJuICgkc2NvcGUucXVlcnkgJiYgJHNjb3BlLnF1ZXJ5Lmxlbmd0aCA+PSAzKSA/ICRzY29wZS5xdWVyeSA6IG51bGw7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5zZWFyY2hVc2VycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcXVlcnkgPSBnZXRRdWVyeSgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInF1ZXJ5OlwiLCBxdWVyeSk7XG4gICAgICAgIGlmIChxdWVyeSA9PT0gY3VycmVudFF1ZXJ5KSB7IHJldHVybjsgfVxuXG4gICAgICAgIC8vIHRoaXMgaXMgYWxsIGEgbG93LWtleSB3b3JrYXJvdW5kIGZvciAkaHR0cCdzIGxhY2sgb2YgY2FuY2VsKClcbiAgICAgICAgdmFyIHRoaXNRdWVyeSA9IGN1cnJlbnRRdWVyeSA9IFVzZXJTZXJ2aWNlLmdldFVzZXJzKHtcbiAgICAgICAgICB0ZXh0OiBxdWVyeSxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXNRdWVyeS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgLy8gaWYgdGhpcyBpcyBubyBsb25nZXIgdGhlIG1vc3QgcmVjZW50IHF1ZXJ5LCB0aGVuIGlnbm9yZVxuICAgICAgICAgIGlmICh0aGlzUXVlcnkgIT09IGN1cnJlbnRRdWVyeSkgeyByZXR1cm47IH1cbiAgICAgICAgICByZXNldFVzZXJMaXN0KCk7XG4gICAgICAgICAgbG9hZEZyb21SZXNwb25zZS5iaW5kKCRzY29wZS51c2VycykocmVzcG9uc2UpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS51c2VycyA9IHt9O1xuICAgICAgZnVuY3Rpb24gcmVzZXRVc2VyTGlzdCgpIHtcbiAgICAgICAgJHNjb3BlLnVzZXJzID0ge1xuICAgICAgICAgIHVzZXJzOiBbXSxcbiAgICAgICAgICBidXN5OiBmYWxzZSxcbiAgICAgICAgICBuZXh0UGFnZTogMCxcbiAgICAgICAgICB0b3RhbFBhZ2VzOiAwLFxuICAgICAgICAgIHRvdGFsVXNlcnM6IDAsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXNldFVzZXJMaXN0KCk7XG5cbiAgICAgICRzY29wZS5zZWxlY3RlZFVzZXIgPSBudWxsO1xuICAgICAgJHNjb3BlLnNldFNlbGVjdGVkVXNlciA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgdmFyICR1c2VyRGV0YWlscyA9ICQoJy51c2VyRGV0YWlscycpO1xuICAgICAgICAkdXNlckRldGFpbHMubW9kYWwoKTtcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkVXNlciA9IHVzZXI7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgJHVzZXJEZXRhaWxzLm1vZGFsKCdzaG93Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJHVzZXJEZXRhaWxzLm1vZGFsKCdoaWRlJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgICRzY29wZS51c2Vycy5nZXROZXh0UGFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5idXN5KSB7IHJldHVybjsgfVxuXG4gICAgICAgIHRoaXMuYnVzeSA9IHRydWU7XG4gICAgICAgIHRoaXMubmV4dFBhZ2UgPSB0aGlzLm5leHRQYWdlICsgMTtcblxuICAgICAgICBVc2VyU2VydmljZS5nZXRVc2Vycyh7XG4gICAgICAgICAgdGV4dDogZ2V0UXVlcnkoKSxcbiAgICAgICAgICBwYWdlOiB0aGlzLm5leHRQYWdlLFxuICAgICAgICB9KS50aGVuKGxvYWRGcm9tUmVzcG9uc2UuYmluZCh0aGlzKSk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUudXNlcnMuZ2V0TmV4dFBhZ2UoKTtcblxuICAgICAgZnVuY3Rpb24gbG9hZEZyb21SZXNwb25zZShyZXNwb25zZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTtcblxuICAgICAgICB0aGlzLnVzZXJzID0gdGhpcy51c2Vycy5jb25jYXQocmVzcG9uc2UuZGF0YS51c2Vycyk7XG5cbiAgICAgICAgdGhpcy50b3RhbFVzZXJzID0gcmVzcG9uc2UuZGF0YS50b3RhbFVzZXJzO1xuICAgICAgICB0aGlzLnRvdGFsUGFnZXMgPSByZXNwb25zZS5kYXRhLnRvdGFsUGFnZXM7XG4gICAgICAgIHRoaXMubmV4dFBhZ2UgPSB0aGlzLm5leHRQYWdlICsgMTtcbiAgICAgICAgdGhpcy5idXN5ID0gZmFsc2U7XG5cbiAgICAgICAgJHNlYXJjaC5zdGlja3koJ3JlZnJlc2gnKTtcbiAgICAgIH1cblxuICAgICAgJHNjb3BlLmNoZWNraW4gPSBmdW5jdGlvbih1c2VySWQpIHtcbiAgICAgICAgVXNlclNlcnZpY2UuY2hlY2tpbih1c2VySWQpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NoZWNrZWQgaW4nLCBkYXRhKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5jaGVja291dCA9IGZ1bmN0aW9uKHVzZXJJZCkge1xuICAgICAgICBVc2VyU2VydmljZS5jaGVja291dCh1c2VySWQpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NoZWNrZWQgb3V0JywgZGF0YSk7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRzdGF0ZScsXG4gICAgJ0F1dGhTZXJ2aWNlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgQXV0aFNlcnZpY2UpIHtcblxuICAgICAgZnVuY3Rpb24gb25TdWNjZXNzKGRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3N1Y2Nlc3MnLCBkYXRhKTtcbiAgICAgICAgJHN0YXRlLmdvKCdhcHAuY2hlY2tpbicpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBvbkZhaWx1cmUoZGF0YSkge1xuICAgICAgICBjb25zb2xlLmxvZygnZmFpbHVyZScsIGRhdGEpO1xuICAgICAgfVxuXG4gICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgQXV0aFNlcnZpY2UubG9naW5XaXRoUGFzc3dvcmQoXG4gICAgICAgICAgJHNjb3BlLmVtYWlsLCAkc2NvcGUucGFzc3dvcmRcbiAgICAgICAgKS50aGVuKG9uU3VjY2Vzcywgb25GYWlsdXJlKTtcbiAgICAgIH07XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmNvbnRyb2xsZXIoJ1Rvb2xiYXJDb250cm9sbGVyJywgW1xuICAgICckc2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgU2Vzc2lvbikge1xuICAgICAgJCgnLmxvZ291dCcpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICBTZXNzaW9uLmRlc3Ryb3koKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIF0pO1xuIiwiLyoqXG4gKiBIZXJlIGxheSB0aGUgYmFzZSB1cmxzIHVzZWQgaW4gdGhlIGh0dHAgdXJsIGluamVjdG9yXG4gKi9cbmFuZ3VsYXIubW9kdWxlKCdjaGVja2luJykuY29uc3RhbnQoJ1NFUlZFUl9VUkwnLCB7XG4gIEJBU0VfVVJMOiAgJ2h0dHBzOi8vY2U0ZTc1NzEubmdyb2suaW8vJyxcbiAgLy8gQkFTRV9VUkw6ICAnaHR0cHM6Ly9hcHBseS5oYWNrZ3QuY29tLycsXG5cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
