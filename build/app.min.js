var app=angular.module("checkin",["ui.router","infinite-scroll"]);app.config(["$httpProvider",function(e,t){e.interceptors.push("ApiAuthenticator")}]),app.factory("ApiAuthenticator",["Session","SERVER_URL",function(e,t){return{request:function(n){0!==n.url.indexOf("api/")&&0!==n.url.indexOf("auth/")||(n.url=t.BASE_URL+n.url,n.headers["Access-Control-Allow-Origin"]=t.BASE_URL);var o=e.getToken();return o&&(n.headers["x-access-token"]=o),n}}}]),app.directive("title",["$rootScope","$timeout",function(e,t){return{link:function(){var n=function(n,o){t(function(){e.title=o.data&&o.data.pageTitle?o.data.pageTitle:"Default title"})};e.$on("$stateChangeSuccess",n)}}}]),angular.module("checkin").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("login",{url:"/login",templateUrl:"views/login/login.html",controller:"LoginController",data:{requireLogin:!1,pageTitle:"Login"}}).state("app",{abstract:!0,views:{"@":{templateUrl:"views/base.html"},"sidebar@app":{templateUrl:"views/sidebar/sidebar.html",controller:"SidebarController"}},data:{requireLogin:!0,pageTitle:"Checkin"}}).state("app.checkin",{url:"/",templateUrl:"views/checkin/checkin.html",controller:"CheckinController"}).state("404",{url:"/404",templateUrl:"views/404.html"}),t.otherwise("404")}]).run(["$rootScope","$state","Session",function(e,t,n){e.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0}),e.$on("$stateChangeStart",function(e,o,r){var i=o.data.requireLogin;i&&!n.getToken()&&(e.preventDefault(),t.go("login"))})}]),angular.module("checkin").factory("AuthService",["$q","$http","$rootScope","$state","Session",function(e,t,n,o,r){function i(t){var n=t.data;return console.log("auth success",n),r.create(n.token,n.user),e(function(e){e(n.user)})}function c(t,n){return console.log("auth fail",t),o.go("login"),e(function(e,n){n(t)})}var a={},s="auth/";return a.loginWithPassword=function(e,n){return t.post(s+"login",{email:e,password:n}).then(i,c)},a.loginWithToken=function(e){return console.warn("Not actually sure if this works yet!"),t.post(s+"login",{token:e}).then(i,function(){400===status&&r.destroy().then(c)})},a}]),angular.module("checkin").service("Session",["$rootScope","$window","$q",function(e,t,n){this.create=function(n,o){t.localStorage.jwt=n,t.localStorage.userId=o._id,t.localStorage.currentUser=JSON.stringify(o),e.currentUser=o},this.destroy=function(){return delete t.localStorage.jwt,delete t.localStorage.userId,delete t.localStorage.currentUser,e.currentUser=null,n(function(e,t){e()})},this.getToken=function(){return t.localStorage.jwt},this.getUserId=function(){return t.localStorage.userId},this.getUser=function(){return JSON.parse(t.localStorage.currentUser)}}]),angular.module("checkin").factory("UserService",["$q","$http","Session",function(e,t,n){var o="api/users",r=o+"/",i={};return i.getUsers=function(e){var n=e?o+"?"+$.param({text:e.text,page:e.page?e.page:0,size:e.size?e.size:50}):r;return t.get(n)},i.checkin=function(e){return t.post(r+e+"/checkin")},i.checkout=function(e){return t.post(r+e+"/checkout")},i}]),angular.module("checkin").controller("CheckinController",["$scope","UserService",function(e,t){e.users={users:[],busy:!1,nextPage:0,totalPages:1/0},e.selectedUser=null,e.setSelectedUser=function(t){var n=$(".ui.modal.userDetails");n.modal(),e.selectedUser=t,t?n.modal("show"):n.modal("hide")},e.users.getNextPage=function(){this.busy||this.nextPage>=this.totalPages||(this.busy=!0,t.getUsers({page:this.nextPage}).then(function(e){console.log(e.data),this.users=this.users.concat(e.data.users),this.totalPages=e.data.totalPages,this.nextPage+=1,this.busy=!1}.bind(this)))},e.checkin=function(e){t.checkin(e).then(function(e){console.log("checked in",e)})},e.checkout=function(e){t.checkout(e).then(function(e){console.log("checked out",e)})}}]),angular.module("checkin").controller("LoginController",["$scope","AuthService",function(e,t){function n(e){console.log("success",e)}function o(e){console.log("failure",e)}e.login=function(){t.loginWithPassword(e.email,e.password).then(n,o)}}]),angular.module("checkin").controller("SidebarController",["$scope","Session",function(e,t){}]),angular.module("checkin").constant("SERVER_URL",{BASE_URL:"https://ce4e7571.ngrok.io/"});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJvdXRlcy5qcyIsImF1dGgvQXV0aFNlcnZpY2UuanMiLCJzZXNzaW9uL1Nlc3Npb24uanMiLCJ1c2Vycy9Vc2VyU2VydmljZS5qcyIsImNoZWNraW4vY2hlY2tpbkNvbnRyb2xsZXIuanMiLCJsb2dpbi9sb2dpbkNvbnRyb2xsZXIuanMiLCJzaWRlYmFyL1NpZGViYXJDb250cm9sbGVyLmpzIiwiY29uZmlnLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkaHR0cFByb3ZpZGVyIiwiU0VSVkVSX1VSTCIsImludGVyY2VwdG9ycyIsInB1c2giLCJmYWN0b3J5IiwiU2Vzc2lvbiIsInJlcXVlc3QiLCJ1cmwiLCJpbmRleE9mIiwiQkFTRV9VUkwiLCJoZWFkZXJzIiwidG9rZW4iLCJnZXRUb2tlbiIsImRpcmVjdGl2ZSIsIiRyb290U2NvcGUiLCIkdGltZW91dCIsImxpbmsiLCJsaXN0ZW5lciIsImV2ZW50IiwidG9TdGF0ZSIsInRpdGxlIiwiZGF0YSIsInBhZ2VUaXRsZSIsIiRvbiIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwic3RhdGUiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJyZXF1aXJlTG9naW4iLCJhYnN0cmFjdCIsInZpZXdzIiwiQCIsInNpZGViYXJAYXBwIiwib3RoZXJ3aXNlIiwicnVuIiwiJHN0YXRlIiwiZG9jdW1lbnQiLCJib2R5Iiwic2Nyb2xsVG9wIiwiZG9jdW1lbnRFbGVtZW50IiwidG9QYXJhbXMiLCJwcmV2ZW50RGVmYXVsdCIsImdvIiwiJHEiLCIkaHR0cCIsImxvZ2luU3VjY2VzcyIsInJlc3BvbnNlIiwiY29uc29sZSIsImxvZyIsImNyZWF0ZSIsInVzZXIiLCJyZXNvbHZlIiwibG9naW5GYWlsdXJlIiwiY2FsbGJhY2siLCJyZWplY3QiLCJhdXRoU2VydmljZSIsImJhc2VVcmwiLCJsb2dpbldpdGhQYXNzd29yZCIsImVtYWlsIiwicGFzc3dvcmQiLCJwb3N0IiwidGhlbiIsImxvZ2luV2l0aFRva2VuIiwid2FybiIsInN0YXR1cyIsImRlc3Ryb3kiLCJzZXJ2aWNlIiwiJHdpbmRvdyIsInRoaXMiLCJsb2NhbFN0b3JhZ2UiLCJqd3QiLCJ1c2VySWQiLCJfaWQiLCJjdXJyZW50VXNlciIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRVc2VySWQiLCJnZXRVc2VyIiwicGFyc2UiLCJ1c2VycyIsImJhc2UiLCJVc2VyU2VydmljZSIsImdldFVzZXJzIiwib3B0aW9ucyIsIiQiLCJwYXJhbSIsInRleHQiLCJwYWdlIiwic2l6ZSIsImdldCIsImNoZWNraW4iLCJjaGVja291dCIsIiRzY29wZSIsImJ1c3kiLCJuZXh0UGFnZSIsInRvdGFsUGFnZXMiLCJJbmZpbml0eSIsInNlbGVjdGVkVXNlciIsInNldFNlbGVjdGVkVXNlciIsIiR1c2VyRGV0YWlscyIsIm1vZGFsIiwiZ2V0TmV4dFBhZ2UiLCJjb25jYXQiLCJiaW5kIiwiQXV0aFNlcnZpY2UiLCJvblN1Y2Nlc3MiLCJvbkZhaWx1cmUiLCJsb2dpbiIsImNvbnN0YW50Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLFdBQ0EsWUFDQSxtQkFHQUYsS0FBQUcsUUFDQSxnQkFDQSxTQUFBQyxFQUFBQyxHQUdBRCxFQUFBRSxhQUFBQyxLQUFBLHVCQUlBUCxJQUFBUSxRQUFBLG9CQUNBLFVBQ0EsYUFDQSxTQUFBQyxFQUFBSixHQUNBLE9BQ0FLLFFBQUEsU0FBQVAsR0FDQSxJQUFBQSxFQUFBUSxJQUFBQyxRQUFBLFNBQUEsSUFBQVQsRUFBQVEsSUFBQUMsUUFBQSxXQUNBVCxFQUFBUSxJQUFBTixFQUFBUSxTQUFBVixFQUFBUSxJQUNBUixFQUFBVyxRQUFBLCtCQUFBVCxFQUFBUSxTQUVBLElBQUFFLEdBQUFOLEVBQUFPLFVBSUEsT0FIQUQsS0FDQVosRUFBQVcsUUFBQSxrQkFBQUMsR0FFQVosT0FNQUgsSUFBQWlCLFVBQUEsU0FBQSxhQUFBLFdBQ0EsU0FBQUMs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S0FBQVcsTUFBQVgsS0FBQVcsTUFBQXVCLE9BQUF4RCxFQUFBMUIsS0FBQTJELE9BRUFYLEtBQUEyQixXQUFBakQsRUFBQTFCLEtBQUEyRSxXQUNBM0IsS0FBQTBCLFVBQUEsRUFDQTFCLEtBQUF5QixNQUFBLEdBQ0FVLEtBQUFuQyxTQUlBd0IsRUFBQUYsUUFBQSxTQUFBbkIsR0FDQVUsRUFBQVMsUUFBQW5CLEdBQ0FWLEtBQUEsU0FBQXpDLEdBQ0EyQixRQUFBQyxJQUFBLGFBQUE1QixNQUlBd0UsRUFBQUQsU0FBQSxTQUFBcEIsR0FDQVUsRUFBQVUsU0FBQXBCLEdBQ0FWLEtBQUEsU0FBQXpDLEdBQ0EyQixRQUFBQyxJQUFBLGNBQUE1QixTQ3hEQXhCLFFBQUFDLE9BQUEsV0FDQThCLFdBQUEsbUJBQ0EsU0FDQSxjQUNBLFNBQUFpRSxFQUFBWSxHQUVBLFFBQUFDLEdBQUFyRixHQUNBMkIsUUFBQUMsSUFBQSxVQUFBNUIsR0FHQSxRQUFBc0YsR0FBQXRGLEdBQ0EyQixRQUFBQyxJQUFBLFVBQUE1QixHQUdBd0UsRUFBQWUsTUFBQSxXQUNBSCxFQUFBL0Msa0JBQ0FtQyxFQUFBbEMsTUFBQWtDLEVBQUFqQyxVQUNBRSxLQUFBNEMsRUFBQUMsT0NqQkE5RyxRQUFBQyxPQUFBLFdBQ0E4QixXQUFBLHFCQUNBLFNBQ0EsVUFDQSxTQUFBaUUsRUFBQXhGLE9DREFSLFFBQUFDLE9BQUEsV0FBQStHLFNBQUEsY0FDQXBHLFNBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicsIFtcbiAgJ3VpLnJvdXRlcicsXG4gICdpbmZpbml0ZS1zY3JvbGwnLFxuXSk7XG5cbmFwcC5jb25maWcoW1xuICAnJGh0dHBQcm92aWRlcicsXG4gIGZ1bmN0aW9uKCRodHRwUHJvdmlkZXIsIFNFUlZFUl9VUkwpIHtcblxuICAgIC8vIGFkZCByb290IHVybCB0byBhbGwgYXBpIGFuZCBhdXRoIHJlcXVlc3RzXG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXBpQXV0aGVudGljYXRvcicpO1xuICB9XG5dKTtcblxuYXBwLmZhY3RvcnkoJ0FwaUF1dGhlbnRpY2F0b3InLCBbXG4gICdTZXNzaW9uJyxcbiAgJ1NFUlZFUl9VUkwnLFxuICBmdW5jdGlvbihTZXNzaW9uLCBTRVJWRVJfVVJMKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgICAgICBpZiAoY29uZmlnLnVybC5pbmRleE9mKCdhcGkvJykgPT09IDAgfHwgY29uZmlnLnVybC5pbmRleE9mKCdhdXRoLycpID09PSAwKSB7XG4gICAgICAgICAgY29uZmlnLnVybCA9IFNFUlZFUl9VUkwuQkFTRV9VUkwgKyBjb25maWcudXJsO1xuICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nXSA9IFNFUlZFUl9VUkwuQkFTRV9VUkw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRva2VuID0gU2Vzc2lvbi5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICBjb25maWcuaGVhZGVyc1sneC1hY2Nlc3MtdG9rZW4nXSA9IHRva2VuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXSk7XG5cbmFwcC5kaXJlY3RpdmUoJ3RpdGxlJywgWyckcm9vdFNjb3BlJywgJyR0aW1lb3V0JyxcbiAgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHRpbWVvdXQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbGluazogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQsIHRvU3RhdGUpIHtcblxuICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHJvb3RTY29wZS50aXRsZSA9ICh0b1N0YXRlLmRhdGEgJiYgdG9TdGF0ZS5kYXRhLnBhZ2VUaXRsZSkgP1xuICAgICAgICAgICAgICB0b1N0YXRlLmRhdGEucGFnZVRpdGxlIDogJ0RlZmF1bHQgdGl0bGUnO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJywgbGlzdGVuZXIpO1xuICAgICAgfVxuICAgIH07XG4gIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2NoZWNraW4nKVxuICAuY29uZmlnKFtcbiAgICAnJHN0YXRlUHJvdmlkZXInLFxuICAgICckdXJsUm91dGVyUHJvdmlkZXInLFxuICAgIGZ1bmN0aW9uKFxuICAgICAgJHN0YXRlUHJvdmlkZXIsXG4gICAgICAkdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xuICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL2xvZ2luL2xvZ2luLmh0bWxcIixcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXInLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICByZXF1aXJlTG9naW46IGZhbHNlLFxuICAgICAgICAgICAgICBwYWdlVGl0bGU6ICdMb2dpbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnN0YXRlKCdhcHAnLCB7XG4gICAgICAgICAgICBhYnN0cmFjdDogdHJ1ZSxcbiAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICdAJzoge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL2Jhc2UuaHRtbFwiLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAnc2lkZWJhckBhcHAnOiB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3Mvc2lkZWJhci9zaWRlYmFyLmh0bWxcIixcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnU2lkZWJhckNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgcmVxdWlyZUxvZ2luOiB0cnVlLFxuICAgICAgICAgICAgICBwYWdlVGl0bGU6ICdDaGVja2luJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc3RhdGUoJ2FwcC5jaGVja2luJywge1xuICAgICAgICAgICAgdXJsOiAnLycsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NoZWNraW4vY2hlY2tpbi5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDaGVja2luQ29udHJvbGxlcicsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuc3RhdGUoJzQwNCcsIHtcbiAgICAgICAgICAgIHVybDogJy80MDQnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy80MDQuaHRtbCcsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnNDA0Jyk7XG4gICAgfVxuICBdKVxuICAucnVuKFtcbiAgICAnJHJvb3RTY29wZScsXG4gICAgJyRzdGF0ZScsXG4gICAgJ1Nlc3Npb24nLFxuICAgIGZ1bmN0aW9uKFxuICAgICAgJHJvb3RTY29wZSxcbiAgICAgICRzdGF0ZSxcbiAgICAgIFNlc3Npb24pe1xuXG4gICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcbiAgICAgIH0pO1xuXG4gICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zKSB7XG4gICAgICAgIHZhciByZXF1aXJlTG9naW4gPSB0b1N0YXRlLmRhdGEucmVxdWlyZUxvZ2luO1xuXG4gICAgICAgIGlmIChyZXF1aXJlTG9naW4gJiYgIVNlc3Npb24uZ2V0VG9rZW4oKSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5mYWN0b3J5KCdBdXRoU2VydmljZScsIFtcbiAgICAnJHEnLFxuICAgICckaHR0cCcsXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICdTZXNzaW9uJyxcbiAgICBmdW5jdGlvbigkcSwgJGh0dHAsICRyb290U2NvcGUsICRzdGF0ZSwgU2Vzc2lvbikge1xuICAgICAgdmFyIGF1dGhTZXJ2aWNlID0ge307XG4gICAgICB2YXIgYmFzZVVybCA9ICdhdXRoLyc7XG5cbiAgICAgIGZ1bmN0aW9uIGxvZ2luU3VjY2VzcyhyZXNwb25zZSkge1xuICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIGNvbnNvbGUubG9nKCdhdXRoIHN1Y2Nlc3MnLCBkYXRhKTtcbiAgICAgICAgU2Vzc2lvbi5jcmVhdGUoZGF0YS50b2tlbiwgZGF0YS51c2VyKTtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgICByZXNvbHZlKGRhdGEudXNlcik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBsb2dpbkZhaWx1cmUoZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2F1dGggZmFpbCcsIGRhdGEpO1xuICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICByZWplY3QoZGF0YSk7XG4gICAgICAgIH0pO1xuXG4gICAgICB9XG5cbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luV2l0aFBhc3N3b3JkID0gZnVuY3Rpb24oZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgIC5wb3N0KGJhc2VVcmwgKyAnbG9naW4nLCB7XG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbihsb2dpblN1Y2Nlc3MsIGxvZ2luRmFpbHVyZSk7XG4gICAgICB9O1xuXG4gICAgICAvLyBUT0RPIHVuc3VyZSBpZiB0aGlzIHdvcmtzIVxuICAgICAgYXV0aFNlcnZpY2UubG9naW5XaXRoVG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJOb3QgYWN0dWFsbHkgc3VyZSBpZiB0aGlzIHdvcmtzIHlldCFcIik7XG4gICAgICAgIHJldHVybiAkaHR0cFxuICAgICAgICAgIC5wb3N0KGJhc2VVcmwgKyAnbG9naW4nLCB7XG4gICAgICAgICAgICB0b2tlbjogdG9rZW5cbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKGxvZ2luU3VjY2VzcywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgU2Vzc2lvbi5kZXN0cm95KCkudGhlbihsb2dpbkZhaWx1cmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlO1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5zZXJ2aWNlKCdTZXNzaW9uJywgW1xuICAgICckcm9vdFNjb3BlJyxcbiAgICAnJHdpbmRvdycsXG4gICAgJyRxJyxcbiAgICBmdW5jdGlvbigkcm9vdFNjb3BlLCAkd2luZG93LCAkcSl7XG4gICAgICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKHRva2VuLCB1c2VyKXtcbiAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0ID0gdG9rZW47XG4gICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnVzZXJJZCA9IHVzZXIuX2lkO1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlciA9IEpTT04uc3RyaW5naWZ5KHVzZXIpO1xuICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3Q7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS51c2VySWQ7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcjtcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRUb2tlbiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3Q7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmdldFVzZXJJZCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS51c2VySWQ7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmdldFVzZXIgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcik7XG4gICAgICB9O1xuICB9XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5mYWN0b3J5KCdVc2VyU2VydmljZScsIFtcbiAgICAnJHEnLFxuICAgICckaHR0cCcsXG4gICAgJ1Nlc3Npb24nLFxuICAgIGZ1bmN0aW9uKCRxLCAkaHR0cCwgU2Vzc2lvbikge1xuICAgICAgdmFyIHVzZXJzID0gJ2FwaS91c2Vycyc7XG4gICAgICB2YXIgYmFzZSA9IHVzZXJzICsgJy8nO1xuXG4gICAgICB2YXIgVXNlclNlcnZpY2UgPSB7fTtcblxuICAgICAgVXNlclNlcnZpY2UuZ2V0VXNlcnMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHZhciB1cmwgPSBvcHRpb25zID8gdXNlcnMgKyAnPycgKyAkLnBhcmFtKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRleHQ6IG9wdGlvbnMudGV4dCxcbiAgICAgICAgICAgIHBhZ2U6IG9wdGlvbnMucGFnZSA/IG9wdGlvbnMucGFnZSA6IDAsXG4gICAgICAgICAgICBzaXplOiBvcHRpb25zLnNpemUgPyBvcHRpb25zLnNpemUgOiA1MFxuICAgICAgICAgIH0pIDogYmFzZTtcblxuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCk7XG4gICAgICB9O1xuXG4gICAgICBVc2VyU2VydmljZS5jaGVja2luID0gZnVuY3Rpb24odXNlcklkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KGJhc2UgKyB1c2VySWQgKyAnL2NoZWNraW4nKTtcbiAgICAgIH07XG5cbiAgICAgIFVzZXJTZXJ2aWNlLmNoZWNrb3V0ID0gZnVuY3Rpb24odXNlcklkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KGJhc2UgKyB1c2VySWQgKyAnL2NoZWNrb3V0Jyk7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gVXNlclNlcnZpY2U7XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmNvbnRyb2xsZXIoJ0NoZWNraW5Db250cm9sbGVyJywgW1xuICAgICckc2NvcGUnLFxuICAgICdVc2VyU2VydmljZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU2VydmljZSkge1xuXG4gICAgICAkc2NvcGUudXNlcnMgPSB7XG4gICAgICAgIHVzZXJzOiBbXSxcbiAgICAgICAgYnVzeTogZmFsc2UsXG4gICAgICAgIG5leHRQYWdlOiAwLFxuICAgICAgICB0b3RhbFBhZ2VzOiBJbmZpbml0eSxcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5zZWxlY3RlZFVzZXIgPSBudWxsO1xuICAgICAgJHNjb3BlLnNldFNlbGVjdGVkVXNlciA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgdmFyICR1c2VyRGV0YWlscyA9ICQoJy51aS5tb2RhbC51c2VyRGV0YWlscycpO1xuICAgICAgICAkdXNlckRldGFpbHMubW9kYWwoKTtcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkVXNlciA9IHVzZXI7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgJHVzZXJEZXRhaWxzLm1vZGFsKCdzaG93Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJHVzZXJEZXRhaWxzLm1vZGFsKCdoaWRlJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cblxuICAgICAgJHNjb3BlLnVzZXJzLmdldE5leHRQYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmJ1c3kpIHsgcmV0dXJuOyB9XG4gICAgICAgIGlmICh0aGlzLm5leHRQYWdlID49IHRoaXMudG90YWxQYWdlcykgeyByZXR1cm47IH1cblxuICAgICAgICB0aGlzLmJ1c3kgPSB0cnVlO1xuXG4gICAgICAgIFVzZXJTZXJ2aWNlLmdldFVzZXJzKHtcbiAgICAgICAgICBwYWdlOiB0aGlzLm5leHRQYWdlLFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7XG5cbiAgICAgICAgICB0aGlzLnVzZXJzID0gdGhpcy51c2Vycy5jb25jYXQocmVzcG9uc2UuZGF0YS51c2Vycyk7XG5cbiAgICAgICAgICB0aGlzLnRvdGFsUGFnZXMgPSByZXNwb25zZS5kYXRhLnRvdGFsUGFnZXM7XG4gICAgICAgICAgdGhpcy5uZXh0UGFnZSArPSAxO1xuICAgICAgICAgIHRoaXMuYnVzeSA9IGZhbHNlO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgfTtcblxuXG4gICAgICAkc2NvcGUuY2hlY2tpbiA9IGZ1bmN0aW9uKHVzZXJJZCkge1xuICAgICAgICBVc2VyU2VydmljZS5jaGVja2luKHVzZXJJZClcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2hlY2tlZCBpbicsIGRhdGEpO1xuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLmNoZWNrb3V0ID0gZnVuY3Rpb24odXNlcklkKSB7XG4gICAgICAgIFVzZXJTZXJ2aWNlLmNoZWNrb3V0KHVzZXJJZClcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2hlY2tlZCBvdXQnLCBkYXRhKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfVxuICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjaGVja2luJylcbiAgLmNvbnRyb2xsZXIoJ0xvZ2luQ29udHJvbGxlcicsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnQXV0aFNlcnZpY2UnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgQXV0aFNlcnZpY2UpIHtcblxuICAgICAgZnVuY3Rpb24gb25TdWNjZXNzKGRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3N1Y2Nlc3MnLCBkYXRhKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gb25GYWlsdXJlKGRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2ZhaWx1cmUnLCBkYXRhKTtcbiAgICAgIH1cblxuICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIEF1dGhTZXJ2aWNlLmxvZ2luV2l0aFBhc3N3b3JkKFxuICAgICAgICAgICRzY29wZS5lbWFpbCwgJHNjb3BlLnBhc3N3b3JkXG4gICAgICAgICkudGhlbihvblN1Y2Nlc3MsIG9uRmFpbHVyZSk7XG4gICAgICB9O1xuICAgIH1cbiAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpXG4gIC5jb250cm9sbGVyKCdTaWRlYmFyQ29udHJvbGxlcicsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnU2Vzc2lvbicsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCBTZXNzaW9uKSB7XG4gICAgfVxuICBdKTtcbiIsIi8qKlxuICogSGVyZSBsYXkgdGhlIGJhc2UgdXJscyB1c2VkIGluIHRoZSBodHRwIHVybCBpbmplY3RvclxuICovXG5hbmd1bGFyLm1vZHVsZSgnY2hlY2tpbicpLmNvbnN0YW50KCdTRVJWRVJfVVJMJywge1xuICBCQVNFX1VSTDogICdodHRwczovL2NlNGU3NTcxLm5ncm9rLmlvLycsXG4gIC8vIEJBU0VfVVJMOiAgJ2h0dHBzOi8vYXBwbHkuaGFja2d0LmNvbS8nLFxuXG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
